name: Race Results Update

on:
  push:
    paths:
      - 'astro-site/src/data/raceResults.json'
    branches: [ main ]

jobs:
  update-notification:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Get race results data
      id: race-data
      run: |
        # Extract current results from JSON
        DATE=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.date')
        TRACK=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.track')
        HITS=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.hits')
        TOTAL_RACES=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.totalRaces')
        HIT_RATE=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.hitRate')
        PAYOUT=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.payout')
        RETURN_RATE=$(cat astro-site/src/data/raceResults.json | jq -r '.currentResults.returnRate')
        
        echo "date=$DATE" >> $GITHUB_OUTPUT
        echo "track=$TRACK" >> $GITHUB_OUTPUT
        echo "hits=$HITS" >> $GITHUB_OUTPUT
        echo "total_races=$TOTAL_RACES" >> $GITHUB_OUTPUT
        echo "hit_rate=$HIT_RATE" >> $GITHUB_OUTPUT
        echo "payout=$PAYOUT" >> $GITHUB_OUTPUT
        echo "return_rate=$RETURN_RATE" >> $GITHUB_OUTPUT
        
    - name: Create update summary
      run: |
        echo "## ğŸ‡ ãƒ¬ãƒ¼ã‚¹çµæœæ›´æ–°å®Œäº†ï¼"
        echo ""
        echo "**ğŸ“… ${{ steps.race-data.outputs.date }} ${{ steps.race-data.outputs.track }}**"
        echo ""
        echo "### ğŸ“Š æˆç¸¾ã‚µãƒãƒªãƒ¼"
        echo "- **çš„ä¸­æ•°**: ${{ steps.race-data.outputs.hits }}/${{ steps.race-data.outputs.total_races }}ãƒ¬ãƒ¼ã‚¹"
        echo "- **çš„ä¸­ç‡**: ${{ steps.race-data.outputs.hit_rate }}"
        echo "- **é…å½“é‡‘é¡**: Â¥${{ steps.race-data.outputs.payout }}"
        echo "- **å›åç‡**: ${{ steps.race-data.outputs.return_rate }}"
        echo ""
        echo "### ğŸš€ è‡ªå‹•å‡¦ç†å®Œäº†"
        echo "- âœ… ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼: OK"
        echo "- âœ… ã‚µã‚¤ãƒˆæ›´æ–°: è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹"
        echo "- âœ… çµ±è¨ˆè¨ˆç®—: å®Œäº†"