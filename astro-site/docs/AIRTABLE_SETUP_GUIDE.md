# Airtableセットアップガイド

## 1. Airtableでベース作成

### ステップ1: 新規ベース作成
1. [Airtable](https://airtable.com)にログイン
2. 「Start from scratch」で新規ベース作成
3. ベース名: `NANKANアナリティクス顧客管理`

### ステップ2: Customersテーブル作成

以下のフィールドを作成してください：

| フィールド名 | タイプ | 設定内容 |
|------------|--------|----------|
| **Email** | Email | 主キー、重複不可 |
| **氏名** | Single line text | 顧客名 |
| **プラン** | Single select | `free`, `standard`, `premium` |
| **ポイント** | Number | 初期値: 0、整数のみ |
| **ランク** | Formula | 下記の式を使用 |
| **有効期限** | Date | 日付のみ |
| **登録日** | Date | 日付と時刻 |
| **特典申請済み** | Checkbox | チェックボックス |
| **最終ログイン** | Date | 日付と時刻 |
| **ノート** | Long text | メモ欄 |

### ランク計算式（Formulaフィールド）
```
IF(ポイント >= 2000, "💎 ダイヤモンド",
  IF(ポイント >= 1000, "🥇 ゴールド",
    IF(ポイント >= 500, "🥈 シルバー",
      "🥉 ブロンズ"
    )
  )
)
```

## 2. Airtable APIキー取得

### 個人アクセストークン作成
1. [Airtable Account](https://airtable.com/account)にアクセス
2. 「Personal access tokens」セクション
3. 「Create new token」をクリック
4. 名前: `NANKANアナリティクス`
5. スコープ:
   - `data.records:read`
   - `data.records:write`
6. ベースを選択: 作成した`NANKANアナリティクス顧客管理`
7. 「Create token」をクリック
8. **トークンをコピーして安全に保管**

### ベースID取得
1. Airtableでベースを開く
2. URLから取得: `https://airtable.com/appXXXXXXXXXXXX/...`
3. `appXXXXXXXXXXXX`の部分がベースID

## 3. テストデータ追加

以下のサンプルデータを追加：

| Email | 氏名 | プラン | ポイント | 有効期限 |
|-------|------|--------|----------|----------|
| test1@example.com | テスト太郎 | standard | 750 | 2025-10-01 |
| test2@example.com | サンプル花子 | premium | 1250 | 2025-11-01 |
| free@example.com | 無料次郎 | free | 250 | - |

## 4. ビューの作成（オプション）

管理しやすくするためのビュー：

### 「特典申請待ち」ビュー
- フィルター: `ポイント >= 1000 AND 特典申請済み = false`
- ソート: ポイント降順

### 「有効期限切れ間近」ビュー
- フィルター: `有効期限 <= TODAY() + 7`
- ソート: 有効期限昇順

### 「プラン別」グループビュー
- グループ化: プラン
- ソート: ポイント降順

## 5. 次のステップ

Airtableの設定が完了したら：
1. ベースIDとAPIトークンをメモ
2. Zapier設定に進む
3. 環境変数に追加

---

## トラブルシューティング

### よくある問題

**Q: APIトークンが機能しない**
A: スコープとベースの選択を確認してください

**Q: ランク計算式がエラーになる**
A: フィールド名が日本語の場合、英語に変更してください

**Q: データが取得できない**
A: CORSエラーの場合、サーバーサイドAPIを使用してください