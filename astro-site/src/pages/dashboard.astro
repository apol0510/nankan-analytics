---
export const prerender = true; // é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆç”¨ã«æˆ»ã™
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="ãƒã‚¤ãƒšãƒ¼ã‚¸ - NANKANã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹">
    <div class="dashboard-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="dashboard-header">
            <h1>ğŸ”‘ ä¼šå“¡ãƒ­ã‚°ã‚¤ãƒ³</h1>
            <p class="subtitle">ã”ç™»éŒ²æ¸ˆã¿ã®ä¼šå“¡æ§˜å°‚ç”¨ - NANKANã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹</p>
        </div>

        <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰ -->
        <div id="login-section" class="login-section">
            <div class="login-card">
                <h2>ğŸ” ä¼šå“¡æ§˜ãƒ­ã‚°ã‚¤ãƒ³</h2>
                <p>ã”ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„</p>
                <form id="magic-link-form">
                    <input 
                        type="email" 
                        id="email-input" 
                        placeholder="example@email.com"
                        required
                        class="email-input"
                    />
                    <button type="submit" class="submit-btn" id="magic-link-btn">
                        ãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                </form>
                <div id="success-message" class="success-message" style="display: none;"></div>
                <div id="error-message" class="error-message" style="display: none;"></div>

                <!-- æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ¡ˆå†… -->
                <div class="new-user-notice">
                    <p>ğŸ†• <strong>åˆã‚ã¦ã”åˆ©ç”¨ã®æ–¹</strong></p>
                    <p>ã¾ãšã¯<a href="/free-signup/" class="link">ã“ã¡ã‚‰ã‹ã‚‰ç„¡æ–™ã§å§‹ã‚ã‚‹</a>ã§ä¼šå“¡ç™»éŒ²ã‚’ãŠæ¸ˆã¾ã›ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œè¡¨ç¤ºï¼‰ -->
        <div id="dashboard-section" style="display: none;">
            <!-- æœŸé™åˆ‡ã‚Œè­¦å‘Šï¼ˆæœŸé™åˆ‡ã‚Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="expiry-warning-section" class="expiry-warning-section" style="display: none;">
                <div class="expiry-warning-card">
                    <div class="expiry-warning-icon">âš ï¸</div>
                    <div class="expiry-warning-content">
                        <h3>ãƒ—ãƒ©ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™</h3>
                        <div class="expiry-details">
                            <p>ãŠå®¢æ§˜ã®<strong id="expired-plan-name">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </strong>ãƒ—ãƒ©ãƒ³ã¯ã€<strong id="expiry-date-display">2025-10-01</strong>ã«æœ‰åŠ¹æœŸé™ã‚’è¿ãˆã¾ã—ãŸã€‚</p>
                            <p>ç¾åœ¨ã¯<strong>ç„¡æ–™ä¼šå“¡</strong>ã¨ã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>
                        </div>
                        <div class="expiry-actions">
                            <div class="expiry-action-card">
                                <h4>ğŸ”„ ç¶™ç¶šã‚’ã”å¸Œæœ›ã®å ´åˆ</h4>
                                <p>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç™»éŒ²ã§è‡ªå‹•æ›´æ–°ï¼ˆãŠã™ã™ã‚ï¼‰</p>
                                <a href="/pricing/" class="expiry-btn renew">ä»Šã™ããƒ—ãƒ©ãƒ³ã‚’æ›´æ–°</a>
                            </div>
                            <div class="expiry-action-card secondary">
                                <h4>ğŸšª é€€ä¼šã‚’ã”å¸Œæœ›ã®å ´åˆ</h4>
                                <p>é€€ä¼šå‡¦ç†å¾Œã‚‚æœ‰åŠ¹æœŸé™å†…ã¯ã”åˆ©ç”¨å¯èƒ½</p>
                                <button id="withdrawal-btn-expired" class="expiry-btn withdraw">é€€ä¼šå‡¦ç†ã¸é€²ã‚€</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä»Šå›ã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ± -->
            <div id="login-info-section" class="login-info-section" style="display: none;">
                <div class="login-info-card">
                    <div class="login-info-icon">ğŸ‰</div>
                    <div class="login-info-content">
                        <h3 id="login-info-title">ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ</h3>
                        <div id="login-info-message" class="login-info-message"></div>
                        <div id="login-info-points" class="login-info-points" style="display: none;">
                            <span class="points-icon">ğŸ†</span>
                            <span id="login-points-text">ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼</span>
                            <span id="login-points-value" class="points-value">+0pt</span>
                        </div>
                    </div>
                    <button id="login-info-close" class="close-btn">Ã—</button>
                </div>
            </div>

            <!-- ç©´é¦¬ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ -->
            <div class="dark-horse-link-section">
                <a href="/dark-horse-picks/" class="dark-horse-link-btn">
                    <span class="dark-horse-icon">ğŸ</span>
                    <div class="dark-horse-text">
                        <span class="dark-horse-title">æœ¬æ—¥ã®ç©´é¦¬æŠ½å‡ºãƒ„ãƒ¼ãƒ«</span>
                        <span class="dark-horse-subtitle">AIäºˆæƒ³ã‹ã‚‰ç‹™ã„ç›®ã®ç©´é¦¬ã‚’è‡ªå‹•æŠ½å‡º</span>
                    </div>
                    <span class="dark-horse-arrow">â†’</span>
                </a>
            </div>

            <!-- ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div class="status-section">
                <div class="status-grid">
                    <!-- ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ -->
                    <div class="status-card main-status">
                        <div class="status-header">
                            <div class="status-icon" id="main-status-icon">ğŸ‘¤</div>
                            <div class="status-badge" id="status-badge">èª­ã¿è¾¼ã¿ä¸­</div>
                        </div>
                        <div class="status-info">
                            <h3>ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
                            <div id="membership-status" class="status-value">èª­ã¿è¾¼ã¿ä¸­...</div>
                            <div id="membership-details" class="status-details"></div>
                        </div>
                    </div>



                    <!-- VIPæƒ…å ±ã‚«ãƒ¼ãƒ‰ï¼ˆPremiumã®ã¿ï¼‰ -->
                    <div class="vip-status-card" id="vip-status-card" style="display: none;">
                        <div class="vip-header">
                            <div class="vip-icon">ğŸ‘‘</div>
                            <div class="vip-title">PREMIUMä¼šå“¡ç‰¹å…¸</div>
                        </div>
                        <div class="vip-benefits" id="vip-benefits">
                            <div class="vip-benefit">âœ¨ å„ªå…ˆã‚µãƒãƒ¼ãƒˆ</div>
                            <div class="vip-benefit">ğŸ† é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„</div>
                            <div class="vip-benefit">ğŸ’° ãƒœãƒ¼ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆ</div>
                        </div>
                    </div>
                    
                    <!-- ãƒ—ãƒ©ãƒ³ç‰¹å…¸ã‚«ãƒ¼ãƒ‰ï¼ˆStandard/Freeç”¨ï¼‰ -->
                    <div class="plan-benefits-card" id="plan-benefits-card" style="display: none;">
                        <div class="plan-header">
                            <div class="plan-icon" id="plan-icon">ğŸ</div>
                            <div class="plan-title" id="plan-title">ãƒ—ãƒ©ãƒ³ç‰¹å…¸</div>
                        </div>
                        <div class="plan-benefits" id="plan-benefits">
                            <div class="plan-benefit">ğŸ‡ å¾ŒåŠ3ãƒ¬ãƒ¼ã‚¹äºˆæƒ³</div>
                            <div class="plan-benefit">ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³10pt</div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- ä»Šæ—¥ã®äºˆæƒ³ -->
            <div class="predictions-section">
                <h2>ğŸ‡ ä»Šæ—¥ã®äºˆæƒ³</h2>
                <div class="predictions-grid">

                    <!-- ç„¡æ–™äºˆæƒ³ -->
                    <div id="free-predictions" class="prediction-card free">
                        <div class="card-header">
                            <h3>ğŸ ç„¡æ–™äºˆæƒ³</h3>
                            <span class="plan-badge free">FREE</span>
                        </div>
                        <div class="race-info">
                            <div class="race-title">ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ¼ã‚¹ï¼ˆ11Rï¼‰</div>
                            <div class="confidence">äºˆæƒ³ç²¾åº¦: 87.3%</div>
                        </div>
                        <a href="/free-prediction/" class="view-btn">äºˆæƒ³ã‚’è¦‹ã‚‹</a>
                    </div>

                    <!-- Standardäºˆæƒ³ -->
                    <div id="standard-predictions" class="prediction-card standard" style="display: none;">
                        <div class="card-header">
                            <h3>âš¡ Standardäºˆæƒ³</h3>
                            <span class="plan-badge standard">STANDARD</span>
                        </div>
                        <div class="race-info">
                            <div class="race-title">å¾ŒåŠ3ãƒ¬ãƒ¼ã‚¹ï¼ˆ10R-12Rï¼‰</div>
                            <div class="confidence">äºˆæƒ³ç²¾åº¦: 89.1%</div>
                        </div>
                        <a href="/standard-predictions/" class="view-btn">äºˆæƒ³ã‚’è¦‹ã‚‹</a>
                    </div>

                    <!-- Premiumäºˆæƒ³ -->
                    <div id="premium-predictions" class="prediction-card premium" style="display: none;">
                        <div class="card-header">
                            <h3>ğŸ’ Premiumäºˆæƒ³</h3>
                            <span class="plan-badge premium">PREMIUM</span>
                        </div>
                        <div class="race-info">
                            <div class="race-title">å…¨ãƒ¬ãƒ¼ã‚¹ï¼ˆ1R-12Rï¼‰</div>
                            <div class="confidence">äºˆæƒ³ç²¾åº¦: 91.8%</div>
                        </div>
                        <a href="/premium-predictions/" class="view-btn">äºˆæƒ³ã‚’è¦‹ã‚‹</a>
                    </div>
                </div>
            </div>

            <!-- ãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ -->
            <div class="points-section">
                <div class="points-card">
                    <div class="points-header">
                        <h2>ğŸ’° ä¿æœ‰ãƒã‚¤ãƒ³ãƒˆ</h2>
                        <div class="points-value">
                            <span id="current-points">0</span>
                            <span class="points-unit">pt</span>
                        </div>
                    </div>
                    <div class="points-progress">
                        <!-- ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºï¼ˆå¾©æ´»é˜²æ­¢å¯¾ç­–ï¼‰ -->
                        <div class="simple-progress-container">
                            <div id="simple-progress-display">
                                <div class="progress-info-row">
                                    <span class="progress-current">ğŸ’° ä½¿ç”¨å¯èƒ½: <span id="current-points-simple">0</span>pt</span>
                                    <span class="progress-target">ğŸ¯ æ¬¡ã®ç›®æ¨™: <span id="target-points-simple">1000</span>pt</span>
                                </div>
                                <div class="progress-remaining">
                                    ã‚ã¨<span id="remaining-points-simple">1000</span>ptã§æ¬¡ã®ç›®æ¨™é”æˆï¼
                                </div>
                                <div class="simple-progress-bar">
                                    <div class="simple-progress-fill" id="simple-progress-fill" style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ãƒã‚¤ãƒ³ãƒˆäº¤æ›ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
            <div class="exchange-section">
                <div class="exchange-card">
                    <div class="exchange-header">
                        <h2>ğŸ ãƒã‚¤ãƒ³ãƒˆäº¤æ›</h2>
                        <p class="exchange-subtitle">ãƒã‚¤ãƒ³ãƒˆã‚’ç‰¹å…¸ã¨äº¤æ›ã§ãã¾ã™</p>
                    </div>
                    
                    <div class="exchange-grid">
                        <!-- 1000ptç‰¹å…¸ -->
                        <div class="exchange-option">
                            <div class="exchange-cost">1000pt</div>
                            <div class="exchange-reward">AIè§£æã«ã‚ˆã‚‹éš ã‚Œä¸Šæ˜‡é¦¬æƒ…å ±</div>
                            <button class="exchange-btn" onclick="requestExchange(1000, 'AIè§£æã«ã‚ˆã‚‹éš ã‚Œä¸Šæ˜‡é¦¬æƒ…å ±')">
                                äº¤æ›ç”³è«‹
                            </button>
                        </div>

                        <!-- 2000ptç‰¹å…¸ -->
                        <div class="exchange-option premium-option">
                            <div class="exchange-cost">2000pt</div>
                            <div class="exchange-reward">AIè§£æã«ã‚ˆã‚‹æ€¥ä¸Šæ˜‡ æ¿€èµ°ç©´é¦¬æƒ…å ±</div>
                            <button class="exchange-btn" onclick="requestExchange(2000, 'AIè§£æã«ã‚ˆã‚‹æ€¥ä¸Šæ˜‡ æ¿€èµ°ç©´é¦¬æƒ…å ±')">
                                äº¤æ›ç”³è«‹
                            </button>
                        </div>
                        
                        <!-- 3000ptç‰¹å…¸ -->
                        <div class="exchange-option orange-option">
                            <div class="exchange-cost">3000pt</div>
                            <div class="exchange-reward">å©èˆã®ç™ºå°„ã‚¿ã‚¤ãƒŸãƒ³ã‚°äºˆæ¸¬ã«ã‚ˆã‚‹æ¿€èµ°ç©´é¦¬æƒ…å ±</div>
                            <button class="exchange-btn" onclick="requestExchange(3000, 'å©èˆã®ç™ºå°„ã‚¿ã‚¤ãƒŸãƒ³ã‚°äºˆæ¸¬ã«ã‚ˆã‚‹æ¿€èµ°ç©´é¦¬æƒ…å ±')">
                                äº¤æ›ç”³è«‹
                            </button>
                        </div>
                        
                    </div>
                    
                    <div class="exchange-note">
                        <small>â€» äº¤æ›ç”³è«‹å¾Œã€ç®¡ç†è€…ãŒç¢ºèªå¾Œã«ç‰¹å…¸ã‚’æä¾›ã„ãŸã—ã¾ã™ã€‚</small>
                    </div>
                </div>
            </div>

            <!-- ãƒ—ãƒ©ãƒ³ç®¡ç†ï¼ˆç„¡æ–™ä¼šå“¡ã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="plan-section" class="plan-section" style="display: none;">
                <h2>ğŸ“‹ ãƒ—ãƒ©ãƒ³ç®¡ç†</h2>
                <div class="plan-actions">
                    <a href="/pricing/" class="action-btn upgrade">ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</a>
                    <button id="logout-btn-free" class="action-btn logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </div>

            <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ï¼ˆæœ‰æ–™ä¼šå“¡ã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="logout-section-paid" class="logout-section-paid" style="display: none;">
                <button id="logout-btn-paid" class="action-btn logout-primary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>

            <!-- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ï¼ˆç„¡æ–™ãƒ»Standardä¼šå“¡ã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="upgrade-promotion" class="upgrade-section" style="display: none;">
                <div class="upgrade-card">
                    <h3>ğŸš€ ã•ã‚‰ãªã‚‹æŠ•è³‡åŠ¹ç‡ã‚’ç›®æŒ‡ã—ã¾ã›ã‚“ã‹ï¼Ÿ</h3>
                    <p>ä¸Šä½ãƒ—ãƒ©ãƒ³ã§å…¨ãƒ¬ãƒ¼ã‚¹ã®è©³ç´°äºˆæƒ³ã¨é«˜ç²¾åº¦åˆ†æãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹è²·ã„ç›®ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</p>
                    <a href="/pricing/" class="upgrade-btn">ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ç°¡ç•¥åŒ–ã•ã‚ŒãŸèªè¨¼ã‚·ã‚¹ãƒ†ãƒ  -->
    <script>

        // ç°¡ç•¥åŒ–ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
        function isAuthenticated() {
            const userPlanData = localStorage.getItem('user-plan');
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userPlan = localStorage.getItem('userPlan');
            
            return !!(userPlanData || isLoggedIn || userPlan);
        }
        
        async function getCustomerData() {
            console.log('ğŸ” getCustomerData é–‹å§‹');
            
            // æ–°ã—ã„æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‚’æœ€å„ªå…ˆ
            const userPlanData = localStorage.getItem('user-plan');
            console.log('ğŸ“¦ user-plan ãƒ‡ãƒ¼ã‚¿:', userPlanData);
            
            if (userPlanData) {
                try {
                    const userData = JSON.parse(userPlanData);
                    console.log('ğŸ“‹ è§£æã—ãŸuserData:', userData);
                    
                    // å®Ÿéš›ã®ãƒã‚¤ãƒ³ãƒˆã‚’Functionsã‹ã‚‰å–å¾—
                    console.log('ğŸš€ fetchUserPoints å‘¼ã³å‡ºã—é–‹å§‹:', userData.email);
                    const realPoints = await fetchUserPoints(userData.email);
                    console.log('ğŸ¯ å–å¾—ã—ãŸrealPoints:', realPoints);
                    
                    const result = {
                        email: userData.email,
                        plan: userData.plan || 'free',
                        points: realPoints,
                        hasClaimedReward: localStorage.getItem('hasClaimedReward') === 'true',
                        registrationDate: userData.registeredAt,
                        name: 'ãŠå®¢æ§˜'
                    };
                    console.log('âœ… getCustomerData è¿”å´å€¤:', result);
                    return result;
                } catch (e) {
                    console.warn('user-planè§£æã‚¨ãƒ©ãƒ¼:', e);
                }
            }
            
            // å¤ã„ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const email = localStorage.getItem('userEmail');
            const plan = localStorage.getItem('userPlan') || 'free';
            
            if (email || plan !== 'free') {
                // å®Ÿéš›ã®ãƒã‚¤ãƒ³ãƒˆã‚’Functionsã‹ã‚‰å–å¾—
                const realPoints = await fetchUserPoints(email);
                return {
                    email: email || 'member@example.com',
                    plan: plan,
                    points: realPoints,
                    hasClaimedReward: localStorage.getItem('hasClaimedReward') === 'true',
                    name: 'ãŠå®¢æ§˜'
                };
            }
            
            return null;
        }

        // Functionsã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—ï¼ˆå®Ÿéš›ã®Airtableãƒ‡ãƒ¼ã‚¿å„ªå…ˆï¼‰
        async function fetchUserPoints(email) {
            console.log('ğŸ“ fetchUserPoints å‘¼ã³å‡ºã—:', email);
            if (!email) {
                console.log('âš ï¸ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç©ºã§ã™');
                return 0;
            }
            
            try {
                const functionsUrl = window.location.hostname === 'localhost' 
                    ? 'http://localhost:8888/.netlify/functions/auth-user'
                    : '/.netlify/functions/auth-user';
                
                // auth-user Functionã‚’ä½¿ç”¨ï¼ˆget-user-pointsã¯å‰Šé™¤æ¸ˆã¿ï¼‰
                const response = await fetch(functionsUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });
                
                if (!response.ok) {
                    console.error('ãƒã‚¤ãƒ³ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', response.status);
                    return 0;
                }
                
                const data = await response.json();
                const points = data.user?.points || 0;
                console.log(`ğŸ“Š Airtableã‹ã‚‰å–å¾—: ${points}pt (email: ${email})`);
                return points;
                
            } catch (error) {
                console.error('âš ï¸ ãƒã‚¤ãƒ³ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                console.log('ğŸ”„ ã‚¨ãƒ©ãƒ¼ã®ãŸã‚0ptã‚’è¿”ã—ã¾ã™');
                return 0;
            }
        }

        // ãƒ©ãƒ³ã‚¯å®šç¾© - ã‚ˆã‚Šé•·æœŸçš„ãªé”æˆæ„Ÿã®ã‚ã‚‹è¨­è¨ˆ
        const RANK_THRESHOLDS = {
            ãƒ“ã‚®ãƒŠãƒ¼: { min: 0, max: 199, name: 'ğŸŒ± ãƒ“ã‚®ãƒŠãƒ¼', next: 200 },
            ãƒ–ãƒ­ãƒ³ã‚º: { min: 200, max: 599, name: 'ğŸ¥‰ ãƒ–ãƒ­ãƒ³ã‚º', next: 600 },
            ã‚·ãƒ«ãƒãƒ¼: { min: 600, max: 1199, name: 'ğŸ¥ˆ ã‚·ãƒ«ãƒãƒ¼', next: 1200 },
            ã‚´ãƒ¼ãƒ«ãƒ‰: { min: 1200, max: 2999, name: 'ğŸ¥‡ ã‚´ãƒ¼ãƒ«ãƒ‰', next: 3000 },
            ãƒ—ãƒ©ãƒãƒŠ: { min: 3000, max: 7999, name: 'ğŸ† ãƒ—ãƒ©ãƒãƒŠ', next: 8000 },
            ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: { min: 8000, max: Infinity, name: 'ğŸ’ ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰', next: null }
        };

        // ãƒ©ãƒ³ã‚¯ç‰¹å…¸
        const RANK_BENEFITS = {
            ãƒ“ã‚®ãƒŠãƒ¼: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—'],
            ãƒ–ãƒ­ãƒ³ã‚º: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—', 'æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ'],
            ã‚·ãƒ«ãƒãƒ¼: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—', 'æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ', 'ç‰¹å…¸ç”³è«‹å¯èƒ½'],
            ã‚´ãƒ¼ãƒ«ãƒ‰: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—', 'å„ªå…ˆã‚µãƒãƒ¼ãƒˆ', 'æœˆé–“ãƒ¬ãƒãƒ¼ãƒˆ', 'ç‰¹å…¸ç”³è«‹å¯èƒ½'],
            ãƒ—ãƒ©ãƒãƒŠ: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—', 'å„ªå…ˆã‚µãƒãƒ¼ãƒˆ', 'è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ', 'ç‰¹å…¸ç”³è«‹å¯èƒ½'],
            ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: ['æ¯æ—¥10ãƒã‚¤ãƒ³ãƒˆç²å¾—', 'å€‹åˆ¥AIåˆ†æ', 'VIPã‚µãƒãƒ¼ãƒˆ', 'ç‰¹å…¸ç”³è«‹å¯èƒ½']
        };

        // ç°¡ç•¥åŒ–ã•ã‚ŒãŸãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
        document.getElementById('magic-link-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-input').value;
            const button = document.getElementById('magic-link-btn');
            
            button.disabled = true;
            button.textContent = 'é€ä¿¡ä¸­...';
            
            try {
                // Netlify FunctionsçµŒç”±ã§Airtableã‹ã‚‰æ­£ç¢ºãªãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–ï¼‰
                let response;
                let data;
                
                try {
                    // é–‹ç™ºç’°å¢ƒã§ã¯ç›´æ¥Functions ã‚µãƒ¼ãƒãƒ¼ã‚’å‘¼ã³å‡ºã™
                    const functionsUrl = window.location.hostname === 'localhost' 
                        ? 'http://localhost:8888/.netlify/functions/auth-user'
                        : '/.netlify/functions/auth-user';
                    
                    response = await fetch(functionsUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: email })
                    });
                    
                    if (!response.ok) {
                        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ­ã‚°å‡ºåŠ›
                        const errorText = await response.text();
                        console.error('ğŸš¨ Response error text:', errorText);
                        throw new Error(`Functions error: ${response.status} - ${errorText}`);
                    }
                    
                    data = await response.json();
                } catch (fetchError) {
                    console.error('Functionså‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', fetchError);
                    console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', {
                        message: fetchError.message,
                        stack: fetchError.stack,
                        response: response ? {
                            status: response.status,
                            statusText: response.statusText,
                            url: response.url
                        } : null
                    });
                    
                    // å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    throw new Error(`èªè¨¼APIæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${fetchError.message}`);
                }
                
                if (data.success && data.user) {
                    console.log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ:', data.user);

                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ä¿å­˜
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userEmail', data.user.email);
                    localStorage.setItem('userPlan', data.user.plan);

                    // æœŸé™åˆ‡ã‚Œæƒ…å ±ä¿å­˜
                    if (data.isExpired) {
                        localStorage.setItem('isExpired', 'true');
                        localStorage.setItem('originalPlan', data.user.originalPlan || 'premium');
                        localStorage.setItem('expiryDate', data.user.expiryDate || '');
                    } else {
                        localStorage.removeItem('isExpired');
                        localStorage.removeItem('originalPlan');
                        if (data.user.expiryDate) {
                            localStorage.setItem('expiryDate', data.user.expiryDate);
                        }
                    }

                    const planNames = {
                        'free': 'ç„¡æ–™ä¼šå“¡',
                        'Free': 'ç„¡æ–™ä¼šå“¡',
                        'standard': 'Standardä¼šå“¡',
                        'Standard': 'Standardä¼šå“¡',
                        'premium': 'Premiumä¼šå“¡',
                        'Premium': 'Premiumä¼šå“¡',
                        'expired': 'æœŸé™åˆ‡ã‚Œ' // æœŸé™åˆ‡ã‚Œè¡¨ç¤º
                    };

                    const planDisplayName = planNames[data.user.plan] || data.user.plan;
                    
                    // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ä¿å­˜ï¼ˆç”»é¢åˆ‡ã‚Šæ›¿ãˆå¾Œã«è¡¨ç¤ºç”¨ï¼‰
                    const loginInfo = {
                        planDisplayName: planDisplayName,
                        pointsAdded: data.user.pointsAdded,
                        totalPoints: data.user.points,
                        email: data.user.email
                    };
                    localStorage.setItem('loginInfo', JSON.stringify(loginInfo));
                    
                    // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆä»˜ä¸é€šçŸ¥
                    if (data.user.pointsAdded > 0) {
                        const message = `âœ… ${planDisplayName}ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆ${data.user.pointsAdded}ptç²å¾—`;
                        console.log('æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', message);
                        showSuccess(message);
                        console.log('ãƒã‚¤ãƒ³ãƒˆé€šçŸ¥è¡¨ç¤º:', data.user.pointsAdded);
                        showPointsNotification(data.user.pointsAdded);
                    } else {
                        const message = `âœ… ${planDisplayName}ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼ˆæœ¬æ—¥ã®ãƒã‚¤ãƒ³ãƒˆã¯ä»˜ä¸æ¸ˆã¿ï¼‰`;
                        console.log('æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒã‚¤ãƒ³ãƒˆä»˜ä¸æ¸ˆã¿ï¼‰:', message);
                        showSuccess(message);
                    }
                    
                    document.getElementById('email-input').value = '';
                    
                    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆFunctionsã‹ã‚‰å–å¾—ã—ãŸå®Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
                    const dashboardData = {
                        email: data.user.email,
                        plan: data.user.plan,
                        points: data.user.points,  // Functions ã‹ã‚‰å–å¾—ã—ãŸå®Ÿéš›ã®ãƒã‚¤ãƒ³ãƒˆ
                        hasClaimedReward: localStorage.getItem('hasClaimedReward') === 'true',
                        registrationDate: data.user.registeredAt || data.user.lastLogin,
                        name: 'ãŠå®¢æ§˜'
                    };
                    
                    setTimeout(() => {
                        showDashboard(dashboardData);
                        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°ã®ãŸã‚ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
                        window.dispatchEvent(new Event('storage'));
                    }, 1000);
                } else {
                    throw new Error('Invalid customer data');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                showError(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼å‡¦ç†ï¼ˆç°¡ç•¥åŒ–ï¼‰
        async function handleTokenAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const email = urlParams.get('email');
            
            if (token && email) {
                console.log('ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯èªè¨¼é–‹å§‹:', email);
                
                try {
                    // ç°¡ç•¥åŒ–ã•ã‚ŒãŸèªè¨¼ï¼šãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ãƒ—ãƒ©ãƒ³ã‚’æ¨å®š
                    const mockCustomer = {
                        email: email,
                        plan: email.includes('premium') ? 'premium' : (email.includes('standard') ? 'standard' : 'free'),
                        registrationDate: new Date().toISOString()
                    };
                    
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ä¿å­˜
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userEmail', mockCustomer.email);
                    localStorage.setItem('userPlan', mockCustomer.plan);
                    
                    console.log('èªè¨¼æˆåŠŸ:', mockCustomer);
                    // URLã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                    window.history.replaceState({}, document.title, window.location.pathname);
                    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
                    showDashboard(mockCustomer);
                    
                } catch (error) {
                    console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
                    showError('èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
        function showDashboard(customerData) {
            console.log('ğŸ¨ showDashboard é–‹å§‹, customerData:', customerData);

            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'block';

            // æœŸé™åˆ‡ã‚Œãƒã‚§ãƒƒã‚¯ãƒ»è­¦å‘Šè¡¨ç¤º
            const isExpired = localStorage.getItem('isExpired') === 'true';
            if (isExpired) {
                showExpiryWarning();
            } else {
                document.getElementById('expiry-warning-section').style.display = 'none';
            }

            // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±è¡¨ç¤º
            showLoginInfo();

            // ä¼šå“¡æƒ…å ±è¡¨ç¤º
            updateMembershipInfo(customerData);

            // ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
            console.log('ğŸ¯ updatePointsDisplay å‘¼ã³å‡ºã—, points:', customerData.points);
            updatePointsDisplay(customerData.points, customerData.hasClaimedReward);

            // ãƒ—ãƒ©ãƒ³åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
            showPlanContent(customerData.plan);
        }

        // æœŸé™åˆ‡ã‚Œè­¦å‘Šè¡¨ç¤º
        function showExpiryWarning() {
            const originalPlan = localStorage.getItem('originalPlan') || 'Premium';
            const expiryDate = localStorage.getItem('expiryDate') || 'ä¸æ˜';

            const planNames = {
                'premium': 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ',
                'Premium': 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ',
                'standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰',
                'Standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰'
            };

            document.getElementById('expired-plan-name').textContent = planNames[originalPlan] || originalPlan;
            document.getElementById('expiry-date-display').textContent = expiryDate;
            document.getElementById('expiry-warning-section').style.display = 'block';

            // é€€ä¼šãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šï¼ˆãƒ—ãƒ©ãƒ³åˆ¤å®šä»˜ãï¼‰
            document.getElementById('withdrawal-btn-expired').addEventListener('click', function() {
                const modal = document.getElementById('withdrawalModal');
                const userPlan = localStorage.getItem('userPlan') || '';

                // ç„¡æ–™ä¼šå“¡ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã€æœ‰æ–™ä¼šå“¡ã¯withdrawal-upsellã¸é·ç§»
                if (userPlan.toLowerCase() === 'free') {
                    if (modal) {
                        modal.style.display = 'flex';
                    }
                } else {
                    window.location.href = '/withdrawal-upsell/';
                }
            });
        }

        // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±è¡¨ç¤º
        function showLoginInfo() {
            const loginInfoData = localStorage.getItem('loginInfo');
            if (loginInfoData) {
                try {
                    const loginInfo = JSON.parse(loginInfoData);
                    const loginInfoSection = document.getElementById('login-info-section');
                    const loginInfoMessage = document.getElementById('login-info-message');
                    const loginInfoPoints = document.getElementById('login-info-points');
                    const loginPointsValue = document.getElementById('login-points-value');

                    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š
                    if (loginInfo.pointsAdded > 0) {
                        loginInfoMessage.textContent = `${loginInfo.planDisplayName}ã§ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼`;
                        loginPointsValue.textContent = `+${loginInfo.pointsAdded}pt`;
                        loginInfoPoints.style.display = 'flex';
                    } else {
                        loginInfoMessage.textContent = `${loginInfo.planDisplayName}ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼ˆæœ¬æ—¥ã®ãƒã‚¤ãƒ³ãƒˆã¯ä»˜ä¸æ¸ˆã¿ï¼‰`;
                        loginInfoPoints.style.display = 'none';
                    }

                    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
                    loginInfoSection.style.display = 'block';
                    
                    // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ä¸€åº¦è¡¨ç¤ºã—ãŸã‚‰å‰Šé™¤ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã«å†è¡¨ç¤ºã—ãªã„ãŸã‚ï¼‰
                    localStorage.removeItem('loginInfo');
                    
                } catch (e) {
                    console.error('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã®è§£æã‚¨ãƒ©ãƒ¼:', e);
                }
            }
        }

        // ä¼šå“¡æƒ…å ±æ›´æ–°ï¼ˆçµ±è¨ˆæƒ…å ±ä»˜ãï¼‰
        function updateMembershipInfo(data) {
            const planNames = {
                'free': 'ğŸ ç„¡æ–™ä¼šå“¡',
                'Free': 'ğŸ ç„¡æ–™ä¼šå“¡',
                'standard': 'âš¡ Standardä¼šå“¡',
                'Standard': 'âš¡ Standardä¼šå“¡',
                'premium': 'ğŸ’ Premiumä¼šå“¡',
                'Premium': 'ğŸ’ Premiumä¼šå“¡'
            };
            
            const planIcons = {
                'free': 'ğŸ',
                'Free': 'ğŸ',
                'standard': 'âš¡',
                'Standard': 'âš¡',
                'premium': 'ğŸ’',
                'Premium': 'ğŸ’'
            };
            
            const planBadgeTexts = {
                'free': 'FREE',
                'Free': 'FREE',
                'standard': 'STANDARD',
                'Standard': 'STANDARD',
                'premium': 'PREMIUM',
                'Premium': 'PREMIUM'
            };
            
            // ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            document.getElementById('membership-status').textContent = planNames[data.plan] || 'ğŸ ç„¡æ–™ä¼šå“¡';
            document.getElementById('main-status-icon').textContent = planIcons[data.plan] || 'ğŸ';
            document.getElementById('status-badge').textContent = planBadgeTexts[data.plan] || 'FREE';
            
            let detailsHtml = `
                <div class="member-info-grid">
                    <div class="info-item">
                        <span class="info-label">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
                        <span class="info-value">${data.email}</span>
                    </div>
            `;

            // æ°åè¡¨ç¤º
            if (data.name && data.name !== 'ãŠå®¢æ§˜') {
                detailsHtml += `
                    <div class="info-item">
                        <span class="info-label">ğŸ‘¤ ãŠåå‰</span>
                        <span class="info-value">${data.name}</span>
                    </div>
                `;
            }

            // ç™»éŒ²æ—¥è¡¨ç¤º
            if (data.registrationDate) {
                const regDate = new Date(data.registrationDate);
                detailsHtml += `
                    <div class="info-item">
                        <span class="info-label">ğŸ“… ç™»éŒ²æ—¥</span>
                        <span class="info-value">${regDate.toLocaleDateString('ja-JP')}</span>
                    </div>
                `;
            }

            // æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³è¡¨ç¤º
            const lastLoginDate = data.lastLogin ? new Date(data.lastLogin) : new Date();
            detailsHtml += `
                <div class="info-item">
                    <span class="info-label">ğŸ• æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</span>
                    <span class="info-value">${lastLoginDate.toLocaleDateString('ja-JP')} ${lastLoginDate.toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})}</span>
                </div>
            `;

            detailsHtml += `</div>`;


            document.getElementById('membership-details').innerHTML = detailsHtml;
            
            // ãƒ©ãƒ³ã‚¯è¡¨ç¤ºã®ã¿
            updateCurrentRankDisplay(data.points || 0);
            updateRankGuide(data.points || 0);
            
            // ãƒ—ãƒ©ãƒ³åˆ¥ç‰¹å…¸ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
            const vipCard = document.getElementById('vip-status-card');
            const planCard = document.getElementById('plan-benefits-card');
            
            if (data.plan === 'premium' || data.plan === 'Premium') {
                // Premiumä¼šå“¡ã¯VIPã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                vipCard.style.display = 'block';
                planCard.style.display = 'none';
                updateVipBenefits(data.plan);
            } else if (data.plan === 'standard' || data.plan === 'Standard') {
                // Standardä¼šå“¡ã¯ãƒ—ãƒ©ãƒ³ç‰¹å…¸ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                vipCard.style.display = 'none';
                planCard.style.display = 'block';
                updatePlanBenefits('standard');
            } else {
                // Freeä¼šå“¡ã¯ä¸¡æ–¹éè¡¨ç¤º
                vipCard.style.display = 'none';
                planCard.style.display = 'none';
            }
        }
        
        
        // VIPç‰¹å…¸æ›´æ–°
        function updateVipBenefits(plan) {
            const benefits = {
                standard: [
                    'âš¡ å¾ŒåŠ3ãƒ¬ãƒ¼ã‚¹äºˆæƒ³',
                    'ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿é–²è¦§',
                    'ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³10pt'
                ],
                Standard: [
                    'âš¡ å¾ŒåŠ3ãƒ¬ãƒ¼ã‚¹äºˆæƒ³',
                    'ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿é–²è¦§',
                    'ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³10pt'
                ],
                premium: [
                    'ğŸ’ å…¨ãƒ¬ãƒ¼ã‚¹äºˆæƒ³',
                    'ğŸ† å„ªå…ˆã‚µãƒãƒ¼ãƒˆ',
                    'ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³30pt'
                ],
                Premium: [
                    'ğŸ’ å…¨ãƒ¬ãƒ¼ã‚¹äºˆæƒ³',
                    'ğŸ† å„ªå…ˆã‚µãƒãƒ¼ãƒˆ',
                    'ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³30pt'
                ]
            };
            
            const planBenefits = benefits[plan] || benefits.standard;
            document.getElementById('vip-benefits').innerHTML = planBenefits
                .map(benefit => `<div class="vip-benefit">${benefit}</div>`)
                .join('');
        }
        
        // ãƒ—ãƒ©ãƒ³ç‰¹å…¸æ›´æ–°ï¼ˆStandardç”¨ï¼‰
        function updatePlanBenefits(plan) {
            const benefits = {
                standard: [
                    'ğŸ‡ å¾ŒåŠ3ãƒ¬ãƒ¼ã‚¹äºˆæƒ³',
                    'ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿é–²è¦§',
                    'ğŸ’° ãƒ­ã‚°ã‚¤ãƒ³10pt'
                ]
            };
            
            const planBenefits = benefits[plan] || benefits.standard;
            document.getElementById('plan-benefits').innerHTML = planBenefits
                .map(benefit => `<div class="plan-benefit">${benefit}</div>`)
                .join('');
        }
        
        // ç¾åœ¨ãƒ©ãƒ³ã‚¯è¡¨ç¤ºæ›´æ–°
        function updateCurrentRankDisplay(points) {
            const RANK_INFO = {
                'ãƒ“ã‚®ãƒŠãƒ¼': { icon: 'ğŸŒ±', emoji: 'ğŸŒ±', name: 'ãƒ“ã‚®ãƒŠãƒ¼' },
                'ãƒ–ãƒ­ãƒ³ã‚º': { icon: 'ğŸ¥‰', emoji: 'ğŸ¥‰', name: 'ãƒ–ãƒ­ãƒ³ã‚º' },
                'ã‚·ãƒ«ãƒãƒ¼': { icon: 'ğŸ¥ˆ', emoji: 'ğŸ¥ˆ', name: 'ã‚·ãƒ«ãƒãƒ¼' },
                'ã‚´ãƒ¼ãƒ«ãƒ‰': { icon: 'ğŸ¥‡', emoji: 'ğŸ¥‡', name: 'ã‚´ãƒ¼ãƒ«ãƒ‰' },
                'ãƒ—ãƒ©ãƒãƒŠ': { icon: 'ğŸ†', emoji: 'ğŸ†', name: 'ãƒ—ãƒ©ãƒãƒŠ' },
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': { icon: 'ğŸ’', emoji: 'ğŸ’', name: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰' }
            };
            
            // ãƒ©ãƒ³ã‚¯åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¨åŒã˜ã‚‚ã®ã‚’ä½¿ç”¨
            let currentRankKey = 'ãƒ“ã‚®ãƒŠãƒ¼';
            for (const [key, threshold] of Object.entries(RANK_THRESHOLDS)) {
                if (points >= threshold.min && points <= threshold.max) {
                    currentRankKey = key;
                    break;
                }
            }

        }
        
        // ğŸ›¡ï¸ å®‰å®šåŒ–: å˜ä¸€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼åˆæœŸåŒ–
        function initializeProgressBar() {
            console.log('ğŸš€ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼åˆæœŸåŒ–é–‹å§‹');

            // å®‰å®šåŒ–: 1å›ã®ã¿å®Ÿè¡Œã§ç«¶åˆã‚’é˜²ã
            setTimeout(() => {
                const pointsElement = document.getElementById('current-points');
                if (pointsElement) {
                    const actualPoints = parseInt(pointsElement.textContent) || 0; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‰Šé™¤
                    console.log('ğŸ¯ å®Ÿéš›ã®ãƒã‚¤ãƒ³ãƒˆå€¤:', actualPoints, 'textContent:', pointsElement.textContent);
                    if (actualPoints > 0) {
                        console.log('ğŸ”„ initializeProgressBar ã‹ã‚‰ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°:', actualPoints);
                        updateSimpleProgress(actualPoints);
                    } else {
                        console.warn('âš ï¸ ãƒã‚¤ãƒ³ãƒˆå€¤ãŒ0ã¾ãŸã¯ç„¡åŠ¹:', pointsElement.textContent);
                        // âš ï¸ ãƒ‡ãƒãƒƒã‚°: 0ã®å ´åˆã§ã‚‚sipmle progressã‚’åˆæœŸåŒ–
                        console.log('ğŸ”§ ãƒ‡ãƒãƒƒã‚°: 0ptã§ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹åˆæœŸåŒ–');
                        updateSimpleProgress(0);
                    }
                } else {
                    console.error('âŒ current-pointsè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            }, 1000); // é…å»¶ã‚’1000msã«å»¶é•·ã—ã¦DOMæ›´æ–°ã‚’å¾…ã¤

            // ğŸ”§ å®šæœŸçš„ãªã‚·ãƒ³ã‚¯ç¢ºèª: ãƒ¡ã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤ºã¨åŒæœŸ
            setInterval(() => {
                const pointsElement = document.getElementById('current-points');
                const simplePointsElement = document.getElementById('current-points-simple');
                if (pointsElement && simplePointsElement) {
                    const mainPoints = parseInt(pointsElement.textContent) || 0;
                    const simplePoints = parseInt(simplePointsElement.textContent) || 0;

                    if (mainPoints !== simplePoints && mainPoints > 0) {
                        console.log(`ğŸ”§ ã‚·ãƒ³ã‚¯ä¿®æ­£: ãƒ¡ã‚¤ãƒ³${mainPoints}pt â†’ ã‚·ãƒ³ãƒ—ãƒ«${simplePoints}pt ã‚’åŒæœŸ`);
                        updateSimpleProgress(mainPoints);
                    }
                }
            }, 2000); // 2ç§’ã”ã¨ã«åŒæœŸãƒã‚§ãƒƒã‚¯
        }

        // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: æ—¢å­˜ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ›´æ–°é–¢æ•°
        function updateExistingSegment(currentSegmentIndex, goals, points) {
            const defaultProgressFill = document.getElementById('default-progress-fill');
            const defaultProgressText = document.getElementById('default-progress-text');

            // å®‰å…¨ãªæ•°å€¤å¤‰æ›
            const numericPoints = typeof points === 'number' ? points : parseInt(points) || 0;

            if (defaultProgressFill && defaultProgressText && currentSegmentIndex >= 0) {
                // ğŸ”§ æ ¹æœ¬ä¿®æ­£: æ­£ã—ã„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¤å®šã¨ç›®æ¨™è¨ˆç®—
                let targetGoal, actualProgress;

                if (currentSegmentIndex >= goals.length) {
                    // å…¨ç›®æ¨™é”æˆæ¸ˆã¿
                    targetGoal = goals[goals.length - 1];
                    actualProgress = 100;
                } else {
                    // ç¾åœ¨é€²è¡Œä¸­ã®ç›®æ¨™
                    targetGoal = goals[currentSegmentIndex];
                    const prevGoal = currentSegmentIndex === 0 ? 0 : goals[currentSegmentIndex - 1].points;
                    actualProgress = ((numericPoints - prevGoal) / (targetGoal.points - prevGoal)) * 100;
                }

                const progress = Math.max(0, Math.min(100, actualProgress));
                console.log('ğŸ” æ ¹æœ¬ä¿®æ­£å¾Œè¨ˆç®—:', {
                    rawPoints: points,
                    numericPoints: numericPoints,
                    pointsType: typeof points,
                    currentSegmentIndex: currentSegmentIndex,
                    targetGoalPoints: targetGoal.points,
                    prevGoalPoints: currentSegmentIndex === 0 ? 0 : goals[currentSegmentIndex - 1]?.points,
                    calculation: `(${numericPoints} - ${currentSegmentIndex === 0 ? 0 : goals[currentSegmentIndex - 1]?.points}) / (${targetGoal.points} - ${currentSegmentIndex === 0 ? 0 : goals[currentSegmentIndex - 1]?.points}) * 100`,
                    actualProgress,
                    finalProgress: progress,
                    roundedProgress: Math.round(progress)
                });
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°ï¼ˆ100%è¶…éæ™‚ã¯100%ã«åˆ¶é™ï¼‰
                defaultProgressFill.style.width = Math.max(1, Math.min(100, progress)) + '%';
                defaultProgressText.textContent = Math.round(progress) + '%';

                // ğŸ†• ç›®æ¨™ãƒ†ã‚­ã‚¹ãƒˆã®å‹•çš„æ›´æ–°
                const defaultSegmentTitle = document.querySelector('#default-segment .segment-title');
                if (defaultSegmentTitle) {
                    defaultSegmentTitle.textContent = `ç›®æ¨™: ${targetGoal.points}pt`;
                    console.log('ğŸ¯ ç›®æ¨™ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°:', `ç›®æ¨™: ${targetGoal.points}pt`);
                }

                console.log('ğŸ”„ æ—¢å­˜ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ›´æ–°æˆåŠŸ:', Math.round(progress) + '%');
                console.log('ğŸ¯ æœ€çµ‚è¡¨ç¤ºå€¤:', defaultProgressText.textContent, 'ãƒãƒ¼å¹…:', defaultProgressFill.style.width);
                return true; // æ›´æ–°æˆåŠŸ
            }

            console.log('âš ï¸ æ—¢å­˜ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å¯¾è±¡å¤–ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ');
            return false; // æ›´æ–°å¤±æ•—
        }

        // ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°é–¢æ•°ï¼ˆå¾©æ´»é˜²æ­¢å¯¾ç­–ï¼‰
        function updateSimpleProgress(points) {
            console.log('ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°é–‹å§‹:', { points, type: typeof points });

            const goals = [
                { points: 1000, emoji: 'ğŸ¯' },
                { points: 2000, emoji: 'âš¡' },
                { points: 3000, emoji: 'ğŸ†' }
            ];

            // å®‰å…¨ãªæ•°å€¤å¤‰æ›
            const numericPoints = typeof points === 'number' ? points : parseInt(points) || 0;

            // è¦ç´ å–å¾—
            const currentPointsEl = document.getElementById('current-points-simple');
            const targetPointsEl = document.getElementById('target-points-simple');
            const remainingPointsEl = document.getElementById('remaining-points-simple');
            const progressFillEl = document.getElementById('simple-progress-fill');

            if (!currentPointsEl || !targetPointsEl || !remainingPointsEl || !progressFillEl) {
                console.error('âŒ ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            // ç¾åœ¨ã®ç›®æ¨™ã‚’æ±ºå®š
            let targetGoal = goals[0]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1000pt
            let prevGoal = 0;

            for (let i = 0; i < goals.length; i++) {
                if (numericPoints < goals[i].points) {
                    targetGoal = goals[i];
                    prevGoal = i === 0 ? 0 : goals[i - 1].points;
                    break;
                } else if (i === goals.length - 1) {
                    // å…¨ç›®æ¨™é”æˆ
                    targetGoal = goals[goals.length - 1];
                    prevGoal = goals[goals.length - 1].points;
                    break;
                }
            }

            // æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
            const remainingPoints = Math.max(0, targetGoal.points - numericPoints);

            // é€²è¡Œåº¦è¨ˆç®—
            let progressPercent = 0;
            if (numericPoints >= targetGoal.points) {
                progressPercent = 100; // å…¨é”æˆ
            } else {
                progressPercent = ((numericPoints - prevGoal) / (targetGoal.points - prevGoal)) * 100;
            }

            // è¡¨ç¤ºæ›´æ–°
            currentPointsEl.textContent = numericPoints;
            targetPointsEl.textContent = targetGoal.points;
            remainingPointsEl.textContent = remainingPoints;
            progressFillEl.style.width = Math.max(1, Math.min(100, progressPercent)) + '%';

            console.log('âœ… ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°å®Œäº†:', {
                ç¾åœ¨: numericPoints,
                ç›®æ¨™: targetGoal.points,
                æ®‹ã‚Š: remainingPoints,
                é€²è¡Œåº¦: progressPercent + '%'
            });
        }

        // æ—§è¤‡é›‘é–¢æ•°ï¼ˆéä½¿ç”¨ï¼‰
        function updateProgressSegments(points) {
            // å®‰å…¨ãªæ•°å€¤å¤‰æ›
            const numericPoints = typeof points === 'number' ? points : parseInt(points) || 0;
            console.log('ğŸ¯ updateProgressSegments å‘¼ã³å‡ºã—:', { original: points, converted: numericPoints, type: typeof points });

            const goals = [
                { points: 1000, reward: '', emoji: 'ğŸ¯' },
                { points: 2000, reward: '', emoji: 'âš¡' },
                { points: 3000, reward: '', emoji: 'ğŸ†' }
            ];

            const container = document.getElementById('dynamic-segments');
            console.log('ğŸ“¦ ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ :', container);
            if (!container) {
                console.error('âŒ dynamic-segments è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            // ç¾åœ¨ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æ±ºå®š
            let currentSegmentIndex = 0;
            for (let i = 0; i < goals.length; i++) {
                if (numericPoints < goals[i].points) {
                    currentSegmentIndex = i;
                    break;
                } else if (i === goals.length - 1) {
                    currentSegmentIndex = goals.length; // å…¨é”æˆ
                    break;
                }
            }

            // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆHTMLã‚’ç”Ÿæˆ
            let segmentHTML = '';

            if (currentSegmentIndex < goals.length) {
                // ç¾åœ¨é€²è¡Œä¸­ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
                const currentGoal = goals[currentSegmentIndex];
                const prevGoal = currentSegmentIndex === 0 ? 0 : goals[currentSegmentIndex - 1].points;
                const progress = ((numericPoints - prevGoal) / (currentGoal.points - prevGoal)) * 100;

                console.log('ğŸ” ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¨ˆç®—:', {
                    points: numericPoints,
                    currentSegmentIndex,
                    currentGoal: currentGoal.points,
                    prevGoal,
                    progress: Math.round(progress)
                });

                segmentHTML = `
                    <div class="segment-item current-segment">
                        <div class="segment-header">
                            <div class="segment-left">
                                <span class="segment-emoji">${currentGoal.emoji}</span>
                                <span class="segment-title">ç›®æ¨™: ${currentGoal.points}pt</span>
                            </div>
                            <span class="segment-progress">${Math.round(progress)}%</span>
                        </div>
                        <div class="segment-bar">
                            <div class="segment-fill" style="width: ${Math.max(1, progress)}%; background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);"></div>
                        </div>
                    </div>
                `;

                // é”æˆæ¸ˆã¿ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚‚å°ã•ãè¡¨ç¤º
                for (let i = 0; i < currentSegmentIndex; i++) {
                    const achievedGoal = goals[i];
                    segmentHTML = `
                        <div class="segment-item achieved-segment">
                            <div class="segment-header">
                                <span class="segment-emoji">âœ…</span>
                                <span class="segment-title">${achievedGoal.points}pt é”æˆæ¸ˆã¿</span>
                            </div>
                            <div class="segment-reward-small">${achievedGoal.reward}</div>
                        </div>
                    ` + segmentHTML;
                }
            } else {
                // å…¨ç›®æ¨™é”æˆ
                segmentHTML = `
                    <div class="segment-item completed-all">
                        <div class="segment-header">
                            <span class="segment-emoji">ğŸ‰</span>
                            <span class="segment-title">å…¨ç›®æ¨™é”æˆï¼</span>
                        </div>
                        <div class="segment-label">
                            <span class="segment-reward">ã™ã¹ã¦ã®ç‰¹å…¸ãŒåˆ©ç”¨å¯èƒ½ã§ã™</span>
                        </div>
                    </div>
                `;
            }

            // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: æ—¢å­˜è¦ç´ ã‚’å„ªå…ˆæ›´æ–°ï¼ˆinnerHTMLä¸Šæ›¸ãé˜²æ­¢ï¼‰
            const existingUpdated = updateExistingSegment(currentSegmentIndex, goals, numericPoints);

            if (!existingUpdated && segmentHTML.trim()) {
                // æ—¢å­˜æ›´æ–°ãŒã§ããªã‹ã£ãŸå ´åˆã®ã¿æ–°HTMLã‚’è¨­å®š
                container.innerHTML = segmentHTML;
                console.log('ğŸ“Š æ–°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆHTMLè¨­å®š:', segmentHTML.substring(0, 200) + '...');
            } else if (existingUpdated) {
                console.log('âœ… æ—¢å­˜ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ›´æ–°ã§å‡¦ç†å®Œäº†');
            } else {
                console.warn('âš ï¸ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ›´æ–°å¤±æ•—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã‚’ç¶­æŒ');
            }

            // æ¬¡ã®ç›®æ¨™ã¾ã§ã®æƒ…å ±æ›´æ–°å‡¦ç†ã¯å‰Šé™¤ï¼ˆUIè¦ç´ ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ï¼‰
        }

        // ãƒ©ãƒ³ã‚¯ç›®å®‰ã‚¬ã‚¤ãƒ‰æ›´æ–°
        function updateRankGuide(currentPoints) {
            const rankItems = document.querySelectorAll('.rank-item');
            
            // ç¾åœ¨ãƒ©ãƒ³ã‚¯ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            let currentRankKey = 'ãƒ“ã‚®ãƒŠãƒ¼';
            for (const [key, threshold] of Object.entries(RANK_THRESHOLDS)) {
                if (currentPoints >= threshold.min && currentPoints <= threshold.max) {
                    currentRankKey = key;
                    break;
                }
            }
            
            // ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ãƒ†ãƒ ã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¨­å®š
            rankItems.forEach((item, index) => {
                const rankNames = ['ãƒ“ã‚®ãƒŠãƒ¼', 'ãƒ–ãƒ­ãƒ³ã‚º', 'ã‚·ãƒ«ãƒãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‰', 'ãƒ—ãƒ©ãƒãƒŠ', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰'];
                
                if (rankNames[index] === currentRankKey) {
                    item.classList.add('current');
                } else {
                    item.classList.remove('current');
                }
            });
        }

        // ãƒã‚¤ãƒ³ãƒˆç²å¾—é€šçŸ¥è¡¨ç¤º
        function showPointsNotification(points) {
            console.log('showPointsNotification å‘¼ã³å‡ºã—:', points);
            const notification = document.createElement('div');
            notification.className = 'points-notification';
            notification.innerHTML = `
                <div class="notification-content">
                    ğŸ† ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼
                    <span class="points-added">+${points}pt</span>
                </div>
            `;
            document.body.appendChild(notification);
            console.log('ãƒã‚¤ãƒ³ãƒˆé€šçŸ¥ã‚’DOMã«è¿½åŠ :', notification);
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«å‰Šé™¤
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        
        // ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤ºæ›´æ–°ï¼ˆå°„å¹¸å¿ƒã‚’ç…½ã‚‹æ¼”å‡ºä»˜ãï¼‰
        function updatePointsDisplay(points, hasClaimedReward = false) {
            console.log('ğŸ¯ updatePointsDisplayé–‹å§‹ - å—ã‘å–ã£ãŸpoints:', points, typeof points);

            // ãƒã‚¤ãƒ³ãƒˆæ•°ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§è¡¨ç¤º
            animatePointsDisplay(points);

            // ğŸ”¥ å®Ÿéš›ã®ãƒã‚¤ãƒ³ãƒˆå€¤ã§ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
            console.log('ğŸ”„ ãƒã‚¤ãƒ³ãƒˆå€¤ã§ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°:', points);
            updateSimpleProgress(points);

            // ãƒ©ãƒ³ã‚¯åˆ¤å®š
            let currentRankKey = 'ãƒ“ã‚®ãƒŠãƒ¼';
            for (const [key, threshold] of Object.entries(RANK_THRESHOLDS)) {
                if (points >= threshold.min && points <= threshold.max) {
                    currentRankKey = key;
                    break;
                }
            }
            
            
        }

        // ãƒã‚¤ãƒ³ãƒˆæ•°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
        function animatePointsDisplay(targetPoints) {
            const pointsElement = document.getElementById('current-points');
            const currentPoints = parseInt(pointsElement.textContent) || 0;
            const duration = 1500; // 1.5ç§’
            const steps = 30;
            const increment = (targetPoints - currentPoints) / steps;
            
            let step = 0;
            const timer = setInterval(() => {
                step++;
                const currentValue = currentPoints + (increment * step);
                const roundedValue = Math.round(currentValue);
                pointsElement.textContent = roundedValue;
                // ğŸ”§ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                updateSimpleProgress(roundedValue);
                
                if (step >= steps) {
                    clearInterval(timer);
                    pointsElement.textContent = targetPoints;
                    // ğŸ”§ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ã«ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹åŒæœŸ
                    console.log('ğŸ”§ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†: ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°', targetPoints);
                    updateSimpleProgress(targetPoints);
                    // å®Œäº†æ™‚ã«ã‚­ãƒ©ã‚­ãƒ©æ¼”å‡º
                    pointsElement.classList.add('points-sparkle');
                    setTimeout(() => {
                        pointsElement.classList.remove('points-sparkle');
                    }, 1000);
                }
            }, duration / steps);
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function animateProgressBar(progressElement, targetProgress) {
            const currentWidth = parseFloat(progressElement.style.width) || 0;
            const duration = 1200; // 1.2ç§’
            const steps = 24;
            const increment = (targetProgress - currentWidth) / steps;
            
            let step = 0;
            const timer = setInterval(() => {
                step++;
                const currentValue = currentWidth + (increment * step);
                progressElement.style.width = `${currentValue}%`;
                
                if (step >= steps) {
                    clearInterval(timer);
                    progressElement.style.width = `${targetProgress}%`;
                }
            }, duration / steps);
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è‰²æ›´æ–°ï¼ˆé€²æ—ã«å¿œã˜ã¦ï¼‰
        function updateProgressBarColor(progressElement, progress, rankKey) {
            progressElement.classList.remove(
                'progress-bronze', 'progress-silver', 'progress-gold', 
                'progress-platinum', 'progress-diamond', 'progress-max'
            );
            
            if (progress >= 90) {
                progressElement.classList.add('progress-max');
            } else if (rankKey === 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰') {
                progressElement.classList.add('progress-diamond');
            } else if (rankKey === 'ãƒ—ãƒ©ãƒãƒŠ') {
                progressElement.classList.add('progress-platinum');
            } else if (rankKey === 'ã‚´ãƒ¼ãƒ«ãƒ‰') {
                progressElement.classList.add('progress-gold');
            } else if (rankKey === 'ã‚·ãƒ«ãƒãƒ¼') {
                progressElement.classList.add('progress-silver');
            } else {
                progressElement.classList.add('progress-bronze');
            }
        }

        // ãƒ—ãƒ©ãƒ³åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
        function showPlanContent(plan) {
            console.log('showPlanContent å‘¼ã³å‡ºã—:', plan);
            
            const planLower = (plan || '').toLowerCase();
            
            // ç„¡æ–™äºˆæƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            if (planLower === 'free' || planLower === '' || !planLower) {
                console.log('ç„¡æ–™äºˆæƒ³ã‚’è¡¨ç¤ºï¼ˆFreeä¼šå“¡ï¼‰');
                document.getElementById('free-predictions').style.display = 'block';
            } else {
                console.log('ç„¡æ–™äºˆæƒ³ã‚’éè¡¨ç¤ºï¼ˆæœ‰æ–™ä¼šå“¡ï¼‰');
                document.getElementById('free-predictions').style.display = 'none';
            }
            
            // Standardäºˆæƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆStandardä¼šå“¡ã®ã¿ï¼‰
            if (planLower === 'standard') {
                console.log('Standardäºˆæƒ³ã‚’è¡¨ç¤º');
                document.getElementById('standard-predictions').style.display = 'block';
            } else {
                console.log('Standardäºˆæƒ³ã‚’éè¡¨ç¤º');
                document.getElementById('standard-predictions').style.display = 'none';
            }
            
            // Premiumäºˆæƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            if (planLower === 'premium') {
                console.log('Premiumäºˆæƒ³ã‚’è¡¨ç¤º');
                document.getElementById('premium-predictions').style.display = 'block';
            }
            
            // ãƒ—ãƒ©ãƒ³ç®¡ç†ã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆç„¡æ–™ä¼šå“¡ã®ã¿ï¼‰
            if (planLower === 'free') {
                console.log('ãƒ—ãƒ©ãƒ³ç®¡ç†ã‚’è¡¨ç¤ºï¼ˆç„¡æ–™ä¼šå“¡ï¼‰');
                document.getElementById('plan-section').style.display = 'block';
            } else {
                // æœ‰æ–™ä¼šå“¡ã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
                console.log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆæœ‰æ–™ä¼šå“¡ï¼‰');
                document.getElementById('logout-section-paid').style.display = 'block';
            }

            // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ã®è¡¨ç¤ºåˆ¶å¾¡
            if (planLower !== 'premium') {
                console.log('ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€²ã‚’è¡¨ç¤º');
                document.getElementById('upgrade-promotion').style.display = 'block';
            }
        }

        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSuccess(message) {
            console.log('showSuccess å‘¼ã³å‡ºã—:', message);
            const successEl = document.getElementById('success-message');
            console.log('success-message è¦ç´ :', successEl);
            if (successEl) {
                successEl.textContent = message;
                successEl.style.display = 'block';
                console.log('æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ¸ˆã¿');
                setTimeout(() => {
                    successEl.style.display = 'none';
                }, 10000);
            } else {
                console.error('success-message è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        // ç‰¹å…¸ç”³è«‹ï¼ˆç°¡ç•¥åŒ–ï¼‰
        document.getElementById('claim-reward-btn')?.addEventListener('click', async () => {
            const customer = getCustomerData();
            if (!customer || !customer.email) {
                showError('ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“');
                return;
            }
            
            if (confirm('ç‰¹å…¸ã‚’ç”³è«‹ã—ã¾ã™ã‹ï¼Ÿ\n\nç”³è«‹å¾Œã¯å–ã‚Šæ¶ˆã—ã§ãã¾ã›ã‚“ã€‚')) {
                const button = document.getElementById('claim-reward-btn');
                button.disabled = true;
                button.textContent = 'ç”³è«‹ä¸­...';
                
                try {
                    // ç°¡ç•¥åŒ–ï¼šãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†
                    setTimeout(() => {
                        button.textContent = 'âœ… ç”³è«‹æ¸ˆã¿';
                        button.style.background = '#64748b';
                        alert('ç‰¹å…¸ç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼\n3å–¶æ¥­æ—¥ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«ã§ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚');
                        
                        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ç”³è«‹æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ä¿å­˜
                        localStorage.setItem('hasClaimedReward', 'true');
                    }, 1000);
                    
                } catch (error) {
                    console.error('ç‰¹å…¸ç”³è«‹ã‚¨ãƒ©ãƒ¼:', error);
                    button.disabled = false;
                    button.textContent = 'ğŸ ç‰¹å…¸ã‚’ç”³è«‹ã™ã‚‹';
                    alert('ç”³è«‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            }
        });

        // ãƒã‚¤ãƒ³ãƒˆäº¤æ›ç”³è«‹é–¢æ•°
        window.requestExchange = async function(requiredPoints, rewardName) {
            const customer = await getCustomerData();
            
            if (!customer || !customer.email) {
                alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                return;
            }
            
            if (customer.points < requiredPoints) {
                alert(`ãƒã‚¤ãƒ³ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚\nå¿…è¦: ${requiredPoints}pt\nç¾åœ¨: ${customer.points}pt`);
                return;
            }
            
            const subject = `ãƒã‚¤ãƒ³ãƒˆäº¤æ›ç”³è«‹: ${rewardName}`;
            const body = `
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${customer.email}
ãƒ—ãƒ©ãƒ³: ${customer.plan}
ç”³è«‹: ${requiredPoints}pt â†’ ${rewardName}
ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆ: ${customer.points}pt
ç”³è«‹æ—¥æ™‚: ${new Date().toLocaleString()}

â€»ã“ã®ç”³è«‹ã¯è‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã—ãŸã€‚ç®¡ç†è€…ãŒç¢ºèªå¾Œã«ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚
            `.trim();
            
            // ãƒ¡ãƒ¼ãƒ«ç”³è«‹ã‚’é–‹ã
            window.location.href = `mailto:support@keiba.link?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        };

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆç°¡ç•¥åŒ–ï¼‰
        window.logout = function() {
            // å…¨ã¦ã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
            localStorage.removeItem('user-plan');
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userPlan');
            localStorage.removeItem('userData');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('hasClaimedReward');
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
            window.dispatchEvent(new CustomEvent('userLoggedOut'));
            
            // ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            setTimeout(() => {
                window.location.href = '/';
            }, 500);
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–ï¼ˆç°¡ç•¥åŒ–ï¼‰
        document.addEventListener('DOMContentLoaded', async () => {
            // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å³åº§ã«åˆæœŸåŒ–
            initializeProgressBar();

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆç„¡æ–™ä¼šå“¡ç”¨ï¼‰
            const logoutBtnFree = document.getElementById('logout-btn-free');
            if (logoutBtnFree) {
                logoutBtnFree.addEventListener('click', () => {
                    logout();
                });
            }

            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆæœ‰æ–™ä¼šå“¡ç”¨ï¼‰
            const logoutBtnPaid = document.getElementById('logout-btn-paid');
            if (logoutBtnPaid) {
                logoutBtnPaid.addEventListener('click', () => {
                    logout();
                });
            }
            
            // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
            const loginInfoCloseBtn = document.getElementById('login-info-close');
            if (loginInfoCloseBtn) {
                loginInfoCloseBtn.addEventListener('click', () => {
                    document.getElementById('login-info-section').style.display = 'none';
                });
            }
            
            // ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯èªè¨¼ãƒã‚§ãƒƒã‚¯
            await handleTokenAuth();
            
            // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
            console.log('ğŸ” èªè¨¼ãƒã‚§ãƒƒã‚¯é–‹å§‹');
            if (isAuthenticated()) {
                console.log('âœ… èªè¨¼æ¸ˆã¿ã€é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹');
                const customer = await getCustomerData();
                console.log('ğŸ‘¤ å–å¾—ã—ãŸé¡§å®¢ãƒ‡ãƒ¼ã‚¿:', customer);
                if (customer) {
                    console.log('ğŸ¨ showDashboard å®Ÿè¡Œ');
                    showDashboard(customer);
                } else {
                    console.log('âš ï¸ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒnull');
                }
            } else {
                console.log('âŒ æœªèªè¨¼');
            }
        });

    </script>

    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .dashboard-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .login-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 1rem;
            padding: 2.5rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            max-width: 400px;
            width: 100%;
        }

        .login-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .login-card p {
            color: #94a3b8;
            text-align: center;
            margin-bottom: 2rem;
        }

        .email-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            color: #e2e8f0;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .email-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .submit-btn {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
        }

        .new-user-notice {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            text-align: center;
        }

        .new-user-notice p {
            margin: 0.25rem 0;
        }

        .new-user-notice .link {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 600;
        }

        .new-user-notice .link:hover {
            color: #60a5fa;
            text-decoration: underline;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
        }

        /* ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .login-info-section {
            margin-bottom: 2rem;
            /* animation: slideInFromTop 0.5s ease; */
        }

        .login-info-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .login-info-icon {
            font-size: 2rem;
        }

        .login-info-content {
            flex: 1;
        }

        .login-info-content h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
        }

        .login-info-message {
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .login-info-points {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .points-icon {
            font-size: 1.2rem;
        }

        .points-value {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .close-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @keyframes slideInFromTop {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .status-section {
            margin-bottom: 2rem;
        }

        .status-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .status-icon {
            font-size: 3rem;
        }

        .status-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #3b82f6;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .status-details {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .email {
            margin-bottom: 0.25rem;
        }

        .expires {
            font-size: 0.85rem;
            color: #10b981;
        }

        /* ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚°ãƒªãƒƒãƒ‰ */
        .status-section {
            margin-bottom: 2rem;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            align-items: stretch;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .main-status {
            grid-column: 1;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* ãƒ—ãƒ©ãƒ³ç‰¹å…¸ã‚«ãƒ¼ãƒ‰ */

        .plan-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .plan-icon {
            font-size: 1.5rem;
        }

        .plan-header h3 {
            color: #10b981;
            font-size: 1.1rem;
            margin: 0;
        }

        .benefits-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .benefit-item, .plan-benefit {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 0.5rem;
            font-size: 0.9rem;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }
        
        .main-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%);
            /* animation: status-shine 4s infinite; */
        }
        
        @keyframes status-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .status-icon {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 8px rgba(59, 130, 246, 0.3));
        }
        
        .status-badge {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #3b82f6;
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .status-details {
            font-size: 0.9rem;
            color: #94a3b8;
            line-height: 1.5;
        }

        /* ä¼šå“¡æƒ…å ±ã‚°ãƒªãƒƒãƒ‰ */
        .member-info-grid {
            display: grid;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .info-item {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.75rem;
            align-items: center;
            padding: 0.5rem;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 0.5rem;
            border-left: 3px solid rgba(59, 130, 246, 0.4);
        }

        .info-label {
            font-size: 0.85rem;
            color: #94a3b8;
            font-weight: 500;
            white-space: nowrap;
        }

        .info-value {
            font-size: 0.9rem;
            color: #e2e8f0;
            font-weight: 400;
            text-align: right;
        }
        
        /* ãƒ©ãƒ³ã‚¯è¡¨ç¤ºã®ã¿ */
        .rank-display-only {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .rank-card-main {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .rank-card-main:hover {
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .rank-icon-large {
            font-size: 2.5rem;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.4));
        }

        .rank-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .rank-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #e2e8f0;
        }

        .rank-label {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .mini-stat-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 1px 3px rgba(59, 130, 246, 0.2));
        }
        
        .mini-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 0.2rem;
        }
        
        .mini-stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            line-height: 1;
        }
        
        /* VIPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ */
        .vip-status-card {
            grid-column: 2;
            grid-row: 1;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.1) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 1rem;
            min-height: 200px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .vip-status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.1) 50%, transparent 100%);
            /* animation: vip-shine 3s infinite; */
        }
        
        @keyframes vip-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .vip-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .vip-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(255, 215, 0, 0.3));
        }
        
        .vip-title {
            color: #fbbf24;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .vip-benefits {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .vip-benefit {
            font-size: 0.85rem;
            color: #fbbf24;
            background: rgba(255, 215, 0, 0.1);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border-left: 3px solid #fbbf24;
        }
        
        /* ãƒ—ãƒ©ãƒ³ç‰¹å…¸ã‚«ãƒ¼ãƒ‰ï¼ˆStandard/Freeç”¨ï¼‰ */
        .plan-benefits-card {
            grid-column: 2;
            grid-row: 1;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 1rem;
            min-height: 200px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .plan-benefits-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(16, 185, 129, 0.1) 50%, transparent 100%);
            /* animation: plan-shine 3s infinite; */
        }
        
        @keyframes plan-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .plan-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .plan-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(16, 185, 129, 0.3));
        }
        
        .plan-title {
            color: #10b981;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .plan-benefits {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .plan-benefit {
            font-size: 0.85rem;
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border-left: 3px solid #10b981;
        }
        
        /* ãƒ©ãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ç‰¹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
        .rank-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
        }
        
        .rank-card:hover {
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }
        
        /* ãƒ©ãƒ³ã‚¯ç›®å®‰ã‚«ãƒ¼ãƒ‰ */
        .rank-guide-card {
            grid-column: 1 / 3;
            grid-row: 3;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .rank-guide-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(99, 102, 241, 0.1) 50%, transparent 100%);
            /* animation: rank-shine 4s infinite; */
        }
        
        @keyframes rank-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .rank-guide-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .rank-guide-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.3));
        }
        
        .rank-guide-title {
            color: #6366f1;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .rank-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        
        @media (max-width: 480px) {
            .rank-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .rank-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(99, 102, 241, 0.05);
            border-radius: 0.5rem;
            border: 1px solid rgba(99, 102, 241, 0.1);
            transition: all 0.3s ease;
        }
        
        .rank-item:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.2);
            transform: translateY(-1px);
        }
        
        .rank-item.current {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 2px solid #6366f1;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }
        
        .rank-badge {
            font-size: 1.2rem;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }
        
        .rank-badge.beginner { background: rgba(34, 197, 94, 0.2); }
        .rank-badge.bronze { background: rgba(205, 127, 50, 0.2); }
        .rank-badge.silver { background: rgba(192, 192, 192, 0.2); }
        .rank-badge.gold { background: rgba(255, 215, 0, 0.2); }
        .rank-badge.platinum { background: rgba(229, 228, 226, 0.2); }
        .rank-badge.diamond { background: rgba(0, 191, 255, 0.2); }
        
        .rank-info {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }
        
        .rank-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .rank-requirement {
            font-size: 0.7rem;
            color: #94a3b8;
        }
        
        .email {
            margin-bottom: 0.25rem;
        }
        
        .expires {
            font-size: 0.85rem;
            color: #10b981;
        }

        /* ãƒã‚¤ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .points-section {
            margin-bottom: 2rem;
        }

        .points-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.1);
        }

        .points-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .points-header h2 {
            font-size: 1.5rem;
            margin: 0;
            color: #fbbf24;
            text-shadow: 0 2px 4px rgba(251, 191, 36, 0.3);
        }

        .points-value {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        #current-points {
            font-size: 2rem;
            font-weight: 600;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .points-unit {
            font-size: 1.25rem;
            color: #94a3b8;
            font-weight: 400;
        }

        .points-progress {
            margin-bottom: 2rem;
        }

        .progress-bar {
            height: 16px;
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
            position: relative;
            box-shadow: 0 1px 6px rgba(251, 191, 36, 0.3);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        #current-rank {
            font-weight: 600;
        }

        #next-rank-info {
            color: #94a3b8;
        }

        .rank-benefits {
            margin-bottom: 1.5rem;
        }

        .rank-benefits h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        .benefits-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .benefit-item {
            padding: 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
            color: #10b981;
        }

        .claim-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .claim-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }

        .claim-btn:disabled {
            background: #64748b;
            cursor: not-allowed;
        }

        /* äºˆæƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .predictions-section {
            margin-bottom: 2rem;
        }

        .predictions-section h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #f1f5f9;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .prediction-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(51, 65, 85, 0.5);
            transition: all 0.3s ease;
        }

        .prediction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .prediction-card.free {
            border-color: rgba(148, 163, 184, 0.5);
        }

        .prediction-card.standard {
            border-color: rgba(16, 185, 129, 0.5);
        }

        .prediction-card.premium {
            border-color: rgba(139, 92, 246, 0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-header h3 {
            font-size: 1.2rem;
            margin: 0;
        }

        .plan-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .plan-badge.free {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }

        .plan-badge.standard {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .plan-badge.premium {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }

        .race-info {
            margin-bottom: 1.5rem;
        }

        .race-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .confidence {
            font-size: 0.9rem;
            color: #10b981;
        }

        .view-btn {
            display: block;
            background: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        /* ãƒ—ãƒ©ãƒ³ç®¡ç†ï¼ˆç„¡æ–™ä¼šå“¡ã®ã¿ï¼‰ */
        .plan-section {
            margin-bottom: 2rem;
        }

        .plan-section h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #f1f5f9;
        }

        .plan-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ‰æ–™ä¼šå“¡å°‚ç”¨ï¼‰ */
        .logout-section-paid {
            margin-bottom: 2rem;
            text-align: center;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .action-btn.upgrade {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }

        .action-btn.logout {
            background: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* æœ‰æ–™ä¼šå“¡ç”¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ï¼ˆç›®ç«‹ã¤ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
        .action-btn.logout-primary {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.4);
            font-weight: 600;
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .action-btn.logout-primary:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.3) 100%);
            border-color: rgba(239, 68, 68, 0.6);
            color: #fecaca;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        /* ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¿ƒé€² */
        .upgrade-section {
            margin-bottom: 2rem;
        }

        .upgrade-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .upgrade-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        .upgrade-card p {
            margin-bottom: 1.5rem;
            color: #94a3b8;
        }

        .upgrade-btn {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 0.875rem 2rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .upgrade-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        /* ãƒã‚¤ãƒ³ãƒˆäº¤æ›ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .exchange-section {
            margin-top: 30px;
        }
        
        .exchange-card {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .exchange-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .exchange-header h2 {
            color: #ffffff;
            margin: 0 0 8px 0;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .exchange-subtitle {
            color: #cbd5e0;
            margin: 0;
            font-size: 0.95rem;
        }
        
        .exchange-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .exchange-option {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .exchange-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .orange-option {
            background: linear-gradient(135deg, #ff5722 0%, #e91e63 50%, #9c27b0 100%);
        }

        .orange-option:hover {
            box-shadow: 0 10px 25px rgba(255, 87, 34, 0.4);
        }

        .premium-option {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .premium-option:hover {
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.3);
        }
        
        .exchange-cost {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .exchange-reward {
            font-size: 1.1rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .exchange-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .exchange-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .exchange-note {
            text-align: center;
            color: #a0aec0;
            margin-top: 15px;
        }
        
        /* ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º */
        .simple-progress-container {
            margin-bottom: 1rem;
        }

        .progress-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .progress-current {
            color: #10b981;
            font-weight: 600;
            font-size: 1rem;
        }

        .progress-target {
            color: #3b82f6;
            font-weight: 600;
            font-size: 1rem;
        }

        .progress-remaining {
            text-align: center;
            color: #fbbf24;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .simple-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .simple-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
            border-radius: 6px;
            transition: width 0.6s ease;
            min-width: 2px;
        }

        /* ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¼ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆæ—§ã‚·ã‚¹ãƒ†ãƒ ãƒ»éè¡¨ç¤ºï¼‰ */
        .progress-segments {
            display: none;
        }

        .segment-item {
            margin-bottom: 1.2rem;
            border-radius: 8px;
            background: rgba(30, 41, 59, 0.6);
            padding: 12px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }

        /* ç¾åœ¨é€²è¡Œä¸­ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ */
        .current-segment {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.1);
        }

        /* é”æˆæ¸ˆã¿ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆå°ã•ãè¡¨ç¤ºï¼‰ */
        .achieved-segment {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            padding: 8px 12px;
            margin-bottom: 0.8rem;
            opacity: 0.8;
        }

        /* å…¨é”æˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆ */
        .completed-all {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.15));
            border: 1px solid rgba(16, 185, 129, 0.4);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.15);
        }

        /* ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ */
        .segment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 8px;
        }

        .segment-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .segment-emoji {
            font-size: 1.2rem;
        }

        .segment-title {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.95rem;
        }

        .achieved-segment .segment-title {
            color: #10b981;
            font-size: 0.85rem;
        }

        .segment-progress {
            font-weight: 600;
            color: #fbbf24;
        }

        .segment-reward-small {
            font-size: 0.75rem;
            color: #10b981;
            opacity: 0.9;
        }

        .segment-bar {
            height: 16px;
            background: linear-gradient(90deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 1px solid rgba(251, 191, 36, 0.4);
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .segment-fill {
            height: 100%;
            background: linear-gradient(90deg, #6b7280 0%, #4b5563 100%);
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
            min-width: 4px;
            position: relative;
            z-index: 2;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹0%ã§ã‚‚è¦‹ãˆã‚‹ã‚ˆã†ã«èƒŒæ™¯ã‚’èª¿æ•´ */
        .segment-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(107, 114, 128, 0.4) 0%, rgba(75, 85, 99, 0.3) 100%);
            border-radius: 6px;
            z-index: 1;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®å¤–æ ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .segment-bar::after {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.2));
            border-radius: 9px;
            z-index: 0;
        }

        .segment-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .segment-goal {
            font-weight: 600;
            color: #fbbf24;
        }

        .segment-reward {
            color: #e2e8f0;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* æ¬¡ã®ç›®æ¨™æƒ…å ± */
        .next-goal-info {
            text-align: center;
            background: rgba(30, 41, 59, 0.6);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            font-size: 0.95rem;
            color: #e2e8f0;
            font-weight: 500;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        /* æ—§ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆéš ã™ï¼‰ */
        .progress-fill {
            display: none;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
            /* animation: shimmer 2s infinite; */
        }

        .progress-bronze {
            background: linear-gradient(90deg, #cd7f32 0%, #daa520 50%, #b8860b 100%);
            box-shadow: 0 1px 8px rgba(205, 127, 50, 0.5), inset 0 1px 2px rgba(255, 215, 0, 0.3);
        }

        .progress-silver {
            background: linear-gradient(90deg, #c0c0c0 0%, #e6e6fa 50%, #a8a8a8 100%);
            box-shadow: 0 1px 8px rgba(192, 192, 192, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }

        .progress-gold {
            background: linear-gradient(90deg, #ffd700 0%, #ffef94 50%, #ffb347 100%);
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.6), inset 0 1px 3px rgba(255, 239, 148, 0.5);
        }

        .progress-platinum {
            background: linear-gradient(90deg, #e5e4e2 0%, #f8f8ff 50%, #bcc6cc 100%);
            box-shadow: 0 2px 10px rgba(229, 228, 226, 0.6), inset 0 1px 3px rgba(248, 248, 255, 0.6);
        }

        .progress-diamond {
            background: linear-gradient(90deg, #b9f2ff 0%, #87ceeb 30%, #00bfff 60%, #1e90ff 100%);
            box-shadow: 0 2px 12px rgba(0, 191, 255, 0.7), inset 0 1px 3px rgba(135, 206, 235, 0.7);
        }

        .progress-max {
            background: linear-gradient(90deg, #ff1493 0%, #ff69b4 20%, #ffd700 40%, #00ff7f 60%, #00bfff 80%, #9370db 100%);
            box-shadow: 0 2px 15px rgba(255, 20, 147, 0.8), inset 0 1px 3px rgba(255, 255, 255, 0.3);
            /* animation: rainbow-pulse 1.5s infinite, rainbow-shift 4s infinite; */
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes rainbow-pulse {
            0%, 100% {
                box-shadow: 0 2px 15px rgba(255, 20, 147, 0.8), inset 0 1px 3px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 3px 20px rgba(255, 20, 147, 1), inset 0 2px 4px rgba(255, 255, 255, 0.5);
            }
        }

        @keyframes rainbow-shift {
            0% {
                background: linear-gradient(90deg, #ff1493 0%, #ff69b4 20%, #ffd700 40%, #00ff7f 60%, #00bfff 80%, #9370db 100%);
            }
            25% {
                background: linear-gradient(90deg, #9370db 0%, #ff1493 20%, #ff69b4 40%, #ffd700 60%, #00ff7f 80%, #00bfff 100%);
            }
            50% {
                background: linear-gradient(90deg, #00bfff 0%, #9370db 20%, #ff1493 40%, #ff69b4 60%, #ffd700 80%, #00ff7f 100%);
            }
            75% {
                background: linear-gradient(90deg, #00ff7f 0%, #00bfff 20%, #9370db 40%, #ff1493 60%, #ff69b4 80%, #ffd700 100%);
            }
            100% {
                background: linear-gradient(90deg, #ff1493 0%, #ff69b4 20%, #ffd700 40%, #00ff7f 60%, #00bfff 80%, #9370db 100%);
            }
        }

        /* ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤ºã®ã‚­ãƒ©ã‚­ãƒ©æ¼”å‡º */
        #current-points.points-sparkle {
            /* animation: sparkle-effect 1s ease; */
        }

        @keyframes sparkle-effect {
            0% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { 
                transform: scale(1.15);
                text-shadow: 0 0 20px #fbbf24;
            }
            75% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æƒ…å ±ã®å¼·åŒ– */
        #next-rank-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }

        .next-rank-label {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .points-needed {
            font-size: 1.1rem;
            font-weight: 700;
            color: #fbbf24;
        }

        .motivational-text {
            font-size: 0.85rem;
            color: #f59e0b;
            font-weight: 600;
            /* animation: pulse-glow 2s infinite; */
        }

        .max-rank-achieved {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ff1493;
            /* animation: rainbow-text 3s infinite; */
        }

        .congratulations {
            font-size: 0.9rem;
            color: #ffd700;
            font-weight: 600;
        }

        @keyframes pulse-glow {
            0%, 100% {
                opacity: 1;
                text-shadow: 0 0 5px #f59e0b;
            }
            50% {
                opacity: 0.8;
                text-shadow: 0 0 10px #f59e0b, 0 0 15px #f59e0b;
            }
        }

        @keyframes rainbow-text {
            0% { color: #ff1493; }
            25% { color: #ffd700; }
            50% { color: #00ff00; }
            75% { color: #00bfff; }
            100% { color: #ff1493; }
        }

        /* ç‰¹å…¸ç”³è«‹ãƒœã‚¿ãƒ³ã®è„ˆæ‰“ã¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .pulse-animation {
            /* animation: pulse-button 1.5s infinite; */
        }

        @keyframes pulse-button {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 15px 35px rgba(245, 158, 11, 0.6);
            }
        }

        /* ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰¹å…¸ã®å¼·èª¿ */
        .premium-benefit {
            /* animation: premium-shine 3s infinite; */
        }

        @keyframes premium-shine {
            0%, 100% {
                background: rgba(16, 185, 129, 0.1);
                border-left-color: #10b981;
            }
            50% {
                background: rgba(16, 185, 129, 0.2);
                border-left-color: #34d399;
                box-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
            }
        }

        /* ãƒã‚¤ãƒ³ãƒˆç²å¾—é€šçŸ¥ */
        .points-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000;
            /* animation: slideIn 0.5s ease; */
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .points-added {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 1.2rem;
        }
        
        .points-notification.fade-out {
            /* animation: slideOut 0.5s ease; */
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        /* å°„å¹¸å¿ƒæ¼”å‡ºã®è¿½åŠ åŠ¹æœ - ã‚¹ãƒªãƒ ã§ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ */
        .progress-bar {
            position: relative;
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.3), 0 1px 6px rgba(59, 130, 246, 0.15);
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%);
            /* animation: sweep 3s infinite; */
        }

        @keyframes sweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤ºã®èºå‹•æ„Ÿ */
        .points-value {
            position: relative;
        }

        .points-value::after {
            content: 'âœ¨';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            /* animation: twinkle 2s infinite; */
            opacity: 0;
        }

        #current-points:hover + .points-unit::after {
            animation-play-state: running;
            opacity: 1;
        }

        @keyframes twinkle {
            0%, 100% {
                opacity: 0;
                transform: translateY(-50%) scale(0.8);
            }
            50% {
                opacity: 1;
                transform: translateY(-50%) scale(1.2);
            }
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®å°„å¹¸å¿ƒæ¼”å‡ºç¶­æŒ */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }

            .dashboard-header h1 {
                font-size: 2rem;
            }

            .status-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .points-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .exchange-grid {
                grid-template-columns: 1fr;
            }
            
            .exchange-option {
                padding: 15px;
            }

            .predictions-grid {
                grid-template-columns: 1fr;
            }

            .plan-actions {
                flex-direction: column;
            }

            /* ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚°ãƒªãƒƒãƒ‰ã®ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
            .status-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
                gap: 1rem;
            }
            
            .main-status {
                grid-column: 1;
                grid-row: 1;
            }
            
            .rank-display-only {
                grid-column: 1;
                grid-row: 2;
            }
            
            .vip-status-card {
                grid-column: 1;
                grid-row: 3;
            }
            
            .plan-benefits-card {
                grid-column: 1;
                grid-row: 3;
            }
            
            .rank-guide-card {
                grid-column: 1;
                grid-row: 4;
            }
            
            .rank-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®å°„å¹¸å¿ƒæ¼”å‡ºèª¿æ•´ */
            #next-rank-info {
                align-items: center;
                text-align: center;
            }

            .motivational-text {
                font-size: 0.9rem;
            }

            .progress-fill::after {
                animation-duration: 1.5s;
            }
        }

        /* æœŸé™åˆ‡ã‚Œè­¦å‘Šã‚¹ã‚¿ã‚¤ãƒ« */
        .expiry-warning-section {
            margin-bottom: 30px;
        }

        .expiry-warning-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 16px;
            padding: 30px;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .expiry-warning-icon {
            font-size: 3rem;
            flex-shrink: 0;
        }

        .expiry-warning-content {
            flex: 1;
        }

        .expiry-warning-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 15px;
        }

        .expiry-details {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .expiry-details p {
            color: var(--body-text-color);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .expiry-details p:last-child {
            margin-bottom: 0;
        }

        .expiry-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .expiry-action-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .expiry-action-card.secondary {
            background: rgba(100, 116, 139, 0.1);
            border-color: rgba(100, 116, 139, 0.3);
        }

        .expiry-action-card h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--body-text-color);
            margin-bottom: 10px;
        }

        .expiry-action-card p {
            font-size: 0.9rem;
            color: var(--accent-text-color);
            margin-bottom: 15px;
        }

        .expiry-btn {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .expiry-btn.renew {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }

        .expiry-btn.renew:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .expiry-btn.withdraw {
            background: rgba(100, 116, 139, 0.2);
            color: var(--body-text-color);
            border: 1px solid rgba(100, 116, 139, 0.5);
        }

        .expiry-btn.withdraw:hover {
            background: rgba(100, 116, 139, 0.3);
        }

        @media (max-width: 768px) {
            .expiry-warning-card {
                flex-direction: column;
                padding: 20px;
            }

            .expiry-actions {
                grid-template-columns: 1fr;
            }
        }

        /* ç©´é¦¬ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ */
        .dark-horse-link-section {
            margin-bottom: 30px;
        }

        .dark-horse-link-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 16px;
            padding: 20px 24px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dark-horse-link-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(245, 158, 11, 0.4);
            border-color: rgba(245, 158, 11, 0.5);
        }

        .dark-horse-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .dark-horse-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dark-horse-title {
            color: #fff;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .dark-horse-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .dark-horse-arrow {
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .dark-horse-link-btn {
                padding: 16px 18px;
            }

            .dark-horse-icon {
                font-size: 1.5rem;
            }

            .dark-horse-title {
                font-size: 1rem;
            }

            .dark-horse-subtitle {
                font-size: 0.85rem;
            }
        }
    </style>

    <script is:inline>
        // ãƒ†ã‚¹ãƒˆç”¨èªè¨¼é–¢æ•°ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰
        window.setTestAuth = function(plan) {
            const testUser = {
                email: 'test@example.com',
                plan: plan,
                points: plan === 'premium' ? 300 : plan === 'standard' ? 100 : 30,
                name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                registrationDate: '2024-01-01',
                lastLogin: new Date().toISOString()
            };

            localStorage.setItem('user-plan', JSON.stringify(testUser));
            console.log(`âœ… ãƒ†ã‚¹ãƒˆèªè¨¼è¨­å®šå®Œäº†: ${plan}ãƒ—ãƒ©ãƒ³`, testUser);

            // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å¤‰æ›´ã‚’åæ˜ 
            location.reload();
        };

        console.log('ğŸ’¡ ãƒ†ã‚¹ãƒˆç”¨: setTestAuth("premium"), setTestAuth("standard"), setTestAuth("free") ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
    </script>

    <!-- é€€ä¼šç”³è«‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸‹éƒ¨ï¼‰ -->
    <div id="withdrawal-section" style="display: none; margin-top: 3rem; padding: 2rem; background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px;">
        <h3 style="color: #f87171; margin-bottom: 1rem;">é€€ä¼šã«ã¤ã„ã¦</h3>
        <p style="color: #94a3b8; margin-bottom: 1.5rem;">
            é€€ä¼šã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€ä¸‹è¨˜ãƒœã‚¿ãƒ³ã‹ã‚‰ãŠæ‰‹ç¶šããã ã•ã„ã€‚
        </p>
        <button id="withdrawal-btn" style="display: inline-block; padding: 0.75rem 1.5rem; background: #64748b; color: #fff; border: none; border-radius: 8px; transition: all 0.3s; cursor: pointer; font-family: inherit; font-size: 1rem;">
            é€€ä¼šç”³è«‹
        </button>
    </div>

    <!-- é€€ä¼šç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="withdrawalModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center;">
      <div style="background: #1e293b; padding: 3rem; border-radius: 16px; max-width: 500px; margin: 2rem;">
        <h3 style="color: #f87171; font-size: 1.5rem; margin-bottom: 1rem;">æœ¬å½“ã«é€€ä¼šã—ã¾ã™ã‹ï¼Ÿ</h3>
        <p style="color: #cbd5e1; line-height: 1.8; margin-bottom: 2rem;">
          é€€ä¼šå¾Œã¯å…¨ã¦ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã™ã€‚<br>
          ã‚ˆã‚ã—ã‘ã‚Œã°ã€é€€ä¼šç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
        </p>

        <textarea id="withdrawalReason" placeholder="é€€ä¼šç†ç”±ï¼ˆä»»æ„ï¼‰" style="width: 100%; padding: 1rem; border-radius: 8px; background: #0f172a; color: #e2e8f0; border: 1px solid #334155; margin-bottom: 1.5rem; min-height: 100px; font-family: inherit;"></textarea>

        <div style="display: flex; gap: 1rem;">
          <button id="confirmWithdrawal" style="flex: 1; padding: 1rem; background: #ef4444; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
            é€€ä¼šã™ã‚‹
          </button>
          <button id="cancelWithdrawal" style="flex: 1; padding: 1rem; background: #334155; color: #e2e8f0; border: none; border-radius: 8px; cursor: pointer;">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </button>
        </div>
      </div>
    </div>

    <script is:inline>
        // é€€ä¼šã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ™‚ã«è‡ªå‹•è¡¨ç¤ºï¼‰
        const observer = new MutationObserver(function() {
            const dashboardSection = document.getElementById('dashboard-section');
            const withdrawalSection = document.getElementById('withdrawal-section');

            if (dashboardSection && withdrawalSection) {
                const dashboardVisible = dashboardSection.style.display !== 'none';
                if (dashboardVisible) {
                    withdrawalSection.style.display = 'block';
                }
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['style']
        });

        // åˆå›ãƒã‚§ãƒƒã‚¯
        setTimeout(function() {
            const dashboardSection = document.getElementById('dashboard-section');
            const withdrawalSection = document.getElementById('withdrawal-section');
            if (dashboardSection && withdrawalSection && dashboardSection.style.display !== 'none') {
                withdrawalSection.style.display = 'block';
            }
        }, 500);
    </script>

    <script is:inline>
        // é€€ä¼šãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
        const modal = document.getElementById('withdrawalModal');
        const withdrawalBtn = document.getElementById('withdrawal-btn');
        const confirmBtn = document.getElementById('confirmWithdrawal');
        const cancelBtn = document.getElementById('cancelWithdrawal');
        const reasonTextarea = document.getElementById('withdrawalReason');

        // é€€ä¼šãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒ—ãƒ©ãƒ³åˆ¤å®šä»˜ãï¼‰
        if (withdrawalBtn) {
            withdrawalBtn.addEventListener('click', function() {
                const userPlan = localStorage.getItem('userPlan') || '';

                // ç„¡æ–™ä¼šå“¡ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã€æœ‰æ–™ä¼šå“¡ã¯withdrawal-upsellã¸é·ç§»
                if (userPlan.toLowerCase() === 'free') {
                    modal.style.display = 'flex';
                } else {
                    window.location.href = '/withdrawal-upsell/';
                }
            });
        }

        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        cancelBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        // é€€ä¼šç¢ºå®šå‡¦ç†
        confirmBtn.addEventListener('click', async function() {
            const reason = reasonTextarea.value || 'ç†ç”±æœªè¨˜å…¥';
            const email = localStorage.getItem('userEmail') || '';

            if (!email) {
                alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'å‡¦ç†ä¸­...';

            try {
                // é€€ä¼šå‡¦ç†APIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('/.netlify/functions/process-withdrawal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        reason: reason
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    // æˆåŠŸæ™‚: å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºå¾Œãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
                    alert('é€€ä¼šç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãŠé€ã‚Šã—ã¾ã—ãŸã®ã§ã”ç¢ºèªãã ã•ã„ã€‚\n\næ‹…å½“è€…ã‚ˆã‚Š2å–¶æ¥­æ—¥ä»¥å†…ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚');
                    window.location.href = '/';
                } else {
                    throw new Error(result.error || 'é€€ä¼šç”³è«‹ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}\n\nãŠæ‰‹æ•°ã§ã™ãŒã€ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„ã€‚`);
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'é€€ä¼šã™ã‚‹';
            }
        });

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
    </script>
</BaseLayout>