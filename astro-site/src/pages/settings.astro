---
export const prerender = false;
import BaseLayout from '../layouts/BaseLayout.astro';

const title = 'ç™»éŒ²æƒ…å ±å¤‰æ›´ | NANKANã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹';
const description = 'ä¼šå“¡ç™»éŒ²æƒ…å ±ã®ç¢ºèªãƒ»å¤‰æ›´ãƒšãƒ¼ã‚¸';
---

<BaseLayout title={title} description={description}>
    <div class="settings-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="settings-header">
            <div class="header-content">
                <a href="/dashboard" class="back-button">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸æˆ»ã‚‹</a>
                <h1 class="page-title">âš™ï¸ ç™»éŒ²æƒ…å ±å¤‰æ›´</h1>
                <p class="page-description">ä¼šå“¡ç™»éŒ²æƒ…å ±ã®ç¢ºèªãƒ»å¤‰æ›´ãŒã§ãã¾ã™</p>
            </div>
        </div>

        <!-- èªè¨¼ãƒã‚§ãƒƒã‚¯ -->
        <div id="auth-required" class="auth-warning" style="display: none;">
            <div class="warning-content">
                <span class="warning-icon">ğŸ”’</span>
                <h3>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3>
                <p>ç™»éŒ²æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€ã¾ãšãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
                <a href="/dashboard" class="login-button">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸</a>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div id="settings-content" class="settings-content" style="display: none;">
            <!-- ç¾åœ¨ã®ç™»éŒ²æƒ…å ± -->
            <section class="info-section">
                <h2 class="section-title">ğŸ“‹ ç¾åœ¨ã®ç™»éŒ²æƒ…å ±</h2>
                <div class="current-info-card">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
                            <span id="current-email" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ãŠåå‰</span>
                            <span id="current-name" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ãƒ—ãƒ©ãƒ³</span>
                            <span id="current-plan" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ç™»éŒ²æ—¥</span>
                            <span id="registration-date" class="info-value">-</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ  -->
            <section class="edit-section">
                <h2 class="section-title">âœï¸ æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹</h2>
                <div class="edit-card">
                    <form id="update-form" class="update-form">
                        <!-- åå‰å¤‰æ›´ -->
                        <div class="form-group">
                            <label for="new-name" class="form-label">
                                <span class="label-icon">ğŸ‘¤</span> ãŠåå‰
                            </label>
                            <input
                                type="text"
                                id="new-name"
                                class="form-input"
                                placeholder="å±±ç”° å¤ªéƒ"
                                maxlength="50"
                            />
                            <small class="form-hint">â€» å…¨è§’ãƒ»åŠè§’50æ–‡å­—ã¾ã§</small>
                        </div>

                        <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´ -->
                        <div class="form-group">
                            <label for="new-email" class="form-label">
                                <span class="label-icon">ğŸ“§</span> ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                            </label>
                            <input
                                type="email"
                                id="new-email"
                                class="form-input"
                                placeholder="example@email.com"
                                maxlength="100"
                            />
                            <small class="form-hint">â€» å¤‰æ›´å¾Œã¯æ–°ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</small>
                        </div>

                        <!-- æ›´æ–°ãƒœã‚¿ãƒ³ -->
                        <div class="button-group">
                            <button type="submit" id="update-button" class="update-button">
                                <span id="button-text">å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹</span>
                                <span id="loading-spinner" class="spinner" style="display: none;">â³</span>
                            </button>
                        </div>
                    </form>

                    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <div id="message-area" class="message-area" style="display: none;">
                        <div id="message-content" class="message-content"></div>
                    </div>
                </div>
            </section>

            <!-- æ³¨æ„äº‹é … -->
            <section class="notice-section">
                <h3 class="notice-title">âš ï¸ ã”æ³¨æ„äº‹é …</h3>
                <ul class="notice-list">
                    <li>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã—ãŸå ´åˆã€æ¬¡å›ã‹ã‚‰æ–°ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</li>
                    <li>ãƒ—ãƒ©ãƒ³ã®å¤‰æ›´ã¯æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„</li>
                    <li>å¤‰æ›´å†…å®¹ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™</li>
                    <li>ä¸æ­£ãªå¤‰æ›´ã‚’é˜²ããŸã‚ã€ä¸€å®šå›æ•°ä»¥ä¸Šã®å¤‰æ›´ã¯ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™</li>
                </ul>
            </section>
        </div>
    </div>
</BaseLayout>

<style>
    .settings-container {
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .settings-header {
        max-width: 1000px;
        margin: 0 auto 40px;
    }

    .header-content {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        padding: 30px;
    }

    .back-button {
        display: inline-flex;
        align-items: center;
        color: #60a5fa;
        text-decoration: none;
        font-size: 0.95rem;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }

    .back-button:hover {
        color: #93c5fd;
        transform: translateX(-3px);
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #60a5fa, #c084fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 0 10px 0;
    }

    .page-description {
        color: #94a3b8;
        font-size: 1.1rem;
        margin: 0;
    }

    /* èªè¨¼è­¦å‘Š */
    .auth-warning {
        max-width: 600px;
        margin: 100px auto;
    }

    .warning-content {
        background: rgba(239, 68, 68, 0.1);
        border: 2px solid rgba(239, 68, 68, 0.5);
        border-radius: 16px;
        padding: 40px;
        text-align: center;
    }

    .warning-icon {
        font-size: 3rem;
        display: block;
        margin-bottom: 20px;
    }

    .warning-content h3 {
        color: #f87171;
        font-size: 1.5rem;
        margin: 0 0 10px 0;
    }

    .warning-content p {
        color: #fca5a5;
        margin: 0 0 20px 0;
    }

    .login-button {
        display: inline-block;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 12px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .login-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .settings-content {
        max-width: 1000px;
        margin: 0 auto;
    }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€š */
    .info-section, .edit-section, .notice-section {
        margin-bottom: 30px;
    }

    .section-title {
        color: #60a5fa;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 20px 0;
    }

    /* ç¾åœ¨ã®æƒ…å ±ã‚«ãƒ¼ãƒ‰ */
    .current-info-card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        padding: 25px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .info-label {
        color: #94a3b8;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .info-value {
        color: #e2e8f0;
        font-size: 1.1rem;
        font-weight: 500;
    }

    /* ç·¨é›†ã‚«ãƒ¼ãƒ‰ */
    .edit-card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        padding: 30px;
    }

    .update-form {
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .form-label {
        color: #cbd5e1;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .label-icon {
        font-size: 1.2rem;
    }

    .form-input {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 8px;
        padding: 12px 15px;
        color: #e2e8f0;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
    }

    .form-input::placeholder {
        color: #64748b;
    }

    .form-hint {
        color: #94a3b8;
        font-size: 0.85rem;
        margin-top: -5px;
    }

    /* ãƒœã‚¿ãƒ³ */
    .button-group {
        margin-top: 10px;
    }

    .update-button {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 14px 30px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .update-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
    }

    .update-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .spinner {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
    .message-area {
        margin-top: 20px;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .message-content {
        padding: 15px 20px;
        border-radius: 8px;
        font-weight: 500;
    }

    .message-content.success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.5);
        color: #34d399;
    }

    .message-content.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.5);
        color: #f87171;
    }

    /* æ³¨æ„äº‹é … */
    .notice-section {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(251, 191, 36, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-top: 40px;
    }

    .notice-title {
        color: #fbbf24;
        font-size: 1.1rem;
        margin: 0 0 15px 0;
    }

    .notice-list {
        color: #cbd5e1;
        font-size: 0.95rem;
        line-height: 1.8;
        margin: 0;
        padding-left: 20px;
    }

    .notice-list li {
        margin-bottom: 8px;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
        .settings-container {
            padding: 15px;
        }

        .page-title {
            font-size: 2rem;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }

        .header-content, .current-info-card, .edit-card {
            padding: 20px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // è¦ç´ å–å¾—
        const authRequired = document.getElementById('auth-required');
        const settingsContent = document.getElementById('settings-content');
        const updateForm = document.getElementById('update-form');
        const updateButton = document.getElementById('update-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const messageArea = document.getElementById('message-area');
        const messageContent = document.getElementById('message-content');

        // ç¾åœ¨ã®æƒ…å ±è¡¨ç¤ºè¦ç´ 
        const currentEmail = document.getElementById('current-email');
        const currentName = document.getElementById('current-name');
        const currentPlan = document.getElementById('current-plan');
        const registrationDate = document.getElementById('registration-date');

        // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 
        const newNameInput = document.getElementById('new-name');
        const newEmailInput = document.getElementById('new-email');

        // èªè¨¼æƒ…å ±å–å¾—ï¼ˆAccessControlã¨åŒæ§˜ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
        function getCurrentUserInfo() {
            console.log('ğŸ” è¨­å®šãƒšãƒ¼ã‚¸èªè¨¼ãƒã‚§ãƒƒã‚¯é–‹å§‹');

            // 1. nankan_userèªè¨¼æƒ…å ±ã‚’å–å¾—ï¼ˆå„ªå…ˆï¼‰
            const nankanUser = localStorage.getItem('nankan_user');
            if (nankanUser) {
                try {
                    const userData = JSON.parse(nankanUser);
                    console.log('âœ… nankan_userèªè¨¼:', userData);
                    return userData;
                } catch (error) {
                    console.error('Nankan user parsing error:', error);
                }
            }

            // 2. æ—§å½¢å¼ã®test_subscription_ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯
            const testSubscriptionKeys = Object.keys(localStorage).filter(key => key.startsWith('test_subscription_'));
            if (testSubscriptionKeys.length > 0) {
                try {
                    const testData = JSON.parse(localStorage.getItem(testSubscriptionKeys[0]));
                    console.log('ğŸ“¦ æ—§å½¢å¼èªè¨¼ãƒ‡ãƒ¼ã‚¿:', testData);
                    return {
                        email: `test-${testData.planType}@example.com`,
                        name: `ãƒ†ã‚¹ãƒˆ${testData.planType}ãƒ¦ãƒ¼ã‚¶ãƒ¼`,
                        plan: testData.planType.toLowerCase()
                    };
                } catch (error) {
                    console.error('Test subscription parsing error:', error);
                }
            }

            // 3. auth_dataèªè¨¼æƒ…å ±ã‚’å–å¾—
            const authData = localStorage.getItem('auth_data');
            if (authData) {
                try {
                    const { user } = JSON.parse(authData);
                    console.log('âœ… auth_dataèªè¨¼:', user);
                    return user;
                } catch (error) {
                    console.error('Auth data parsing error:', error);
                }
            }

            console.log('âŒ èªè¨¼ãƒ‡ãƒ¼ã‚¿ãªã—');
            return null;
        }

        let userInfo = getCurrentUserInfo();

        // èªè¨¼ãƒã‚§ãƒƒã‚¯ã¨è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        if (!userInfo || !userInfo.email) {
            authRequired.style.display = 'block';
            settingsContent.style.display = 'none';
            return;
        }

        // èªè¨¼æ¸ˆã¿ã®å ´åˆ
        authRequired.style.display = 'none';
        settingsContent.style.display = 'block';

        // ç¾åœ¨ã®æƒ…å ±ã‚’è¡¨ç¤º
        displayCurrentInfo(userInfo);

        // ç¾åœ¨ã®å€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®š
        newNameInput.value = userInfo.name || '';
        newEmailInput.value = userInfo.email || '';

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        updateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await handleUpdate();
        });

        // ç¾åœ¨ã®æƒ…å ±è¡¨ç¤ºé–¢æ•°
        function displayCurrentInfo(info) {
            currentEmail.textContent = info.email || '-';
            currentName.textContent = info.name || 'ãŠå®¢æ§˜';

            // ãƒ—ãƒ©ãƒ³è¡¨ç¤º
            const planNames = {
                'premium': 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡',
                'standard': 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ä¼šå“¡',
                'free': 'ç„¡æ–™ä¼šå“¡'
            };
            currentPlan.textContent = planNames[info.plan] || 'ç„¡æ–™ä¼šå“¡';

            // ç™»éŒ²æ—¥è¡¨ç¤º
            if (info.registrationDate) {
                const date = new Date(info.registrationDate);
                registrationDate.textContent = date.toLocaleDateString('ja-JP');
            } else {
                registrationDate.textContent = '-';
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé–¢æ•°
        function showMessage(message, type = 'success') {
            messageContent.textContent = message;
            messageContent.className = `message-content ${type}`;
            messageArea.style.display = 'block';

            // 5ç§’å¾Œã«è‡ªå‹•ã§éè¡¨ç¤º
            setTimeout(() => {
                messageArea.style.display = 'none';
            }, 5000);
        }

        // æ›´æ–°å‡¦ç†
        async function handleUpdate() {
            const newName = newNameInput.value.trim();
            const newEmail = newEmailInput.value.trim();

            // å¤‰æ›´ãƒã‚§ãƒƒã‚¯
            if (newName === (userInfo.name || '') && newEmail === userInfo.email) {
                showMessage('å¤‰æ›´ã™ã‚‹é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!newEmail) {
                showMessage('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™', 'error');
                return;
            }

            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(newEmail)) {
                showMessage('æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
            updateButton.disabled = true;
            buttonText.style.display = 'none';
            loadingSpinner.style.display = 'inline-block';

            try {
                // Netlify FunctionsçµŒç”±ã§Airtableæ›´æ–°
                const response = await fetch('/.netlify/functions/update-customer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        currentEmail: userInfo.email,
                        newEmail: newEmail,
                        newName: newName
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    // æˆåŠŸæ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ›´æ–°
                    const updatedInfo = {
                        ...userInfo,
                        email: newEmail,
                        name: newName
                    };
                    localStorage.setItem('nankan_user', JSON.stringify(updatedInfo));
                    userInfo = updatedInfo;

                    // è¡¨ç¤ºæ›´æ–°
                    displayCurrentInfo(updatedInfo);

                    showMessage('ç™»éŒ²æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');

                    // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã®æ³¨æ„
                    if (newEmail !== userInfo.email) {
                        setTimeout(() => {
                            showMessage('æ¬¡å›ã‹ã‚‰æ–°ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'success');
                        }, 2000);
                    }
                } else {
                    showMessage(result.message || 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                console.error('æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„', 'error');
            } finally {
                // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
                updateButton.disabled = false;
                buttonText.style.display = 'inline';
                loadingSpinner.style.display = 'none';
            }
        }

        // ãƒ†ã‚¹ãƒˆèªè¨¼æ©Ÿèƒ½ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰
        window.setTestAuth = function(plan) {
            if (!['premium', 'standard', 'free'].includes(plan.toLowerCase())) {
                console.error('âŒ ç„¡åŠ¹ãªãƒ—ãƒ©ãƒ³:', plan);
                console.log('ğŸ“‹ æœ‰åŠ¹ãªãƒ—ãƒ©ãƒ³: premium, standard, free');
                return;
            }
            const testUser = {
                email: `test-${plan}@example.com`,
                name: `ãƒ†ã‚¹ãƒˆ${plan.charAt(0).toUpperCase() + plan.slice(1)}ãƒ¦ãƒ¼ã‚¶ãƒ¼`,
                plan: plan.toLowerCase(),
                isTest: true,
                points: plan === 'premium' ? 1000 : plan === 'standard' ? 500 : 100,
                registrationDate: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            localStorage.setItem('nankan_user', JSON.stringify(testUser));
            localStorage.setItem('nankan_test_auth', 'true');
            console.log(`âœ… ãƒ†ã‚¹ãƒˆèªè¨¼è¨­å®šå®Œäº†: ${plan}ãƒ—ãƒ©ãƒ³`, testUser);
            console.log('ğŸ”„ ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦èªè¨¼ã‚’é©ç”¨ã—ã¦ãã ã•ã„');
            setTimeout(() => {
                location.reload();
            }, 1000);
        };

        window.clearTestAuth = function() {
            localStorage.removeItem('nankan_user');
            localStorage.removeItem('nankan_test_auth');
            localStorage.removeItem('auth_data');
            sessionStorage.removeItem('temp_auth');
            console.log('ğŸ§¹ ãƒ†ã‚¹ãƒˆèªè¨¼ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            location.reload();
        };
    });
</script>