---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import AccessControl from '../components/AccessControl.astro';
import StandardRaceAccordion from '../components/StandardRaceAccordion.astro';
import allRacesData from '../data/allRacesPrediction.json';

// スタンダード会員がアクセス可能なレース（10R, 11R, 12R）
const accessibleRaces = allRacesData.races.filter(race => {
    const raceNum = parseInt(race.raceNumber.replace('R', ''));
    return raceNum >= 10;
}).sort((a, b) => {
    const aNum = parseInt(a.raceNumber.replace('R', ''));
    const bNum = parseInt(b.raceNumber.replace('R', ''));
    return aNum - bNum;
});

const mainRace = accessibleRaces.find(race => race.isMainRace === true);
const totalAccessibleRaces = accessibleRaces.length;

// 統計計算
const avgConfidence = accessibleRaces.reduce((sum, race) => 
    sum + parseFloat(race.raceInfo.confidence || '0'), 0) / totalAccessibleRaces;
const avgExpectedReturn = accessibleRaces.reduce((sum, race) => 
    sum + parseFloat(race.raceInfo.expectedReturn || '0'), 0) / totalAccessibleRaces;
const highConfidenceRaces = accessibleRaces.filter(race => 
    parseFloat(race.raceInfo.confidence || '0') >= 85).length;
---

<BaseLayout title="スタンダード予想 | NANKANアナリティクス" description="AI技術による南関競馬の詳細分析。スタンダード会員向けの後半3レース（10R-12R）専用予想サービス。">
    <AccessControl requiredPlan="standard">
        <div class="page-container">
            <!-- ヘッダーセクション -->
            <div class="header-section">
                <div class="plan-badge">
                    <span class="plan-icon">⭐</span>
                    <span class="plan-text">スタンダード会員</span>
                </div>
                <h1 class="page-title">スタンダード予想</h1>
                <h2 class="race-subtitle">2025年8月22日 川崎競馬 - 後半3レース</h2>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value">{totalAccessibleRaces}</div>
                        <div class="stat-label">対象レース</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{Math.round(avgConfidence)}%</div>
                        <div class="stat-label">平均信頼度</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{Math.round(avgExpectedReturn)}%</div>
                        <div class="stat-label">平均期待回収率</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{highConfidenceRaces}</div>
                        <div class="stat-label">高信頼度レース</div>
                    </div>
                </div>
            </div>

            <!-- メインレースハイライト -->
            {mainRace && (
                <div class="main-race-highlight">
                    <div class="highlight-header">
                        <h2>🏆 本日のメインレース</h2>
                        <div class="main-race-badge">注目度MAX</div>
                    </div>
                    <div class="main-race-info">
                        <div class="race-title">{mainRace.raceInfo.title}</div>
                        <div class="race-details">
                            {mainRace.raceInfo.distance} | {mainRace.raceInfo.startTime}発走 | {mainRace.raceInfo.horseCount}頭立て
                        </div>
                        <div class="main-race-stats">
                            <div class="main-stat">
                                <span class="label">AI信頼度</span>
                                <span class="value confidence">{Math.floor(parseFloat(mainRace.raceInfo.confidence || '0'))}%</span>
                            </div>
                            <div class="main-stat">
                                <span class="label">推奨度</span>
                                <span class="value recommendation">{mainRace.raceInfo.recommendation}</span>
                            </div>
                            <div class="main-stat">
                                <span class="label">期待回収率</span>
                                <span class="value return">{mainRace.raceInfo.expectedReturn}%</span>
                            </div>
                        </div>
                        <div class="main-horses-preview">
                            <div class="horse-preview main">
                                <span class="number">{mainRace.horses.main.number}</span>
                                <span class="name">{mainRace.horses.main.name}</span>
                                <span class="type">{mainRace.horses.main.type}</span>
                            </div>
                            <div class="vs-divider">VS</div>
                            <div class="horse-preview sub">
                                <span class="number">{mainRace.horses.sub.number}</span>
                                <span class="name">{mainRace.horses.sub.name}</span>
                                <span class="type">{mainRace.horses.sub.type}</span>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            <!-- スタンダード会員の特典説明 -->
            <div class="benefits-section">
                <h2>✨ スタンダード会員の特典</h2>
                <div class="benefits-grid">
                    <div class="benefit-card">
                        <div class="benefit-icon">🎯</div>
                        <h3>後半3レース完全予想</h3>
                        <p>10R・11R・12Rの詳細予想と投資戦略を全て公開</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon">📊</div>
                        <h3>3つの投資戦略</h3>
                        <p>リスクレベル別の戦略で安全投資から高配当狙いまで対応</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon">🤖</div>
                        <h3>AI詳細分析</h3>
                        <p>機械学習モデルによる展開予測と重要指標を詳細表示</p>
                    </div>
                </div>
            </div>

            <!-- レース別予想アコーディオン -->
            <div class="races-section">
                <h2>🏇 レース別詳細予想</h2>
                <div class="races-container">
                    {accessibleRaces.map((race) => (
                        <StandardRaceAccordion 
                            raceData={race}
                            raceNumber={race.raceNumber}
                            isMainRace={race.isMainRace}
                        />
                    ))}
                </div>
            </div>

            <!-- アップグレード案内 -->
            <div class="upgrade-section">
                <div class="upgrade-content">
                    <div class="upgrade-icon">👑</div>
                    <h2>さらに上を目指しませんか？</h2>
                    <p>プレミアム会員なら全12レース + 特別戦略で的中率とリターンを最大化</p>
                    <div class="premium-features">
                        <div class="feature-row">
                            <div class="feature">✅ 全12レース完全予想</div>
                            <div class="feature">✅ プレミアム限定戦略</div>
                        </div>
                        <div class="feature-row">
                            <div class="feature">✅ より高精度な分析</div>
                            <div class="feature">✅ 早期アクセス権</div>
                        </div>
                    </div>
                    <div class="upgrade-buttons">
                        <a href="/pricing/" class="upgrade-btn primary">プレミアムにアップグレード</a>
                        <a href="/premium-predictions/" class="upgrade-btn secondary">プレミアム予想を見る</a>
                    </div>
                </div>
            </div>
        </div>
    </AccessControl>
</BaseLayout>

<style>
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        color: #e2e8f0;
    }

    .header-section {
        text-align: center;
        padding: 40px 20px;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.12) 0%, rgba(59, 130, 246, 0.12) 100%);
        border-radius: 20px;
        border: 2px solid rgba(16, 185, 129, 0.3);
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }

    .header-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(16, 185, 129, 0.05), transparent);
        animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .plan-badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 10px 24px;
        border-radius: 30px;
        font-weight: 700;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        position: relative;
        z-index: 2;
    }

    .plan-icon {
        font-size: 1.2rem;
    }

    .page-title {
        font-size: 3rem;
        font-weight: 900;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
        z-index: 2;
    }

    .race-subtitle {
        font-size: 1.3rem;
        color: #94a3b8;
        font-weight: 600;
        margin-bottom: 30px;
        position: relative;
        z-index: 2;
    }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 20px;
        max-width: 600px;
        margin: 0 auto;
        position: relative;
        z-index: 2;
    }

    .stat-item {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        transition: all 0.3s;
    }

    .stat-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: #10b981;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #94a3b8;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .main-race-highlight {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%);
        border: 2px solid rgba(16, 185, 129, 0.4);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }

    .main-race-highlight::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        animation: slide 2s infinite;
    }

    @keyframes slide {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .highlight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        position: relative;
        z-index: 2;
    }

    .highlight-header h2 {
        font-size: 1.8rem;
        font-weight: 700;
        color: #e2e8f0;
    }

    .main-race-badge {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 700;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }

    .main-race-info {
        position: relative;
        z-index: 2;
    }

    .main-race-info .race-title {
        font-size: 1.6rem;
        font-weight: 800;
        color: #10b981;
        margin-bottom: 8px;
    }

    .main-race-info .race-details {
        color: #94a3b8;
        margin-bottom: 20px;
        font-size: 1.1rem;
    }

    .main-race-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .main-stat {
        background: rgba(30, 41, 59, 0.6);
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .main-stat .label {
        display: block;
        color: #94a3b8;
        font-size: 0.9rem;
        margin-bottom: 8px;
    }

    .main-stat .value {
        font-size: 1.4rem;
        font-weight: 800;
    }

    .main-stat .value.confidence {
        color: #10b981;
    }

    .main-stat .value.recommendation {
        color: #3b82f6;
    }

    .main-stat .value.return {
        color: #f59e0b;
    }

    .main-horses-preview {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        padding: 20px;
        background: rgba(30, 41, 59, 0.4);
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .horse-preview {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        min-width: 140px;
    }

    .horse-preview.main {
        background: rgba(16, 185, 129, 0.15);
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .horse-preview.sub {
        background: rgba(59, 130, 246, 0.15);
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .horse-preview .number {
        display: block;
        font-size: 2rem;
        font-weight: 900;
        margin-bottom: 5px;
    }

    .horse-preview.main .number {
        color: #10b981;
    }

    .horse-preview.sub .number {
        color: #3b82f6;
    }

    .horse-preview .name {
        display: block;
        font-weight: 700;
        color: #e2e8f0;
        margin-bottom: 4px;
    }

    .horse-preview .type {
        display: block;
        font-size: 0.85rem;
        color: #94a3b8;
        font-weight: 600;
    }

    .vs-divider {
        font-size: 1.5rem;
        font-weight: 900;
        color: #f59e0b;
        text-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
    }

    .benefits-section {
        margin-bottom: 50px;
    }

    .benefits-section h2 {
        font-size: 2rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 30px;
        color: #e2e8f0;
    }

    .benefits-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }

    .benefit-card {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 16px;
        padding: 25px;
        text-align: center;
        transition: all 0.3s;
        backdrop-filter: blur(10px);
    }

    .benefit-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(16, 185, 129, 0.2);
        border-color: rgba(16, 185, 129, 0.5);
    }

    .benefit-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        filter: drop-shadow(0 4px 8px rgba(16, 185, 129, 0.3));
    }

    .benefit-card h3 {
        font-size: 1.3rem;
        font-weight: 700;
        color: #10b981;
        margin-bottom: 12px;
    }

    .benefit-card p {
        color: #94a3b8;
        line-height: 1.6;
    }

    .races-section {
        margin-bottom: 50px;
    }

    .races-section h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: #e2e8f0;
        text-align: center;
    }

    .races-container {
        max-width: 100%;
    }

    .upgrade-section {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%);
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .upgrade-content {
        position: relative;
        z-index: 2;
    }

    .upgrade-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        filter: drop-shadow(0 4px 8px rgba(139, 92, 246, 0.3));
    }

    .upgrade-section h2 {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 15px;
        background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .upgrade-section p {
        color: #cbd5e1;
        font-size: 1.2rem;
        line-height: 1.6;
        margin-bottom: 30px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .premium-features {
        margin-bottom: 35px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    .feature-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
    }

    .feature {
        color: #8b5cf6;
        font-weight: 600;
        text-align: left;
        padding: 8px;
    }

    .upgrade-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .upgrade-btn {
        padding: 15px 30px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 700;
        font-size: 1.1rem;
        transition: all 0.3s;
        display: inline-block;
    }

    .upgrade-btn.primary {
        background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
        color: white;
        box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
    }

    .upgrade-btn.primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(139, 92, 246, 0.4);
    }

    .upgrade-btn.secondary {
        background: transparent;
        color: #8b5cf6;
        border: 2px solid rgba(139, 92, 246, 0.5);
    }

    .upgrade-btn.secondary:hover {
        background: rgba(139, 92, 246, 0.1);
        border-color: #8b5cf6;
        transform: translateY(-1px);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .page-container {
            padding: 15px;
        }

        .page-title {
            font-size: 2.2rem;
        }

        .main-horses-preview {
            flex-direction: column;
            gap: 20px;
        }

        .vs-divider {
            transform: rotate(90deg);
        }

        .benefits-grid {
            grid-template-columns: 1fr;
        }

        .upgrade-section {
            padding: 25px 15px;
        }

        .upgrade-section h2 {
            font-size: 1.8rem;
        }

        .upgrade-buttons {
            flex-direction: column;
            align-items: center;
        }

        .upgrade-btn {
            width: 100%;
            max-width: 280px;
        }
    }

    @media (max-width: 480px) {
        .summary-stats {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .main-race-stats {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .highlight-header {
            flex-direction: column;
            gap: 15px;
        }

        .feature-row {
            grid-template-columns: 1fr;
        }

        .feature {
            text-align: center;
        }
    }
</style>

<script>
    // レースアコーディオンのトグル機能
    function toggleRace10R() {
        toggleAccordion('race-10r-accordion', 'race-10r-header');
    }

    function toggleRace11R() {
        toggleAccordion('race-11r-accordion', 'race-11r-header');
    }

    function toggleRace12R() {
        toggleAccordion('race-12r-accordion', 'race-12r-header');
    }

    function toggleAccordion(contentId, headerId) {
        const content = document.getElementById(contentId);
        const header = document.querySelector(`.${headerId}`);
        
        if (content && header) {
            const isActive = content.classList.contains('active');
            
            // 他のアコーディオンを閉じる
            document.querySelectorAll('.race-accordion-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.race-accordion-header').forEach(el => {
                el.classList.remove('active');
            });
            
            // 選択されたアコーディオンを開く/閉じる
            if (!isActive) {
                content.classList.add('active');
                header.classList.add('active');
            }
        }
    }

    // アップグレードボタンのクリック処理
    document.addEventListener('DOMContentLoaded', () => {
        // アニメーション効果を追加
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.benefit-card, .race-accordion').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(el);
        });
    });

    // グローバルスコープで関数を利用可能にする
    window.toggleRace10R = toggleRace10R;
    window.toggleRace11R = toggleRace11R;
    window.toggleRace12R = toggleRace12R;
</script>