---
export const prerender = true;
import BaseLayout from '../layouts/BaseLayout.astro';
import AccessControl from '../components/AccessControl.astro';
import allRacesData from '../data/allRacesPrediction.json';
import { processRaceData, getHorseConfidenceFromMark } from '../lib/shared-prediction-logic.js';

// å…±æœ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
const { sortedRaces } = processRaceData(allRacesData);

// æ—¥ä»˜ã¨ä¼šå ´ã‚’å–å¾—
const raceDate = allRacesData.raceDate;
const track = allRacesData.track;
const totalRaces = allRacesData.totalRaces || 12;

// æ—¥ä»˜ã‚’æ—¥æœ¬èªå½¢å¼ã«å¤‰æ›
const [year, month, day] = raceDate.split('-');
const formattedDate = `${year}å¹´${parseInt(month)}æœˆ${parseInt(day)}æ—¥`;

/**
 * è²·ã„ç›®ã‹ã‚‰é¦¬ç•ªã‚’æŠ½å‡ºã—ã¦ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
 */
function extractAndSortBets(bets, allHorses) {
    const betList = [];

    // è²·ã„ç›®æ–‡å­—åˆ—ã‚’è§£æ
    bets.forEach(bet => {
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯numbersãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰æ–‡å­—åˆ—ã‚’å–å¾—
        const betStr = typeof bet === 'string' ? bet : bet.numbers;
        if (!betStr) return;

        // "8 â†’ 7,2,5ã€€3ç‚¹" ã®å½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹
        const match = betStr.match(/(.+?)\s+[â†’â‡”]\s+(.+?)(?:\s+(\d+)ç‚¹)?/);
        if (!match) return;

        const [, first, second] = match;
        const firstNums = first.split(',').map(n => parseInt(n.trim()));
        const secondNums = second.split(',').map(n => parseInt(n.trim()));

        // åŒæ–¹å‘ãƒã‚§ãƒƒã‚¯
        const isBidirectional = betStr.includes('â‡”');

        // è²·ã„ç›®å±•é–‹
        firstNums.forEach(f => {
            secondNums.forEach(s => {
                // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: åŒã˜é¦¬ç•ªåŒå£«ã®è²·ã„ç›®ã‚’é™¤å¤–ï¼ˆä¾‹: 1 â†’ 1ï¼‰
                if (f === s) return;

                const horse1 = allHorses.find(h => h.number === f);
                const horse2 = allHorses.find(h => h.number === s);
                const avgScore = ((horse1?.confidence || 0) + (horse2?.confidence || 0)) / 2;

                betList.push({
                    display: `${f} â†’ ${s}`,
                    score: avgScore,
                    originalBet: betStr
                });

                // åŒæ–¹å‘ã®å ´åˆã¯é€†ã‚‚è¿½åŠ 
                if (isBidirectional && f !== s) {
                    betList.push({
                        display: `${s} â†’ ${f}`,
                        score: avgScore,
                        originalBet: betStr
                    });
                }
            });
        });
    });

    // ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆï¼ˆé™é †ï¼‰
    betList.sort((a, b) => b.score - a.score);

    return betList;
}

/**
 * Premium Selectå°‚ç”¨è²·ã„ç›®ç”Ÿæˆ
 * ç´¯ç©ã‚¹ã‚³ã‚¢ã«åŸºã¥ãæˆ¦ç•¥ãƒŸãƒƒã‚¯ã‚¹
 */
function generatePremiumSelectBets(raceData) {
    const horses = raceData.horses || {};
    const strategies = raceData.strategies || {};

    // å…¨é¦¬ãƒªã‚¹ãƒˆ
    const allHorses = [
        horses.main,
        horses.sub,
        ...(horses.hole1 ? [horses.hole1] : []),
        ...(horses.hole2 ? [horses.hole2] : []),
        ...(horses.minor || []),
        ...(horses.choices || []),
        ...(horses.extras || []),
        ...(horses.low || []),
        ...(horses.other || [])
    ].filter(Boolean);

    // æœ¬å‘½ã®ç´¯ç©ã‚¹ã‚³ã‚¢å–å¾—
    const mainScore = horses.main?.confidence || getHorseConfidenceFromMark(horses.main) || 0;

    let selectedBets = [];
    let targetPoints = 5;
    let strategyType = '';

    if (mainScore >= 89) {
        // 89ptä»¥ä¸Š: å°‘ç‚¹æ•°å‹ + ãƒãƒ©ãƒ³ã‚¹å‹ãƒŸãƒƒã‚¯ã‚¹ â†’ ä¸Šä½5ç‚¹
        strategyType = 'ğŸ¯ å°‘ç‚¹æ•°å‹+ãƒãƒ©ãƒ³ã‚¹å‹ãƒŸãƒƒã‚¯ã‚¹ï¼ˆä¸Šä½5ç‚¹ï¼‰';
        const safeBets = strategies.safe?.bets || [];
        const balanceBets = strategies.balance?.bets || [];
        const mixedBets = extractAndSortBets([...safeBets, ...balanceBets], allHorses);
        selectedBets = mixedBets.slice(0, 5);
        targetPoints = 5;

    } else if (mainScore === 88) {
        // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: 88ptå°‘ç‚¹æ•°å‹å¯„ã‚Šã¯ã€å°‘ç‚¹æ•°æˆ¦ç•¥ã ã‘ã§ã¯ç‚¹æ•°ä¸è¶³ã®å ´åˆãŒã‚ã‚‹
        // è§£æ±ºç­–: å°‘ç‚¹æ•°æˆ¦ç•¥ + ãƒãƒ©ãƒ³ã‚¹å‹æˆ¦ç•¥ã‚’ãƒŸãƒƒã‚¯ã‚¹ã—ã¦ç¢ºå®Ÿã«7ç‚¹ç¢ºä¿
        strategyType = 'ğŸ¯ å°‘ç‚¹æ•°å‹å¯„ã‚Šï¼ˆä¸Šä½7ç‚¹ï¼‰';
        const safeBets = strategies.safe?.bets || [];
        const balanceBets = strategies.balance?.bets || [];
        const mixedBets = extractAndSortBets([...safeBets, ...balanceBets], allHorses);
        selectedBets = mixedBets.slice(0, 7);
        targetPoints = 7;

    } else if (mainScore === 87) {
        // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: 87ptãƒãƒ©ãƒ³ã‚¹å‹ã‚‚ã€æˆ¦ç•¥1ã¤ã ã‘ã§ã¯ç‚¹æ•°ä¸è¶³ã®å ´åˆãŒã‚ã‚‹
        // è§£æ±ºç­–: ãƒãƒ©ãƒ³ã‚¹å‹ + å°‘ç‚¹æ•°å‹æˆ¦ç•¥ã‚’ãƒŸãƒƒã‚¯ã‚¹ã—ã¦ç¢ºå®Ÿã«10ç‚¹ç¢ºä¿
        strategyType = 'âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆä¸Šä½10ç‚¹ï¼‰';
        const balanceBets = strategies.balance?.bets || [];
        const safeBets = strategies.safe?.bets || [];
        const mixedBets = extractAndSortBets([...balanceBets, ...safeBets], allHorses);
        selectedBets = mixedBets.slice(0, 10);
        targetPoints = 10;

    } else if (mainScore === 86) {
        // 86pt: ãƒãƒ©ãƒ³ã‚¹å‹ + é«˜é…å½“å‹ãƒŸãƒƒã‚¯ã‚¹ â†’ 10ç‚¹
        strategyType = 'âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹+é«˜é…å½“å‹ãƒŸãƒƒã‚¯ã‚¹ï¼ˆ10ç‚¹ï¼‰';
        const balanceBets = strategies.balance?.bets || [];
        const aggressiveBets = strategies.aggressive?.bets || [];
        const mixedBets = extractAndSortBets([...balanceBets, ...aggressiveBets], allHorses);
        selectedBets = mixedBets.slice(0, 10);
        targetPoints = 10;

    } else if (mainScore <= 85 && mainScore > 0) {
        // ğŸ›¡ï¸ å¾©æ´»é˜²æ­¢å¯¾ç­–: 85ptä»¥ä¸‹é«˜é…å½“å‹ã‚‚ã€æˆ¦ç•¥1ã¤ã ã‘ã§ã¯ç‚¹æ•°ä¸è¶³ã®å ´åˆãŒã‚ã‚‹
        // è§£æ±ºç­–: é«˜é…å½“å‹ + ãƒãƒ©ãƒ³ã‚¹å‹æˆ¦ç•¥ã‚’ãƒŸãƒƒã‚¯ã‚¹ã—ã¦ç¢ºå®Ÿã«10ç‚¹ç¢ºä¿
        strategyType = 'ğŸ”¥ é«˜é…å½“å‹ï¼ˆä¸Šä½10ç‚¹ï¼‰';
        const aggressiveBets = strategies.aggressive?.bets || [];
        const balanceBets = strategies.balance?.bets || [];
        const mixedBets = extractAndSortBets([...aggressiveBets, ...balanceBets], allHorses);
        selectedBets = mixedBets.slice(0, 10);
        targetPoints = 10;

    } else {
        // ã‚¹ã‚³ã‚¢ä¸æ˜ã®å ´åˆã¯ãƒãƒ©ãƒ³ã‚¹å‹
        strategyType = 'âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰';
        const balanceBets = strategies.balance?.bets || [];
        const sortedBets = extractAndSortBets(balanceBets, allHorses);
        selectedBets = sortedBets.slice(0, 10);
        targetPoints = 10;
    }

    return {
        strategyType,
        mainScore,
        selectedBets,
        targetPoints
    };
}

// å…¨ãƒ¬ãƒ¼ã‚¹ã®è²·ã„ç›®ç”Ÿæˆ
const premiumSelectRaces = sortedRaces.map(raceData => {
    const result = generatePremiumSelectBets(raceData);
    return {
        ...raceData,
        premiumSelect: result
    };
});

---

<BaseLayout
    title={`ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚»ãƒ¬ã‚¯ãƒˆäºˆæƒ³ | ${track} ${formattedDate}`}
    description={`AIæŠ€è¡“ã«ã‚ˆã‚‹${track}ç«¶é¦¬ã®è¶…å³é¸äºˆæƒ³ã€‚ç´¯ç©ã‚¹ã‚³ã‚¢ã«åŸºã¥ãæˆ¦ç•¥ãƒŸãƒƒã‚¯ã‚¹ã§æœ€é©ãªè²·ã„ç›®ã®ã¿ã‚’æä¾›ã€‚`}
>
    <AccessControl requiredPlan="premium">
        <div class="page-container">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="header-section">
                <div class="ai-badge premium-select-badge">
                    <span class="pulse"></span>
                    <span class="ai-status">âœ¨ Premium Select</span>
                </div>
                <h1 class="race-title">{formattedDate} {track} - Premium Select å³é¸äºˆæƒ³</h1>
                <div class="premium-select-description">
                    <p class="select-intro">
                        ç´¯ç©ã‚¹ã‚³ã‚¢ã«åŸºã¥ãã€<strong>3ã¤ã®æˆ¦ç•¥ã‚’è‡ªå‹•ãƒŸãƒƒã‚¯ã‚¹</strong>ã€‚
                        å„ãƒ¬ãƒ¼ã‚¹ã”ã¨ã«<strong>æœ€é©ãªè²·ã„ç›®ã®ã¿</strong>ã‚’å³é¸ã—ã¦ãŠå±Šã‘ã—ã¾ã™ã€‚
                    </p>
                </div>
                <div class="ai-metrics">
                    <div class="metric">
                        <div class="metric-value">{totalRaces}</div>
                        <div class="metric-label">å³é¸ãƒ¬ãƒ¼ã‚¹</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">æˆ¦ç•¥ãƒŸãƒƒã‚¯ã‚¹</div>
                        <div class="metric-label">AIè‡ªå‹•é¸æŠ</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">5-10ç‚¹</div>
                        <div class="metric-label">å³é¸è²·ã„ç›®æ•°</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">Â¥30,000/æœˆ</div>
                        <div class="metric-label">Premiumä¼šå“¡å°‚ç”¨</div>
                    </div>
                </div>
            </div>

            <!-- ç‰¹å¾´èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="feature-explanation">
                <h3 class="feature-title">ğŸ¯ Premium Selectã®ç‰¹å¾´</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <span class="feature-icon">ğŸ¤–</span>
                        <h4>ç´¯ç©ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹è‡ªå‹•åˆ¤å®š</h4>
                        <p>89ptä»¥ä¸Šã¯å°‘ç‚¹æ•°å‹+ãƒãƒ©ãƒ³ã‚¹å‹ã€85ptä»¥ä¸‹ã¯é«˜é…å½“å‹ãªã©ã€AIãŒè‡ªå‹•ã§æœ€é©æˆ¦ç•¥ã‚’é¸æŠ</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">ğŸ¨</span>
                        <h4>æˆ¦ç•¥ãƒŸãƒƒã‚¯ã‚¹</h4>
                        <p>å˜ä¸€æˆ¦ç•¥ã§ã¯ãªãã€è¤‡æ•°æˆ¦ç•¥ã®è²·ã„ç›®ã‚’çµ„ã¿åˆã‚ã›ã€ä¸Šä½ã‚¹ã‚³ã‚¢ã®ã¿æŠ½å‡º</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">ğŸ“Š</span>
                        <h4>è²·ã„ç›®å³é¸</h4>
                        <p>5-10ç‚¹ã«çµã‚Šè¾¼ã¿ã€çš„ä¸­ç‡ã¨è³¼å…¥è² æ‹…ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æœ€é©åŒ–</p>
                    </div>
                </div>
            </div>

            <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¬ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆå³ä¸‹å›ºå®šï¼‰ -->
            <div class="floating-race-selector">
                <button class="floating-selector-toggle" id="raceSelectorToggle">
                    <span class="toggle-icon">ğŸ‡</span>
                    <span class="toggle-text">ãƒ¬ãƒ¼ã‚¹é¸æŠ</span>
                </button>
                <div class="floating-selector-menu" id="raceSelectorMenu" style="display: none;">
                    <div class="selector-header">ğŸ“ ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ</div>
                    <div class="selector-grid">
                        {premiumSelectRaces.map((raceData) => (
                            <button
                                class="selector-race-btn"
                                data-race-number={raceData.raceNumber}
                                onclick={`document.getElementById('race-${raceData.raceNumber}').scrollIntoView({behavior: 'smooth', block: 'start'}); document.getElementById('raceSelectorMenu').style.display = 'none';`}
                            >
                                {raceData.raceNumber}
                            </button>
                        ))}
                    </div>
                </div>
            </div>

            <!-- å…¨ãƒ¬ãƒ¼ã‚¹äºˆæƒ³ -->
            <div class="races-container">
                {premiumSelectRaces.map((raceData, index) => {
                    const premiumSelect = raceData.premiumSelect;
                    const horses = raceData.horses;
                    const strategies = raceData.strategies;

                    return (
                        <div class="race-card" id={`race-${raceData.raceNumber}`}>
                            <div class="race-header">
                                <div class="race-number">{raceData.raceNumber}</div>
                                <div class="race-info">
                                    <h3 class="race-name">{raceData.raceName}</h3>
                                </div>
                            </div>

                            <!-- AIé¸å‡ºé¦¬åˆ†æï¼ˆæœ€åˆã«é…ç½®ï¼‰ -->
                            <div class="analysis-section">
                                <h4 class="section-title">ğŸ¤– AIãƒ¢ãƒ‡ãƒ«é¸å‡ºé¦¬ - è©³ç´°åˆ†æ</h4>

                                {/* æœ¬å‘½ï¼ˆæœ€ã‚‚å¤§ããè¡¨ç¤ºï¼‰ */}
                                {horses.main && (
                                    <div class="horse-card horse-card-main">
                                        <div class="horse-header">
                                            <span class="horse-mark-main">â—</span>
                                            <span class="horse-number-main">{horses.main.number}</span>
                                            <span class="horse-name-main">{horses.main.name}</span>
                                            <span class="horse-type-main">æœ¬å‘½</span>
                                        </div>
                                        <div class="ai-factors">
                                            {horses.main.factors && horses.main.factors.filter(factor =>
                                                factor.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢') ||
                                                factor.text.includes('ç·åˆè©•ä¾¡')
                                            ).map(factor => (
                                                <div class="factor">
                                                    <span class="factor-icon">{factor.icon}</span>
                                                    <span>{factor.text}</span>
                                                </div>
                                            ))}
                                        </div>
                                        {horses.main.importance && (
                                            <div class="feature-importance">
                                                <h5 style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 10px;">ç‰¹å¾´é‡é‡è¦åº¦</h5>
                                                {horses.main.importance.map(item => (
                                                    <div class="importance-bar">
                                                        <span class="importance-label">{item.label}</span>
                                                        <div class="importance-value">
                                                            <div class="importance-fill" style={`width: ${item.value * 100}%;`}>{Math.round(item.value * 100)}%</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* å¯¾æŠ—ï¼ˆä¸­ã‚µã‚¤ã‚ºè¡¨ç¤ºï¼‰ */}
                                {horses.sub && (
                                    <div class="horse-card horse-card-sub">
                                        <div class="horse-header">
                                            <span class="horse-mark-sub">â—‹</span>
                                            <span class="horse-number-sub">{horses.sub.number}</span>
                                            <span class="horse-name-sub">{horses.sub.name}</span>
                                            <span class="horse-type-sub">å¯¾æŠ—</span>
                                        </div>
                                        <div class="ai-factors">
                                            {horses.sub.factors && horses.sub.factors.filter(factor =>
                                                factor.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢') ||
                                                factor.text.includes('ç·åˆè©•ä¾¡')
                                            ).map(factor => (
                                                <div class="factor">
                                                    <span class="factor-icon">{factor.icon}</span>
                                                    <span>{factor.text}</span>
                                                </div>
                                            ))}
                                        </div>
                                        {horses.sub.importance && (
                                            <div class="feature-importance">
                                                <h5 style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 10px;">ç‰¹å¾´é‡é‡è¦åº¦</h5>
                                                {horses.sub.importance.map(item => (
                                                    <div class="importance-bar">
                                                        <span class="importance-label">{item.label}</span>
                                                        <div class="importance-value">
                                                            <div class="importance-fill" style={`width: ${item.value * 100}%;`}>{Math.round(item.value * 100)}%</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* å˜ç©´1ï¼ˆä¸­ã‚µã‚¤ã‚ºè¡¨ç¤ºï¼‰ */}
                                {horses.hole1 && (
                                    <div class="horse-card horse-card-sub">
                                        <div class="horse-header">
                                            <span class="horse-mark-sub">â–²</span>
                                            <span class="horse-number-sub">{horses.hole1.number}</span>
                                            <span class="horse-name-sub">{horses.hole1.name}</span>
                                            <span class="horse-type-hole">å˜ç©´</span>
                                        </div>
                                        <div class="ai-factors">
                                            {horses.hole1.factors && horses.hole1.factors.filter(factor =>
                                                factor.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢') ||
                                                factor.text.includes('ç·åˆè©•ä¾¡')
                                            ).map(factor => (
                                                <div class="factor">
                                                    <span class="factor-icon">{factor.icon}</span>
                                                    <span>{factor.text}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* å˜ç©´2ï¼ˆä¸­ã‚µã‚¤ã‚ºè¡¨ç¤ºï¼‰ */}
                                {horses.hole2 && (
                                    <div class="horse-card horse-card-sub">
                                        <div class="horse-header">
                                            <span class="horse-mark-sub">â–²</span>
                                            <span class="horse-number-sub">{horses.hole2.number}</span>
                                            <span class="horse-name-sub">{horses.hole2.name}</span>
                                            <span class="horse-type-hole">å˜ç©´</span>
                                        </div>
                                        <div class="ai-factors">
                                            {horses.hole2.factors && horses.hole2.factors.filter(factor =>
                                                factor.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢') ||
                                                factor.text.includes('ç·åˆè©•ä¾¡')
                                            ).map(factor => (
                                                <div class="factor">
                                                    <span class="factor-icon">{factor.icon}</span>
                                                    <span>{factor.text}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* é€£ä¸‹å€™è£œé¦¬ï¼ˆã¾ã¨ã‚ã¦è¡¨ç¤ºï¼‰ */}
                                {horses.connect && horses.connect.length > 0 && (
                                    <div class="horse-card horse-card-minor">
                                        <div class="horse-header">
                                            <span class="horse-mark-minor">â–³</span>
                                            <span class="minor-title">é€£ä¸‹å€™è£œé¦¬</span>
                                        </div>
                                        <div class="horse-grid">
                                            {horses.connect.map(horse => {
                                                const scoreText = horse.factors?.find(f => f.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢'))?.text;
                                                const score = scoreText ? scoreText.match(/\d+/)?.[0] : '';
                                                return (
                                                    <div class="horse-grid-item">
                                                        <span class="horse-number-small">{horse.number}</span>
                                                        <span class="horse-name-small">{horse.name}{score ? ` (${score}pt)` : ''}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {/* æŠ‘ãˆå€™è£œé¦¬ï¼ˆã¾ã¨ã‚ã¦è¡¨ç¤ºï¼‰ */}
                                {horses.reserve && horses.reserve.length > 0 && (
                                    <div class="horse-card horse-card-minor">
                                        <div class="horse-header">
                                            <span class="horse-mark-minor">Ã—</span>
                                            <span class="minor-title">æŠ‘ãˆå€™è£œé¦¬</span>
                                        </div>
                                        <div class="horse-grid">
                                            {horses.reserve.map(horse => {
                                                const scoreText = horse.factors?.find(f => f.text.includes('ç´¯ç©ã‚¹ã‚³ã‚¢'))?.text;
                                                const score = scoreText ? scoreText.match(/\d+/)?.[0] : '';
                                                return (
                                                    <div class="horse-grid-item">
                                                        <span class="horse-number-small">{horse.number}</span>
                                                        <span class="horse-name-small">{horse.name}{score ? ` (${score}pt)` : ''}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>

                            <!-- Premium Selectçµã‚Šè¾¼ã¿ãƒœã‚¿ãƒ³ -->
                            <button class="premium-select-filter-btn" data-race-index={index}>
                                <span class="filter-icon">ğŸ¯</span>
                                <span class="filter-text">Premium Select çµã‚Šè¾¼ã‚€</span>
                                <span class="filter-arrow">â–¼</span>
                            </button>

                            <!-- Premium Selectå³é¸è²·ã„ç›®ï¼ˆåˆæœŸéè¡¨ç¤ºãƒ»çµã‚Šè¾¼ã¿å¾Œè¡¨ç¤ºï¼‰ -->
                            <div class="premium-select-highlight" data-race-content={index} style="display: none;">
                                <div class="select-header">
                                    <div class="select-badge">âœ¨ Premium Select å³é¸è²·ã„ç›®</div>
                                    <div class="select-strategy-type">{premiumSelect.strategyType}</div>
                                </div>

                                <div class="score-display">
                                    <span class="score-label">æœ¬å‘½ç´¯ç©ã‚¹ã‚³ã‚¢:</span>
                                    <span class="score-value">{premiumSelect.mainScore}pt</span>
                                </div>

                                <div class="select-bets-list">
                                    {premiumSelect.selectedBets.map((bet, i) => (
                                        <div class="select-bet-item">
                                            <span class="bet-number">{i + 1}</span>
                                            <span class="bet-display">é¦¬å˜ {bet.display}</span>
                                            <span class="bet-score">ã‚¹ã‚³ã‚¢ {bet.score.toFixed(1)}</span>
                                        </div>
                                    ))}
                                </div>

                                <div class="total-points-display">
                                    ğŸ’° åˆè¨ˆ: {premiumSelect.targetPoints}ç‚¹
                                </div>
                            </div>

                            <!-- 3æˆ¦ç•¥è²·ã„ç›®ï¼ˆå…¨è¡¨ç¤ºï¼‰ -->
                            <div class="three-strategies-section">
                                <h4 class="strategies-title">ğŸ“Š 3æˆ¦ç•¥è²·ã„ç›®ï¼ˆå‚è€ƒãƒ»å…¨è¡¨ç¤ºï¼‰</h4>

                                {/* å°‘ç‚¹æ•°çš„ä¸­å‹ */}
                                {strategies?.safe && (
                                    <div class="strategy-card">
                                        <div class="strategy-header">ğŸ¯ å°‘ç‚¹æ•°çš„ä¸­å‹ãƒ¢ãƒ‡ãƒ«</div>
                                        <div class="strategy-bets">
                                            {strategies.safe.bets.map(bet => {
                                                const betStr = typeof bet === 'string' ? bet : bet.numbers;
                                                return (
                                                    <div class="strategy-bet-item">
                                                        <span class="bet-type">é¦¬å˜</span>
                                                        <span class="bet-text">{betStr}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div class="strategy-info">
                                            AIäºˆæ¸¬: {strategies.safe.confidence || strategies.safe.hitRate}%
                                        </div>
                                    </div>
                                )}

                                {/* ãƒãƒ©ãƒ³ã‚¹å‹ */}
                                {strategies?.balance && (
                                    <div class="strategy-card">
                                        <div class="strategy-header">âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹ãƒ¢ãƒ‡ãƒ«</div>
                                        <div class="strategy-bets">
                                            {strategies.balance.bets.map(bet => {
                                                const betStr = typeof bet === 'string' ? bet : bet.numbers;
                                                return (
                                                    <div class="strategy-bet-item">
                                                        <span class="bet-type">é¦¬å˜</span>
                                                        <span class="bet-text">{betStr}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div class="strategy-info">
                                            AIäºˆæ¸¬: {strategies.balance.confidence || strategies.balance.hitRate}%
                                        </div>
                                    </div>
                                )}

                                {/* é«˜é…å½“è¿½æ±‚å‹ */}
                                {strategies?.aggressive && (
                                    <div class="strategy-card">
                                        <div class="strategy-header">ğŸ”¥ é«˜é…å½“è¿½æ±‚å‹ãƒ¢ãƒ‡ãƒ«</div>
                                        <div class="strategy-bets">
                                            {strategies.aggressive.bets.map(bet => {
                                                const betStr = typeof bet === 'string' ? bet : bet.numbers;
                                                return (
                                                    <div class="strategy-bet-item">
                                                        <span class="bet-type">é¦¬å˜</span>
                                                        <span class="bet-text">{betStr}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div class="strategy-info">
                                            AIäºˆæ¸¬: {strategies.aggressive.confidence || strategies.aggressive.hitRate}%
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                })}
            </div>

            <!-- Stripe Payment Linkã¯å¾Œã§è¿½åŠ ï¼ˆPhase 1ã¯manualï¼‰ -->
            <div class="upgrade-notice">
                <h3>ğŸ’ Premium Select ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h3>
                <p>ç¾åœ¨Premiumä¼šå“¡ã®æ–¹ã¯ã€ç®¡ç†è€…ï¼ˆnankan.analytics@gmail.comï¼‰ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
                <p><strong>æœˆé¡Â¥30,000</strong> ã§ç´¯ç©ã‚¹ã‚³ã‚¢ãƒ™ãƒ¼ã‚¹ã®å³é¸è²·ã„ç›®ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>
            </div>
        </div>
    </AccessControl>
</BaseLayout>

<style>
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    /* èƒŒæ™¯ãƒ‘ã‚¿ãƒ¼ãƒ³å¼·åŒ–ï¼ˆã‚¬ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ åŠ¹æœã‚’å¯è¦–åŒ–ï¼‰ */
    body {
        background:
            linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
            linear-gradient(45deg, rgba(251, 191, 36, 0.05) 0%, transparent 50%),
            linear-gradient(225deg, rgba(16, 185, 129, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 50%, rgba(239, 68, 68, 0.1) 0%, transparent 50%),
            #0f172a;
        background-attachment: fixed;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .header-section {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .premium-select-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: rgb(251, 191, 36);
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 400;
        margin-bottom: 20px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .race-title {
        font-size: 2rem;
        margin-bottom: 20px;
        color: #fff;
    }

    .premium-select-description {
        background: rgba(251, 191, 36, 0.1);
        border-left: 4px solid #fbbf24;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    .select-intro {
        color: #e2e8f0;
        font-size: 1.1rem;
        line-height: 1.8;
    }

    .ai-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .metric {
        text-align: center;
    }

    .metric-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #fbbf24;
        margin-bottom: 8px;
    }

    .metric-label {
        font-size: 0.9rem;
        color: #94a3b8;
    }

    /* ç‰¹å¾´èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .feature-explanation {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .feature-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #fbbf24;
    }

    .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    .feature-card {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.15) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 20px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .feature-icon {
        font-size: 2rem;
        display: block;
        margin-bottom: 15px;
    }

    .feature-card h4 {
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: #fbbf24;
    }

    .feature-card p {
        color: #cbd5e1;
        font-size: 0.9rem;
        line-height: 1.6;
    }

    /* ãƒ¬ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ */
    .races-container {
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    .race-card {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 30px;
        box-shadow:
            inset 0 0 0 0.5px rgba(59, 130, 246, 0.4),
            0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .race-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .race-number {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.25) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: rgb(96, 165, 250);
        padding: 10px 20px;
        border-radius: 12px;
        font-weight: 400;
        font-size: 1.2rem;
        box-shadow:
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.5),
            0 2px 8px rgba(96, 165, 250, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .race-name {
        color: #e2e8f0;
        font-size: 1.1rem;
    }

    .strategy-type-badge {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: rgb(251, 191, 36);
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: 400;
        font-size: 1.1rem;
        margin-bottom: 20px;
        display: inline-block;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .score-display {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 20px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.4),
            0 2px 8px rgba(251, 191, 36, 0.15);
    }

    .score-label {
        color: #cbd5e1;
        font-size: 0.95rem;
    }

    .score-value {
        color: rgb(251, 191, 36);
        font-weight: 400;
        font-size: 1.2rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Premium Selectçµã‚Šè¾¼ã¿ãƒœã‚¿ãƒ³ */
    .premium-select-filter-btn {
        width: 100%;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        border: none;
        border-radius: 12px;
        padding: 18px 25px;
        margin-bottom: 20px;
        color: #000;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .premium-select-filter-btn:hover {
        background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    }

    .premium-select-filter-btn:active {
        transform: translateY(0);
    }

    .premium-select-filter-btn.filtering {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        animation: pulse 1s ease-in-out infinite;
    }

    .premium-select-filter-btn.filtered {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }

    .filter-icon {
        font-size: 1.3rem;
    }

    .filter-text {
        flex: 1;
        text-align: center;
    }

    .filter-arrow {
        transition: transform 0.3s ease;
    }

    .premium-select-filter-btn.filtered .filter-arrow {
        transform: rotate(180deg);
    }

    /* Premium Selectå³é¸è²·ã„ç›®ï¼ˆæœ€å„ªå…ˆè¡¨ç¤ºï¼‰ */
    .premium-select-highlight {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 4px 16px rgba(251, 191, 36, 0.15);
        animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .select-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .select-badge {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: rgb(251, 191, 36);
        padding: 10px 20px;
        border-radius: 12px;
        font-weight: 400;
        font-size: 1.1rem;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .select-strategy-type {
        color: #fbbf24;
        font-weight: 600;
        font-size: 1rem;
    }

    .select-bets-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
    }

    .select-bet-item {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.15) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 10px;
        padding: 14px 18px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .total-points-display {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        text-align: center;
        font-size: 1.2rem;
        color: rgb(251, 191, 36);
        font-weight: 400;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* 3æˆ¦ç•¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .three-strategies-section {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow:
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.4),
            0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .strategies-title {
        color: #60a5fa;
        font-size: 1.2rem;
        margin-bottom: 20px;
        font-weight: 600;
    }

    .strategy-card {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.15) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .strategy-card:last-child {
        margin-bottom: 0;
    }

    .strategy-header {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: #e2e8f0;
    }

    .strategy-bets {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 15px;
    }

    .strategy-bet-item {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 8px;
        padding: 10px 14px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.3),
            0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .bet-type {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(168, 85, 247, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(196, 181, 253);
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 400;
        box-shadow:
            inset 0 0 0 0.5px rgba(139, 92, 246, 0.5),
            0 2px 8px rgba(139, 92, 246, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .bet-text {
        flex: 1;
        color: #e2e8f0;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
    }

    .strategy-info {
        color: #94a3b8;
        font-size: 0.9rem;
        text-align: right;
        font-weight: 600;
    }

    /* è²·ã„ç›®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ—§ï¼‰ - å‰Šé™¤ã¾ãŸã¯çµ±åˆ */
    .select-bets-section {
        background: rgba(15, 23, 42, 0.6);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .section-title {
        color: #fbbf24;
        font-size: 1.1rem;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .bets-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .bet-item {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 8px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow:
            inset 0 0 0 0.5px rgba(255, 255, 255, 0.05),
            0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .bet-number {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(96, 165, 250);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 400;
        font-size: 0.9rem;
        box-shadow:
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.5),
            0 2px 8px rgba(96, 165, 250, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .bet-display {
        flex: 1;
        color: #e2e8f0;
        font-family: 'Courier New', monospace;
        font-weight: 600;
    }

    .bet-score {
        color: #fbbf24;
        font-size: 0.85rem;
        background: rgba(251, 191, 36, 0.15);
        padding: 4px 10px;
        border-radius: 6px;
    }

    /* AIé¸å‡ºé¦¬åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .analysis-section {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow:
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.4),
            0 4px 16px rgba(0, 0, 0, 0.1);
    }

    /* é¦¬ã‚«ãƒ¼ãƒ‰å…±é€š */
    .horse-card {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.15) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    /* æœ¬å‘½ã‚«ãƒ¼ãƒ‰ */
    .horse-card-main {
        box-shadow:
            inset 0 0 0 0.5px rgba(239, 68, 68, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .horse-mark-main {
        font-size: 2rem;
        margin-right: 12px;
    }

    .horse-number-main {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(248, 113, 113);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 400;
        font-size: 1.4rem;
        margin-right: 12px;
        box-shadow:
            inset 0 0 0 0.5px rgba(239, 68, 68, 0.5),
            0 2px 8px rgba(239, 68, 68, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .horse-name-main {
        font-size: 1.4rem;
        font-weight: 700;
        color: #e2e8f0;
        margin-right: 12px;
    }

    .horse-type-main {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(248, 113, 113);
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 400;
        box-shadow:
            inset 0 0 0 0.5px rgba(239, 68, 68, 0.5),
            0 2px 8px rgba(239, 68, 68, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* å¯¾æŠ—ãƒ»å˜ç©´ã‚«ãƒ¼ãƒ‰ */
    .horse-card-sub {
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .horse-mark-sub {
        font-size: 1.5rem;
        margin-right: 10px;
    }

    .horse-number-sub {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(251, 191, 36);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 400;
        font-size: 1.2rem;
        margin-right: 10px;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .horse-name-sub {
        font-size: 1.2rem;
        font-weight: 600;
        color: #e2e8f0;
        margin-right: 10px;
    }

    .horse-type-sub {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(251, 191, 36);
        padding: 5px 12px;
        border-radius: 16px;
        font-size: 0.85rem;
        font-weight: 400;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 2px 8px rgba(251, 191, 36, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .horse-type-hole {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(52, 211, 153);
        padding: 5px 12px;
        border-radius: 16px;
        font-size: 0.85rem;
        font-weight: 400;
        box-shadow:
            inset 0 0 0 0.5px rgba(16, 185, 129, 0.5),
            0 2px 8px rgba(16, 185, 129, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .horse-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    /* AIè¦å›  */
    .ai-factors {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
    }

    .factor {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #cbd5e1;
        font-size: 0.95rem;
    }

    .factor-icon {
        font-size: 1.1rem;
    }

    /* ç‰¹å¾´é‡é‡è¦åº¦ */
    .feature-importance {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 8px;
        padding: 15px;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.4),
            0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .importance-bar {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 10px;
    }

    .importance-bar:last-child {
        margin-bottom: 0;
    }

    .importance-label {
        color: #94a3b8;
        font-size: 0.85rem;
        min-width: 90px;
    }

    .importance-value {
        flex: 1;
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.3) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 20px;
        height: 24px;
        position: relative;
        overflow: hidden;
        box-shadow:
            inset 0 0 0 0.5px rgba(96, 165, 250, 0.7),
            inset 0 1px 2px rgba(0, 0, 0, 0.05),
            0 1px 4px rgba(0, 0, 0, 0.05);
    }

    .importance-fill {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(59, 130, 246, 0.25) 50%, rgba(37, 99, 235, 0.2) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 20px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding-right: 8px;
        color: rgb(96, 165, 250);
        font-size: 0.75rem;
        font-weight: 400;
        transition: width 0.3s ease;
        box-shadow: 0 2px 8px rgba(96, 165, 250, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3), 0 0 15px currentColor;
    }

    .importance-fill:hover {
        filter: brightness(1.1);
    }

    /* é€£ä¸‹ãƒ»æŠ‘ãˆã‚«ãƒ¼ãƒ‰ */
    .horse-card-minor {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.15) 0%, rgba(30, 41, 59, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.4),
            0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .horse-mark-minor {
        font-size: 1.3rem;
        margin-right: 10px;
    }

    .minor-title {
        color: #f59e0b;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .horse-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }

    .horse-grid-item {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 8px;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.4),
            0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .horse-number-small {
        background: linear-gradient(135deg, rgba(100, 116, 139, 0.15) 0%, rgba(71, 85, 105, 0.25) 100%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: rgb(148, 163, 184);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 400;
        font-size: 0.9rem;
        flex-shrink: 0;
        box-shadow:
            inset 0 0 0 0.5px rgba(100, 116, 139, 0.5),
            0 2px 8px rgba(100, 116, 139, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .horse-name-small {
        color: #cbd5e1;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ¡ˆå†… */
    .upgrade-notice {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        padding: 30px;
        margin-top: 40px;
        text-align: center;
        box-shadow:
            inset 0 0 0 0.5px rgba(251, 191, 36, 0.5),
            0 4px 16px rgba(251, 191, 36, 0.15);
    }

    .upgrade-notice h3 {
        color: rgb(251, 191, 36);
        font-size: 1.8rem;
        font-weight: 400;
        margin-bottom: 15px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .upgrade-notice p {
        color: #cbd5e1;
        font-size: 1.1rem;
        margin-bottom: 10px;
    }

    /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¬ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆå³ä¸‹å›ºå®šï¼‰ */
    .floating-race-selector {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
    }

    .floating-selector-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 15px 25px;
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(217, 119, 6, 0.25) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 50px;
        color: rgb(245, 158, 11);
        font-size: 1rem;
        font-weight: 400;
        cursor: pointer;
        box-shadow:
            inset 0 0 0 0.5px rgba(245, 158, 11, 0.5),
            0 4px 16px rgba(245, 158, 11, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        animation: pulse-glow 2s infinite;
    }

    .floating-selector-toggle:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow:
            inset 0 0 0 0.5px rgba(245, 158, 11, 0.7),
            0 8px 25px rgba(245, 158, 11, 0.25);
        filter: brightness(1.1);
    }

    .floating-selector-toggle:active {
        transform: translateY(-1px) scale(1.02);
    }

    .toggle-icon {
        font-size: 1.3rem;
    }

    .toggle-text {
        font-size: 1rem;
    }

    @keyframes pulse-glow {
        0%, 100% {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        50% {
            box-shadow: 0 8px 35px rgba(245, 158, 11, 0.6);
        }
    }

    .floating-selector-menu {
        position: absolute;
        bottom: 80px;
        right: 0;
        min-width: 280px;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.15) 0%, rgba(15, 23, 42, 0.25) 100%);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border-radius: 16px;
        padding: 20px;
        box-shadow:
            inset 0 0 0 0.5px rgba(59, 130, 246, 0.5),
            0 12px 40px rgba(0, 0, 0, 0.5),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .selector-header {
        color: #60a5fa;
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 15px;
        text-align: center;
        border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        padding-bottom: 10px;
    }

    .selector-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
    }

    .selector-race-btn {
        padding: 12px;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.2) 100%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 10px;
        color: #cbd5e1;
        font-size: 0.95rem;
        font-weight: 400;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow:
            inset 0 0 0 0.5px rgba(59, 130, 246, 0.4),
            0 2px 8px rgba(59, 130, 246, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .selector-race-btn:hover {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(37, 99, 235, 0.3) 100%);
        color: rgb(96, 165, 250);
        transform: translateY(-2px);
        box-shadow:
            inset 0 0 0 0.5px rgba(59, 130, 246, 0.7),
            0 6px 16px rgba(59, 130, 246, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        filter: brightness(1.1);
    }

    .selector-race-btn:active {
        transform: translateY(0);
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
        .race-title {
            font-size: 1.5rem;
        }

        .ai-metrics {
            grid-template-columns: 1fr 1fr;
        }

        .feature-grid {
            grid-template-columns: 1fr;
        }

        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        .floating-race-selector {
            bottom: 20px;
            right: 20px;
        }

        .floating-selector-toggle {
            padding: 12px 20px;
            font-size: 0.9rem;
        }

        .toggle-icon {
            font-size: 1.2rem;
        }

        .toggle-text {
            font-size: 0.9rem;
        }

        .floating-selector-menu {
            min-width: 260px;
            padding: 15px;
        }

        .selector-header {
            font-size: 1rem;
        }

        .selector-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .selector-race-btn {
            padding: 10px;
            font-size: 0.85rem;
        }
    }
</style>

<script is:inline>
    // Premium Selectçµã‚Šè¾¼ã¿ãƒœã‚¿ãƒ³ã®å‹•ä½œ
    document.addEventListener('DOMContentLoaded', () => {
        const filterButtons = document.querySelectorAll('.premium-select-filter-btn');

        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                const raceIndex = this.getAttribute('data-race-index');
                const content = document.querySelector(`[data-race-content="${raceIndex}"]`);
                const filterText = this.querySelector('.filter-text');
                const isVisible = content.style.display !== 'none';

                if (isVisible) {
                    // é–‰ã˜ã‚‹
                    content.style.display = 'none';
                    this.classList.remove('filtered');
                    filterText.textContent = 'Premium Select çµã‚Šè¾¼ã‚€';
                } else {
                    // çµã‚Šè¾¼ã¿æ¼”å‡º
                    this.classList.add('filtering');
                    this.classList.remove('filtered');
                    filterText.textContent = 'çµã‚Šè¾¼ã¿ä¸­...';

                    // 1.8ç§’å¾Œã«çµæœè¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¼”å‡ºï¼‰
                    setTimeout(() => {
                        content.style.display = 'block';
                        this.classList.remove('filtering');
                        this.classList.add('filtered');
                        filterText.textContent = 'âœ… çµã‚Šè¾¼ã¿å®Œäº†ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼‰';
                    }, 1800);
                }
            });
        });

        // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¬ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ - ãƒˆã‚°ãƒ«æ©Ÿèƒ½
        const selectorToggle = document.getElementById('raceSelectorToggle');
        const selectorMenu = document.getElementById('raceSelectorMenu');

        if (selectorToggle && selectorMenu) {
            selectorToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isVisible = selectorMenu.style.display !== 'none';
                selectorMenu.style.display = isVisible ? 'none' : 'block';
            });

            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.floating-race-selector')) {
                    selectorMenu.style.display = 'none';
                }
            });
        }
    });
</script>
