---
export const prerender = true;
import BaseLayout from '../../../layouts/BaseLayout.astro';

const title = 'LSTMã‚’ä½¿ã£ãŸæ™‚ç³»åˆ—äºˆæƒ³ãƒ¢ãƒ‡ãƒ« - TensorFlowå®Ÿè£…ä¾‹ | NANKANã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹';
const description = 'TensorFlowã§LSTMãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã—ã€ç«¶é¦¬ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰äºˆæƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’è©³è§£ã€‚é¦¬ã®æˆé•·æ›²ç·šãƒ»èª¿å­ã®æ³¢ã‚’æ™‚ç³»åˆ—ã§åˆ†æã—ã€é«˜ç²¾åº¦ãªäºˆæƒ³ã‚’å®Ÿç¾ã€‚';
---

<BaseLayout title={title} description={description}>
    <article class="article-content">
        <header class="article-header">
            <div class="breadcrumb">
                <a href="/">ãƒ›ãƒ¼ãƒ </a> â†’ <a href="/deep-learning">æ·±å±¤å­¦ç¿’</a> â†’ LSTMã‚’ä½¿ã£ãŸæ™‚ç³»åˆ—äºˆæƒ³ãƒ¢ãƒ‡ãƒ«
            </div>
            <span class="article-category">æ·±å±¤å­¦ç¿’</span>
            <h1 class="article-title">LSTMã‚’ä½¿ã£ãŸæ™‚ç³»åˆ—äºˆæƒ³ãƒ¢ãƒ‡ãƒ« - TensorFlowå®Ÿè£…ä¾‹</h1>
            <div class="article-meta">
                <span>ğŸ“… 2025å¹´01æœˆ10æ—¥</span>
                <span>â±ï¸ 12åˆ†ã§èª­ã‚ã‚‹</span>
                <span>ğŸ·ï¸ LSTM, TensorFlow, æ™‚ç³»åˆ—åˆ†æ, æ·±å±¤å­¦ç¿’</span>
            </div>
        </header>

        <div class="article-body">
            <section>
                <h2>ğŸ¯ ã¯ã˜ã‚ã«</h2>
                <p>
                    ç«¶é¦¬äºˆæƒ³ã«ãŠã„ã¦ã€é¦¬ã®éå»ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ™‚ç³»åˆ—å¤‰åŒ–ã‚’æ‰ãˆã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚
                    æœ¬è¨˜äº‹ã§ã¯ã€LSTMï¼ˆLong Short-Term Memoryï¼‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€
                    é¦¬ã®æˆé•·æ›²ç·šã‚„èª¿å­ã®æ³¢ã‚’åˆ†æã—ã€é«˜ç²¾åº¦ãªäºˆæƒ³ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚
                </p>

                <div class="highlight-box">
                    <h3>ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨</h3>
                    <ul>
                        <li>LSTMã®åŸºæœ¬æ¦‚å¿µã¨ç«¶é¦¬ã¸ã®å¿œç”¨</li>
                        <li>TensorFlowã§ã®LSTMãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å®Ÿè£…</li>
                        <li>æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†ã¨ç‰¹å¾´é‡ä½œæˆ</li>
                        <li>Attentionæ©Ÿæ§‹ã‚’å«ã‚€é«˜åº¦ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</li>
                        <li>ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã¨äºˆæƒ³ç²¾åº¦ã®å‘ä¸Šæ‰‹æ³•</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>ğŸ§  1. LSTMã®åŸºæœ¬æ¦‚å¿µ</h2>

                <h3>LSTMã¨ã¯</h3>
                <p>
                    LSTMï¼ˆLong Short-Term Memoryï¼‰ã¯ã€å¾“æ¥ã®RNNã®å•é¡Œç‚¹ã§ã‚ã‚‹å‹¾é…æ¶ˆå¤±å•é¡Œã‚’è§£æ±ºã—ãŸ
                    æ·±å±¤å­¦ç¿’ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ã€‚ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã«ãŠã„ã¦ã¯ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æ´»ç”¨ã§ãã¾ã™ï¼š
                </p>

                <div class="concept-box">
                    <h4>ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã§ã®LSTMã®åˆ©ç‚¹</h4>
                    <ul>
                        <li><strong>é•·æœŸè¨˜æ†¶</strong>: é¦¬ã®é•·æœŸçš„ãªæˆé•·æ›²ç·šã‚’è¨˜æ†¶</li>
                        <li><strong>çŸ­æœŸè¨˜æ†¶</strong>: æœ€è¿‘ã®èª¿å­ã‚„çŠ¶æ…‹å¤‰åŒ–ã‚’æ‰ãˆã‚‹</li>
                        <li><strong>ã‚²ãƒ¼ãƒˆæ©Ÿæ§‹</strong>: é‡è¦ãªæƒ…å ±ã‚’é¸æŠçš„ã«ä¿æŒãƒ»æ›´æ–°</li>
                        <li><strong>æ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³</strong>: å­£ç¯€è¦å› ã‚„å‘¨æœŸçš„ãªå¤‰å‹•ã‚’å­¦ç¿’</li>
                    </ul>
                </div>

                <h3>ç’°å¢ƒè¨­å®š</h3>
                <pre><code># å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install tensorflow pandas numpy matplotlib scikit-learn</code></pre>

                <pre><code>import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense, Dropout
import pandas as pd
import numpy as np

print("TensorFlow version", tf.__version__)
print("GPU available", tf.config.list_physical_devices('GPU'))</code></pre>
            </section>

            <section>
                <h2>ğŸ“Š 2. æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™</h2>

                <h3>ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨å‰å‡¦ç†</h3>
                <pre><code># ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
race_data = pd.read_csv('horse_race_history.csv')

# æ—¥ä»˜å‹å¤‰æ›
race_data['race_date'] = pd.to_datetime(race_data['race_date'])

# é¦¬ã”ã¨ã«æ™‚ç³»åˆ—é †ã«ã‚½ãƒ¼ãƒˆ
race_data = race_data.sort_values(['horse_id', 'race_date'])

print("ãƒ‡ãƒ¼ã‚¿å½¢çŠ¶", race_data.shape)
print("æœŸé–“", race_data['race_date'].min(), "ï½", race_data['race_date'].max())</code></pre>

                <h3>æ™‚ç³»åˆ—ç‰¹å¾´é‡ã®ä½œæˆ</h3>
                <pre><code>def create_time_series_features(df):
    # åŸºæœ¬ç‰¹å¾´é‡
    features = [
        'finish_position',    # ç€é †
        'horse_weight',       # é¦¬ä½“é‡
        'jockey_weight',      # é¨æ‰‹é‡é‡
        'odds',              # ã‚ªãƒƒã‚º
        'race_distance',     # è·é›¢
    ]

    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®è¨ˆç®—
    df['position_score'] = 1.0 / df['finish_position']  # ç€é †ã®é€†æ•°
    df['win_flag'] = (df['finish_position'] == 1).astype(int)

    # ãƒ¬ãƒ¼ã‚¹é–“éš”
    df['days_since_last'] = df.groupby('horse_id')['race_date'].diff().dt.days
    df['days_since_last'] = df['days_since_last'].fillna(30)

    time_features = features + ['position_score', 'win_flag', 'days_since_last']
    return df, time_features

race_data, feature_columns = create_time_series_features(race_data)</code></pre>

                <h3>ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</h3>
                <pre><code>def create_sequences(df, feature_columns, sequence_length=5):
    sequences = []
    targets = []

    for horse_id in df['horse_id'].unique():
        horse_data = df[df['horse_id'] == horse_id].copy()

        if len(horse_data) < sequence_length + 1:
            continue

        # æ­£è¦åŒ–
        from sklearn.preprocessing import StandardScaler
        scaler = StandardScaler()
        horse_features = scaler.fit_transform(horse_data[feature_columns])

        # ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ä½œæˆ
        for i in range(len(horse_features) - sequence_length):
            seq = horse_features[i:i+sequence_length]
            target = horse_data.iloc[i+sequence_length]['win_flag']

            sequences.append(seq)
            targets.append(target)

    return np.array(sequences), np.array(targets)

sequence_length = 5
X_sequences, y_sequences = create_sequences(race_data, feature_columns, sequence_length)

print("ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ•°", len(X_sequences))
print("ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å½¢çŠ¶", X_sequences.shape)</code></pre>
            </section>

            <section>
                <h2>ğŸ¤– 3. LSTMãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰</h2>

                <h3>åŸºæœ¬çš„ãªLSTMãƒ¢ãƒ‡ãƒ«</h3>
                <pre><code>from sklearn.model_selection import train_test_split

# ãƒ‡ãƒ¼ã‚¿åˆ†å‰²
X_train, X_test, y_train, y_test = train_test_split(
    X_sequences, y_sequences, test_size=0.2, random_state=42
)

# LSTMãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰
model = Sequential([
    LSTM(64, return_sequences=True, input_shape=(sequence_length, len(feature_columns))),
    Dropout(0.2),
    LSTM(32, return_sequences=False),
    Dropout(0.2),
    Dense(16, activation='relu'),
    Dense(1, activation='sigmoid')
])

model.compile(
    optimizer='adam',
    loss='binary_crossentropy',
    metrics=['accuracy']
)

print(model.summary())</code></pre>

                <h3>ãƒ¢ãƒ‡ãƒ«ã®è¨“ç·´</h3>
                <pre><code>from tensorflow.keras.callbacks import EarlyStopping

# ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
early_stopping = EarlyStopping(
    monitor='val_loss',
    patience=10,
    restore_best_weights=True
)

# è¨“ç·´
history = model.fit(
    X_train, y_train,
    validation_data=(X_test, y_test),
    epochs=100,
    batch_size=32,
    callbacks=[early_stopping],
    verbose=1
)

# è©•ä¾¡
from sklearn.metrics import accuracy_score
y_pred = (model.predict(X_test) > 0.5).astype(int)
accuracy = accuracy_score(y_test, y_pred)

print("LSTMç²¾åº¦", accuracy)</code></pre>
            </section>

            <section>
                <h2>ğŸ“ˆ 4. ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã¨å®Ÿç”¨åŒ–</h2>

                <h3>å­¦ç¿’æ›²ç·šã®å¯è¦–åŒ–</h3>
                <pre><code>import matplotlib.pyplot as plt

plt.figure(figsize=(12, 4))

plt.subplot(1, 2, 1)
plt.plot(history.history['loss'], label='Training Loss')
plt.plot(history.history['val_loss'], label='Validation Loss')
plt.title('Model Loss')
plt.xlabel('Epoch')
plt.ylabel('Loss')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(history.history['accuracy'], label='Training Accuracy')
plt.plot(history.history['val_accuracy'], label='Validation Accuracy')
plt.title('Model Accuracy')
plt.xlabel('Epoch')
plt.ylabel('Accuracy')
plt.legend()

plt.tight_layout()
plt.show()</code></pre>

                <h3>å®Ÿç”¨çš„ãªäºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ </h3>
                <pre><code>class HorseRacingLSTMPredictor:
    def __init__(self, model, scaler, feature_columns, sequence_length):
        self.model = model
        self.scaler = scaler
        self.feature_columns = feature_columns
        self.sequence_length = sequence_length

    def predict_horse_performance(self, horse_history):
        if len(horse_history) < self.sequence_length:
            return None

        # æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        recent_history = horse_history.tail(self.sequence_length)

        # ç‰¹å¾´é‡æ­£è¦åŒ–
        features = self.scaler.transform(recent_history[self.feature_columns])
        sequence = features.reshape(1, self.sequence_length, -1)

        # äºˆæ¸¬
        win_probability = self.model.predict(sequence)[0][0]
        return win_probability

# äºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
predictor = HorseRacingLSTMPredictor(
    model=model,
    scaler=scaler,
    feature_columns=feature_columns,
    sequence_length=sequence_length
)

print("LSTMäºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸï¼")</code></pre>
            </section>

            <section>
                <h2>ğŸ¯ ã¾ã¨ã‚</h2>
                <p>
                    æœ¬è¨˜äº‹ã§ã¯ã€LSTMã‚’ä½¿ã£ãŸç«¶é¦¬ã®æ™‚ç³»åˆ—äºˆæƒ³ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã—ãŸã€‚
                    ç‰¹ã«é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
                </p>

                <div class="summary-box">
                    <h3>é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ</h3>
                    <ul>
                        <li><strong>æ™‚ç³»åˆ—ã®é‡è¦æ€§</strong>: é¦¬ã®æˆé•·æ›²ç·šã‚„èª¿å­ã®æ³¢ã‚’æ‰ãˆã‚‹</li>
                        <li><strong>LSTMæ§‹é€ </strong>: é•·æœŸãƒ»çŸ­æœŸä¸¡æ–¹ã®è¨˜æ†¶ã‚’æ´»ç”¨</li>
                        <li><strong>ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ã®èª¿æ•´</strong>: é©åˆ‡ãªéå»ãƒ¬ãƒ¼ã‚¹æ•°ã®è¨­å®šãŒé‡è¦</li>
                        <li><strong>ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°</strong>: æ™‚ç³»åˆ—ç‰¹æœ‰ã®ç‰¹å¾´é‡ä½œæˆ</li>
                        <li><strong>å®Ÿç”¨åŒ–</strong>: äºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã®å®Ÿè£…</li>
                    </ul>
                </div>

                <div class="technical-note">
                    <h3>æŠ€è¡“çš„ãªç™ºå±•å¯èƒ½æ€§</h3>
                    <ul>
                        <li><strong>Attentionæ©Ÿæ§‹</strong>: ã‚ˆã‚Šé‡è¦ãªã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã«æ³¨ç›®</li>
                        <li><strong>å¤šå¤‰é‡æ™‚ç³»åˆ—</strong>: è¤‡æ•°é¦¬ã®ç›¸äº’ä½œç”¨ã‚’è€ƒæ…®</li>
                        <li><strong>å¼·åŒ–å­¦ç¿’</strong>: æŠ•è³‡æˆ¦ç•¥ã®æœ€é©åŒ–</li>
                        <li><strong>Transformer</strong>: ã‚ˆã‚Šé«˜åº¦ãªæ™‚ç³»åˆ—ãƒ¢ãƒ‡ãƒ«</li>
                    </ul>
                </div>

                <p>
                    LSTMã‚’åŸºç›¤ã¨ã—ã¦ã€ã•ã‚‰ã«é«˜åº¦ãªæ·±å±¤å­¦ç¿’æ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€
                    ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„ç«¶é¦¬äºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚
                </p>
            </section>

            <div class="article-navigation">
                <div class="nav-prev">
                    <a href="/deep-learning/">â† æ·±å±¤å­¦ç¿’è¨˜äº‹ä¸€è¦§</a>
                </div>
                <div class="nav-next">
                    <a href="/machine-learning/python-horse-racing-data-analysis/">Python ãƒ‡ãƒ¼ã‚¿åˆ†æ â†’</a>
                </div>
            </div>
        </div>
    </article>
</BaseLayout>

<style>
    .article-content {
        max-width: 900px;
        margin: 0 auto;
        padding: 40px 20px;
        line-height: 1.8;
        color: #e2e8f0;
    }

    .article-header {
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(139, 92, 246, 0.3);
    }

    .breadcrumb {
        color: #94a3b8;
        margin-bottom: 15px;
        font-size: 0.9rem;
    }

    .breadcrumb a {
        color: #c084fc;
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    .article-category {
        background: linear-gradient(135deg, #8b5cf6, #ec4899);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 15px;
    }

    .article-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 20px 0;
        background: linear-gradient(135deg, #c084fc, #f472b6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
    }

    .article-meta {
        color: #94a3b8;
        font-size: 0.9rem;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .article-body {
        color: #cbd5e1;
    }

    .article-body h2 {
        color: #c084fc;
        font-size: 1.8rem;
        font-weight: 700;
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(139, 92, 246, 0.2);
    }

    .article-body h3 {
        color: #f472b6;
        font-size: 1.3rem;
        font-weight: 600;
        margin: 30px 0 15px 0;
    }

    .article-body h4 {
        color: #fbbf24;
        font-size: 1.1rem;
        font-weight: 600;
        margin: 20px 0 10px 0;
    }

    .article-body p {
        margin-bottom: 20px;
        line-height: 1.8;
    }

    .highlight-box, .summary-box, .concept-box, .technical-note {
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
    }

    .highlight-box {
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .summary-box {
        background: rgba(244, 114, 182, 0.1);
        border: 1px solid rgba(244, 114, 182, 0.3);
    }

    .concept-box {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .technical-note {
        background: rgba(251, 191, 36, 0.1);
        border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .highlight-box h3, .summary-box h3, .concept-box h3, .concept-box h4, .technical-note h3 {
        margin-top: 0;
        margin-bottom: 15px;
    }

    .highlight-box h3 {
        color: #c084fc;
    }

    .summary-box h3 {
        color: #f472b6;
    }

    .concept-box h3, .concept-box h4 {
        color: #22c55e;
    }

    .technical-note h3 {
        color: #fbbf24;
    }

    .highlight-box ul, .summary-box ul, .concept-box ul, .technical-note ul {
        margin: 0;
        padding-left: 20px;
    }

    .highlight-box li, .summary-box li, .concept-box li, .technical-note li {
        margin-bottom: 8px;
        color: #e2e8f0;
    }

    pre {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        padding: 20px;
        overflow-x: auto;
        margin: 20px 0;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
        font-size: 0.9rem;
        line-height: 1.6;
    }

    code {
        color: #fbbf24;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }

    .article-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 60px;
        padding-top: 30px;
        border-top: 1px solid rgba(139, 92, 246, 0.3);
    }

    .nav-prev a, .nav-next a {
        color: #c084fc;
        text-decoration: none;
        padding: 12px 20px;
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .nav-prev a:hover, .nav-next a:hover {
        background: rgba(139, 92, 246, 0.1);
        border-color: #c084fc;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    @media (max-width: 768px) {
        .article-content {
            padding: 20px 15px;
        }

        .article-title {
            font-size: 2rem;
        }

        .article-meta {
            flex-direction: column;
            gap: 10px;
        }

        .article-navigation {
            flex-direction: column;
            gap: 15px;
        }

        pre {
            font-size: 0.8rem;
            padding: 15px;
        }
    }
</style>