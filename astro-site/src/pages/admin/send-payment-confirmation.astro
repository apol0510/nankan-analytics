---
// å…¥é‡‘ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡ç®¡ç†ç”»é¢
---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¥é‡‘ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡ - NANKANã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 40px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }

    .header h1 {
      color: #1e293b;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .header p {
      color: #64748b;
      font-size: 0.95rem;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h2 {
      color: #334155;
      font-size: 1.2rem;
      margin-bottom: 20px;
      padding-left: 10px;
      border-left: 4px solid #3b82f6;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: #475569;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-group .hint {
      color: #64748b;
      font-size: 0.85rem;
      margin-top: 5px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      flex: 1;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #475569;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    .status-box {
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .status-box.success {
      background: #d1fae5;
      border: 2px solid #10b981;
      color: #065f46;
    }

    .status-box.error {
      background: #fee2e2;
      border: 2px solid #ef4444;
      color: #991b1b;
    }

    .status-box.loading {
      background: #dbeafe;
      border: 2px solid #3b82f6;
      color: #1e40af;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #1e40af;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .info-box {
      background: #f0f9ff;
      border-left: 4px solid #0ea5e9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .info-box h3 {
      color: #0c4a6e;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    .info-box ul {
      color: #075985;
      font-size: 0.9rem;
      padding-left: 20px;
    }

    .info-box li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ’° å…¥é‡‘ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡</h1>
      <p>éŠ€è¡ŒæŒ¯è¾¼ã®å…¥é‡‘ã‚’ç¢ºèªã—ãŸå¾Œã€é¡§å®¢ã«ã€Œã‚ã‚ŠãŒã¨ã†ãƒ¡ãƒ¼ãƒ« + ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã€ã‚’é€ä¿¡ã—ã¾ã™</p>
    </div>

    <div class="info-box">
      <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h3>
      <ul>
        <li>éŠ€è¡Œå£åº§ã§å…¥é‡‘ã‚’ç¢ºèª</li>
        <li>ä¸‹è¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã«é¡§å®¢æƒ…å ±ã‚’å…¥åŠ›</li>
        <li>ã€Œãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
        <li>é¡§å®¢ã«ã€Œå…¥é‡‘ã‚ã‚ŠãŒã¨ã† + ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã€ãƒ¡ãƒ¼ãƒ«ãŒè‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã™</li>
        <li>Airtable Record ID ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€StatusãŒ "pending" â†’ "active" ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™</li>
      </ul>
    </div>

    <form id="paymentConfirmationForm">
      <div class="form-section">
        <h2>é¡§å®¢æƒ…å ±</h2>

        <div class="form-group">
          <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span style="color: #ef4444;">*</span></label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="example@example.com"
          />
        </div>

        <div class="form-group">
          <label for="fullName">ãŠåå‰ <span style="color: #ef4444;">*</span></label>
          <input
            type="text"
            id="fullName"
            name="fullName"
            required
            placeholder="å±±ç”° å¤ªéƒ"
          />
        </div>

        <div class="form-group">
          <label for="productName">ãƒ—ãƒ©ãƒ³ <span style="color: #ef4444;">*</span></label>
          <select id="productName" name="productName" required>
            <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
            <option value="Standard (Â¥5,980/æœˆ)">Standard (Â¥5,980/æœˆ)</option>
            <option value="Premium (Â¥9,980/æœˆ)">Premium (Â¥9,980/æœˆ)</option>
            <option value="Premium Sanrenpuku (Â¥19,820/æœˆ)">Premium Sanrenpuku (Â¥19,820/æœˆ)</option>
            <option value="Premium Combo (Â¥24,800/æœˆ)">Premium Combo (Â¥24,800/æœˆ)</option>
            <option value="Premium Plus (Â¥68,000/å˜å“)">Premium Plus (Â¥68,000/å˜å“)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="transferAmount">å…¥é‡‘é‡‘é¡</label>
          <input
            type="number"
            id="transferAmount"
            name="transferAmount"
            placeholder="68000"
          />
          <div class="hint">â€»ãƒ¡ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</div>
        </div>

        <div class="form-group">
          <label for="airtableRecordId">Airtable Record ID</label>
          <input
            type="text"
            id="airtableRecordId"
            name="airtableRecordId"
            placeholder="recXXXXXXXXXXXXXX"
          />
          <div class="hint">â€»å…¥åŠ›ã™ã‚‹ã¨ã€Airtableã®StatusãŒ "pending" â†’ "active" ã«æ›´æ–°ã•ã‚Œã¾ã™ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</div>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="btn btn-secondary" onclick="resetForm()">
          ãƒªã‚»ãƒƒãƒˆ
        </button>
        <button type="submit" class="btn btn-primary">
          ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        </button>
      </div>
    </form>

    <div id="statusBox" class="status-box"></div>
  </div>

  <script>
    const form = document.getElementById('paymentConfirmationForm');
    const statusBox = document.getElementById('statusBox');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
      const formData = new FormData(form);
      const data = {
        email: formData.get('email'),
        fullName: formData.get('fullName'),
        productName: formData.get('productName'),
        transferAmount: formData.get('transferAmount') || null,
        airtableRecordId: formData.get('airtableRecordId') || null
      };

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      showStatus('loading', '<span class="spinner"></span> ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­...');

      try {
        // Netlify Functionã‚’å‘¼ã³å‡ºã—
        const response = await fetch('/.netlify/functions/send-payment-confirmation', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (response.ok) {
          showStatus('success', `
            âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸï¼<br>
            <strong>${data.email}</strong> ã«ã€Œå…¥é‡‘ã‚ã‚ŠãŒã¨ã† + ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã€ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚<br>
            ãƒ—ãƒ©ãƒ³: <strong>${data.productName}</strong>
          `);

          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
          form.reset();
        } else {
          throw new Error(result.message || 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        showStatus('error', `
          âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ<br>
          ${error.message}
        `);
      }
    });

    function showStatus(type, message) {
      statusBox.className = `status-box ${type}`;
      statusBox.innerHTML = message;
      statusBox.style.display = 'block';

      // æˆåŠŸæ™‚ã¯5ç§’å¾Œã«è‡ªå‹•çš„ã«éè¡¨ç¤º
      if (type === 'success') {
        setTimeout(() => {
          statusBox.style.display = 'none';
        }, 5000);
      }
    }

    function resetForm() {
      form.reset();
      statusBox.style.display = 'none';
    }
  </script>
</body>
</html>
