---
export const prerender = true;
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="æœ¬æ—¥ã®ç©´é¦¬ç®¡ç† | ç®¡ç†ç”»é¢" description="ç©´é¦¬æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ç™»éŒ²ãƒ»ç®¡ç†ç”»é¢">
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ æœ¬æ—¥ã®ç©´é¦¬ç®¡ç†</h1>
            <p class="subtitle">ãƒã‚³ã•ã‚“ã®çµŒé¨“ã¨å‹˜ã«ã‚ˆã‚‹ç©´é¦¬æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç™»éŒ²</p>
        </div>

        <!-- ä½¿ã„æ–¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="how-to-use">
            <h2>ğŸ“ ä½¿ã„æ–¹</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <strong>ç©´é¦¬ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</strong>
                        <p>ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«å…¨ãƒ¬ãƒ¼ã‚¹ã®ç©´é¦¬æƒ…å ±ã‚’è²¼ã‚Šä»˜ã‘</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <strong>è§£æå®Ÿè¡Œ</strong>
                        <p>ã€Œè§£æã—ã¦ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã§JSONç”Ÿæˆ</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <strong>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç¢ºèª</strong>
                        <p>ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <strong>ã‚³ãƒ”ãƒ¼</strong>
                        <p>ã€ŒğŸ“‹ JSONå…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <strong>GitHubç·¨é›†</strong>
                        <p>ã€ŒğŸŒ GitHubã§ç·¨é›†ã€ãƒœã‚¿ãƒ³ã§darkHorseData.jsonç·¨é›†ç”»é¢ã¸</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <strong>æœ¬ç•ªåæ˜ </strong>
                        <p>GitHubä¸Šã§ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’é¸æŠï¼ˆCtrl+A / Cmd+Aï¼‰â†’ ã‚³ãƒ”ãƒ¼ã—ãŸJSONã‚’è²¼ã‚Šä»˜ã‘ â†’ Previewç¢ºèª â†’ Commit â†’ 1-2åˆ†å¾Œã«æœ¬ç•ªåæ˜ </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¥åŠ›å½¢å¼ä¾‹ -->
        <div class="format-examples">
            <h3>ğŸ’¡ å…¥åŠ›å½¢å¼ä¾‹</h3>
            <div class="format-grid">
                <div class="format-example">
                    <h4>âœ¨ æ–°å½¢å¼: 1è¡Œè¤‡æ•°é ­å¯¾å¿œï¼ˆæ¨å¥¨ï¼‰</h4>
                    <pre>1R 8ç•ª 33% 3ç•ª 32%
2R 4ç•ª 29% 11ç•ª 28%
3R 2ç•ª 30%</pre>
                    <small>â€» 1è¡Œã«è¤‡æ•°é ­ã‚’ã¾ã¨ã‚ã¦å…¥åŠ›å¯èƒ½ï¼</small>
                </div>
                <div class="format-example">
                    <h4>å½¢å¼1: åŸºæœ¬å½¢å¼</h4>
                    <pre>å·å´1R 3ç•ª ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾… 85%
å·å´2R 7ç•ª ã‚µãƒ—ãƒ©ã‚¤ã‚º è¡€çµ±å¦™å‘³ãƒ»è·é›¢é©æ€§â— 70%</pre>
                </div>
                <div class="format-example">
                    <h4>å½¢å¼2: ã‚³ãƒ­ãƒ³å½¢å¼</h4>
                    <pre>1R: 3ç•ª ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ (å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾…) 85%
2R: 7ç•ª ã‚µãƒ—ãƒ©ã‚¤ã‚º (è¡€çµ±å¦™å‘³ãƒ»è·é›¢é©æ€§â—) 70%</pre>
                </div>
            </div>
            <p class="note">â€» ãƒ¬ãƒ¼ã‚¹åã¯è‡ªå‹•æ¤œå‡ºã•ã‚Œã¾ã™ï¼ˆçœç•¥å¯ï¼‰ã€‚ä¿¡é ¼åº¦ã¯%å€¤ã§æŒ‡å®šï¼ˆä¾‹: 85% = é«˜ä¿¡é ¼åº¦ã€70% = ä¸­ä¿¡é ¼åº¦ã€55% = ä½ä¿¡é ¼åº¦ï¼‰</p>
        </div>

        <!-- æ—¥ä»˜ãƒ»ç«¶é¦¬å ´è¨­å®š -->
        <div class="settings-section">
            <h2>âš™ï¸ è¨­å®š</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="raceDate">æ—¥ä»˜</label>
                    <input type="date" id="raceDate" />
                </div>
                <div class="setting-item">
                    <label for="raceTrack">ç«¶é¦¬å ´</label>
                    <select id="raceTrack">
                        <option value="å·å´ç«¶é¦¬">å·å´ç«¶é¦¬</option>
                        <option value="å¤§äº•ç«¶é¦¬">å¤§äº•ç«¶é¦¬</option>
                        <option value="èˆ¹æ©‹ç«¶é¦¬">èˆ¹æ©‹ç«¶é¦¬</option>
                        <option value="æµ¦å’Œç«¶é¦¬">æµ¦å’Œç«¶é¦¬</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="totalRaces">ç·ãƒ¬ãƒ¼ã‚¹æ•°</label>
                    <select id="totalRaces">
                        <option value="8">8ãƒ¬ãƒ¼ã‚¹</option>
                        <option value="10">10ãƒ¬ãƒ¼ã‚¹</option>
                        <option value="11">11ãƒ¬ãƒ¼ã‚¹</option>
                        <option value="12" selected>12ãƒ¬ãƒ¼ã‚¹</option>
                    </select>
                </div>
            </div>
            <div class="load-prediction-section">
                <button id="loadPredictionBtn" class="load-btn">ğŸ”„ äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ˆé¦¬åè‡ªå‹•å–å¾—ï¼‰</button>
                <div id="loadStatus" class="load-status"></div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
        <div class="input-tabs">
            <button class="tab-btn active" data-tab="simple">ğŸ“ ç°¡ç•¥å…¥åŠ›ï¼ˆãŠã™ã™ã‚ï¼‰</button>
            <button class="tab-btn" data-tab="dropdown">ğŸ¯ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠ</button>
            <button class="tab-btn" data-tab="bulk">ğŸ“‹ ä¸€æ‹¬ãƒšãƒ¼ã‚¹ãƒˆï¼ˆå¾“æ¥ï¼‰</button>
        </div>

        <!-- ç°¡ç•¥å…¥åŠ›ã‚¿ãƒ– -->
        <div class="tab-content active" data-tab="simple">
            <div class="input-section">
                <h2>ğŸ“ ç°¡ç•¥å…¥åŠ›ï¼ˆé¦¬åè‡ªå‹•å–å¾—ï¼‰</h2>
                <p class="tab-desc">âœ¨ ãƒ¬ãƒ¼ã‚¹ç•ªå·ã¨é¦¬ç•ªã ã‘å…¥åŠ›ã™ã‚Œã°ã€é¦¬åã¯è‡ªå‹•ã§å–å¾—ã•ã‚Œã¾ã™ï¼</p>
                <textarea
                    id="simpleInput"
                    placeholder="ç°¡ç•¥å½¢å¼ã§å…¥åŠ›ï¼ˆé¦¬åã¯è‡ªå‹•å–å¾—ã•ã‚Œã¾ã™ï¼‰

ğŸ“ æ–°å½¢å¼ï¼ˆ1è¡Œã«è¤‡æ•°é ­å¯¾å¿œï¼‰:
1R 8ç•ª 33% 3ç•ª 32%
2R 4ç•ª 29% 11ç•ª 28%
3R 2ç•ª 30%

ğŸ“ å¾“æ¥å½¢å¼ï¼ˆ1è¡Œã«1é ­ï¼‰:
1R 3
å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾…
85

2R 7
è¡€çµ±å¦™å‘³ãƒ»è·é›¢é©æ€§â—
70
..."></textarea>
                <div class="button-group">
                    <button id="parseSimpleBtn" class="primary-btn">ğŸš€ ç°¡ç•¥å…¥åŠ›ã‚’è§£æ</button>
                    <button id="clearSimpleBtn" class="secondary-btn">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>

        <!-- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠã‚¿ãƒ– -->
        <div class="tab-content" data-tab="dropdown">
            <div class="input-section">
                <h2>ğŸ¯ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠ</h2>
                <p class="tab-desc">âœ¨ ãƒã‚¦ã‚¹ã ã‘ã§ç©´é¦¬ã‚’é¸æŠãƒ»è¿½åŠ ã§ãã¾ã™ï¼</p>
                <div class="dropdown-form">
                    <div class="form-row">
                        <div class="form-item">
                            <label for="selectRace">ãƒ¬ãƒ¼ã‚¹é¸æŠ</label>
                            <select id="selectRace">
                                <option value="">-- ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ --</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label for="selectHorse">é¦¬é¸æŠ</label>
                            <select id="selectHorse" disabled>
                                <option value="">-- ã¾ãšãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item full-width">
                            <label for="horseReason">ç©´é¦¬é¸å®šç†ç”±ï¼ˆä»»æ„ï¼‰</label>
                            <textarea id="horseReason" rows="3" placeholder="ä¾‹: å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾…ï¼ˆç©ºæ¬„ã§ã‚‚OKï¼‰"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item">
                            <label for="horseConfidence">ä¿¡é ¼åº¦ï¼ˆ%ï¼‰</label>
                            <input type="number" id="horseConfidence" min="0" max="100" step="1" value="50" placeholder="ä¾‹: 50">
                        </div>
                        <div class="form-item">
                            <button id="addHorseBtn" class="add-btn" disabled>â• ç©´é¦¬ã‚’è¿½åŠ </button>
                        </div>
                    </div>
                </div>

                <!-- è¿½åŠ æ¸ˆã¿ãƒªã‚¹ãƒˆ -->
                <div id="addedList" class="added-list" style="display: none;">
                    <h3>ğŸ“‹ è¿½åŠ æ¸ˆã¿ç©´é¦¬ãƒªã‚¹ãƒˆ</h3>
                    <div id="addedItems" class="added-items"></div>
                </div>
            </div>
        </div>

        <!-- ä¸€æ‹¬ãƒšãƒ¼ã‚¹ãƒˆã‚¿ãƒ– -->
        <div class="tab-content" data-tab="bulk">
            <div class="input-section">
                <h2>ğŸ“‹ ä¸€æ‹¬ãƒšãƒ¼ã‚¹ãƒˆï¼ˆå¾“æ¥æ–¹å¼ï¼‰</h2>
                <p class="tab-desc">å…¨ãƒ¬ãƒ¼ã‚¹ã®ç©´é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦è²¼ã‚Šä»˜ã‘ã§ãã¾ã™</p>
                <textarea
                    id="darkHorseInput"
                    placeholder="å…¨ãƒ¬ãƒ¼ã‚¹ã®ç©´é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...

ä¾‹:
å·å´1R 3ç•ª ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾… 85%
å·å´2R 7ç•ª ã‚µãƒ—ãƒ©ã‚¤ã‚º è¡€çµ±å¦™å‘³ãƒ»è·é›¢é©æ€§â— 70%
..."></textarea>
                <div class="button-group">
                    <button id="parseBtn" class="primary-btn">ğŸ” è§£æã—ã¦ç”Ÿæˆ</button>
                    <button id="clearBtn" class="secondary-btn">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div id="previewSection" class="preview-section" style="display: none;">
            <h2>ğŸ‘€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <div id="previewContent" class="preview-content"></div>
        </div>

        <!-- JSONå‡ºåŠ›ã‚¨ãƒªã‚¢ -->
        <div id="jsonSection" class="json-section" style="display: none;">
            <h2>ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸJSON</h2>
            <div class="json-actions">
                <button id="copyJsonBtn" class="action-btn">ğŸ“‹ JSONå…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼</button>
                <a href="https://github.com/apol0510/nankan-analytics/edit/main/astro-site/src/data/darkHorseData.json" target="_blank" class="action-btn github-btn">ğŸŒ GitHubã§ç·¨é›†ï¼ˆæœ¬ç•ªåæ˜ ï¼‰</a>
            </div>
            <pre id="jsonOutput" class="json-output"></pre>
        </div>

        <!-- é‡è¦ãƒã‚¤ãƒ³ãƒˆ -->
        <div class="important-notes">
            <h3>ğŸ’¡ é‡è¦ãƒã‚¤ãƒ³ãƒˆï¼ˆJSONã‚¨ãƒ©ãƒ¼é˜²æ­¢ï¼‰</h3>
            <ul>
                <li><strong>å…¨ä½“ç½®æ›</strong>: GitHubç·¨é›†ç”»é¢ã§ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’é¸æŠï¼ˆCtrl+A / Cmd+Aï¼‰ã—ã¦å‰Šé™¤ â†’ ç”ŸæˆJSONã‚’è²¼ã‚Šä»˜ã‘</li>
                <li><strong>Previewã‚¿ãƒ–ç¢ºèª</strong>: GitHubç·¨é›†ç”»é¢ä¸Šéƒ¨ã®ã€ŒPreviewã€ã‚¿ãƒ–ã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª</li>
                <li><strong>ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆç¶­æŒ</strong>: ç”ŸæˆJSONã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆ2ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ã‚’ãã®ã¾ã¾ç¶­æŒ</li>
                <li><strong>Commitå¾Œãƒ‡ãƒ—ãƒ­ã‚¤</strong>: ã€ŒCommit changesã€å¾Œã€1-2åˆ†ã§Netlifyã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</li>
            </ul>
        </div>
    </div>
</BaseLayout>

<style>
    .admin-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        color: #e2e8f0;
    }

    .admin-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .admin-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }

    .subtitle {
        color: #94a3b8;
        font-size: 1rem;
    }

    .how-to-use {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .how-to-use h2 {
        color: #f59e0b;
        font-size: 1.3rem;
        margin: 0 0 20px 0;
    }

    .steps {
        display: grid;
        gap: 15px;
    }

    .step {
        display: flex;
        gap: 15px;
        align-items: flex-start;
        background: rgba(15, 23, 42, 0.8);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
    }

    .step-number {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        flex-shrink: 0;
    }

    .step-content strong {
        color: #e2e8f0;
        display: block;
        margin-bottom: 5px;
    }

    .step-content p {
        color: #94a3b8;
        font-size: 0.9rem;
        margin: 0;
    }

    .format-examples {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .format-examples h3 {
        color: #3b82f6;
        font-size: 1.2rem;
        margin: 0 0 20px 0;
    }

    .format-grid {
        display: grid;
        gap: 15px;
        margin-bottom: 15px;
    }

    .format-example {
        background: rgba(15, 23, 42, 0.8);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
    }

    .format-example h4 {
        color: #60a5fa;
        font-size: 0.95rem;
        margin: 0 0 10px 0;
    }

    .format-example pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 6px;
        color: #cbd5e1;
        font-size: 0.85rem;
        margin: 0;
        overflow-x: auto;
    }

    .note {
        color: #94a3b8;
        font-size: 0.9rem;
        margin: 0;
    }

    .settings-section {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .settings-section h2 {
        color: #8b5cf6;
        font-size: 1.3rem;
        margin: 0 0 20px 0;
    }

    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .setting-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .setting-item label {
        color: #94a3b8;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .setting-item input,
    .setting-item select {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        color: #e2e8f0;
        padding: 10px;
        font-size: 0.95rem;
    }

    .setting-item input:focus,
    .setting-item select:focus {
        outline: none;
        border-color: #8b5cf6;
    }

    .input-section {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .input-section h2 {
        color: #10b981;
        font-size: 1.3rem;
        margin: 0 0 20px 0;
    }

    #darkHorseInput {
        width: 100%;
        min-height: 400px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        color: #e2e8f0;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        resize: vertical;
    }

    #darkHorseInput:focus {
        outline: none;
        border-color: #10b981;
    }

    .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }

    .primary-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
    }

    .primary-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
    }

    .secondary-btn {
        background: rgba(100, 116, 139, 0.2);
        color: #94a3b8;
        border: 1px solid rgba(100, 116, 139, 0.3);
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .secondary-btn:hover {
        background: rgba(100, 116, 139, 0.3);
        color: #e2e8f0;
    }

    .preview-section {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .preview-section h2 {
        color: #3b82f6;
        font-size: 1.3rem;
        margin: 0 0 20px 0;
    }

    .preview-content {
        display: grid;
        gap: 15px;
    }

    .race-preview {
        background: rgba(15, 23, 42, 0.8);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
    }

    .race-preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .race-number-badge {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        color: white;
        padding: 4px 12px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .confidence-badge {
        color: #fbbf24;
        font-size: 1.1rem;
    }

    .horse-info {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 8px;
    }

    .horse-number {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .horse-name {
        color: #e2e8f0;
        font-weight: 600;
        font-size: 1rem;
    }

    .reason-text {
        color: #94a3b8;
        font-size: 0.9rem;
        line-height: 1.5;
    }

    .json-section {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 30px;
    }

    .json-section h2 {
        color: #8b5cf6;
        font-size: 1.3rem;
        margin: 0 0 20px 0;
    }

    .json-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .action-btn {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }

    .github-btn {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
    }

    .github-btn:hover {
        box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
    }

    .json-output {
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        padding: 15px;
        color: #10b981;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        max-height: 500px;
        overflow-y: auto;
    }

    .important-notes {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 16px;
        padding: 24px;
    }

    .important-notes h3 {
        color: #fbbf24;
        font-size: 1.2rem;
        margin: 0 0 15px 0;
    }

    .important-notes ul {
        margin: 0;
        padding-left: 20px;
        color: #cbd5e1;
        line-height: 1.8;
    }

    .important-notes li {
        margin-bottom: 8px;
    }

    .important-notes strong {
        color: #fbbf24;
    }

    .load-prediction-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(100, 116, 139, 0.2);
    }

    .load-btn {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
    }

    .load-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }

    .load-status {
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        font-size: 0.9rem;
        display: none;
    }

    .load-status.success {
        background: rgba(16, 185, 129, 0.2);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: #10b981;
        display: block;
    }

    .load-status.error {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
        display: block;
    }

    .input-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid rgba(100, 116, 139, 0.2);
    }

    .tab-btn {
        background: transparent;
        color: #94a3b8;
        border: none;
        padding: 12px 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
        position: relative;
        bottom: -2px;
    }

    .tab-btn.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
    }

    .tab-btn:hover:not(.active) {
        color: #cbd5e1;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .tab-desc {
        color: #94a3b8;
        font-size: 0.95rem;
        margin-bottom: 15px;
    }

    #simpleInput {
        width: 100%;
        min-height: 350px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        color: #e2e8f0;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        resize: vertical;
    }

    #simpleInput:focus {
        outline: none;
        border-color: #3b82f6;
    }

    .dropdown-form {
        background: rgba(15, 23, 42, 0.6);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
        margin-bottom: 20px;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
    }

    .form-row:last-child {
        margin-bottom: 0;
    }

    .form-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .form-item.full-width {
        grid-column: 1 / -1;
    }

    .form-item label {
        color: #94a3b8;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .form-item select,
    .form-item textarea,
    .form-item input[type="number"] {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 8px;
        color: #e2e8f0;
        padding: 10px;
        font-size: 0.95rem;
    }

    .form-item select:focus,
    .form-item textarea:focus,
    .form-item input[type="number"]:focus {
        outline: none;
        border-color: #3b82f6;
    }

    .form-item textarea {
        resize: vertical;
        font-family: inherit;
    }

    .add-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: auto;
    }

    .add-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
    }

    .add-btn:disabled {
        background: rgba(100, 116, 139, 0.3);
        cursor: not-allowed;
    }

    .added-list {
        background: rgba(15, 23, 42, 0.6);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
    }

    .added-list h3 {
        color: #3b82f6;
        font-size: 1.1rem;
        margin: 0 0 15px 0;
    }

    .added-items {
        display: grid;
        gap: 10px;
    }

    .added-item {
        background: rgba(30, 41, 59, 0.8);
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(100, 116, 139, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .added-item-info {
        flex: 1;
    }

    .added-item-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 5px;
    }

    .added-item-race {
        background: linear-gradient(135deg, #f59e0b, #ea580c);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: 700;
        font-size: 0.8rem;
    }

    .added-item-horse {
        color: #e2e8f0;
        font-weight: 600;
    }

    .added-item-reason {
        color: #94a3b8;
        font-size: 0.85rem;
    }

    .remove-btn {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .remove-btn:hover {
        background: rgba(239, 68, 68, 0.3);
    }

    @media (max-width: 768px) {
        .admin-container {
            padding: 20px 15px;
        }

        .admin-header h1 {
            font-size: 1.8rem;
        }

        .settings-grid {
            grid-template-columns: 1fr;
        }

        .button-group {
            flex-direction: column;
        }

        .json-actions {
            flex-direction: column;
        }

        .input-tabs {
            flex-direction: column;
            gap: 5px;
        }

        .tab-btn {
            border-bottom: none;
            border-left: 3px solid transparent;
            bottom: 0;
            text-align: left;
        }

        .tab-btn.active {
            border-bottom: none;
            border-left-color: #3b82f6;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
    }
</style>

<script is:inline>
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let predictionData = null;
let addedHorses = [];

document.addEventListener('DOMContentLoaded', () => {
    // æ—¥ä»˜ã‚’ä»Šæ—¥ã«è¨­å®š
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('raceDate').value = today;

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    setupTabs();

    // äºˆæƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³
    document.getElementById('loadPredictionBtn').addEventListener('click', loadPredictionData);

    // ç°¡ç•¥å…¥åŠ›ãƒœã‚¿ãƒ³
    document.getElementById('parseSimpleBtn').addEventListener('click', parseSimpleInput);
    document.getElementById('clearSimpleBtn').addEventListener('click', () => {
        document.getElementById('simpleInput').value = '';
        clearResults();
    });

    // ä¸€æ‹¬ãƒšãƒ¼ã‚¹ãƒˆãƒœã‚¿ãƒ³ï¼ˆå¾“æ¥ï¼‰
    document.getElementById('parseBtn').addEventListener('click', parseDarkHorseData);
    document.getElementById('clearBtn').addEventListener('click', () => {
        document.getElementById('darkHorseInput').value = '';
        clearResults();
    });

    // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é–¢é€£
    document.getElementById('selectRace').addEventListener('change', onRaceSelect);
    document.getElementById('addHorseBtn').addEventListener('click', addHorseFromDropdown);

    // JSONã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
    document.getElementById('copyJsonBtn').addEventListener('click', () => {
        const jsonText = document.getElementById('jsonOutput').textContent;
        navigator.clipboard.writeText(jsonText).then(() => {
            const btn = document.getElementById('copyJsonBtn');
            const originalText = btn.textContent;
            btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        });
    });
});

// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆè¨­å®š
function setupTabs() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.tab;

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¹åˆ‡ã‚Šæ›¿ãˆ
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));

            btn.classList.add('active');
            document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
        });
    });
}

// äºˆæƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
async function loadPredictionData() {
    const raceDate = document.getElementById('raceDate').value;
    const statusEl = document.getElementById('loadStatus');

    try {
        statusEl.className = 'load-status';
        statusEl.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';
        statusEl.style.display = 'block';

        const response = await fetch('/data/allRacesPrediction.json');
        if (!response.ok) throw new Error('äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

        const data = await response.json();
        predictionData = data;

        statusEl.className = 'load-status success';
        statusEl.textContent = `âœ… ${data.raceDate} ${data.track} ã®äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${data.totalRaces}Rï¼‰`;

        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°
        populateRaceDropdown();
    } catch (error) {
        statusEl.className = 'load-status error';
        statusEl.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
        console.error(error);
    }
}

// ãƒ¬ãƒ¼ã‚¹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ç”Ÿæˆ
function populateRaceDropdown() {
    if (!predictionData) return;

    const selectRace = document.getElementById('selectRace');
    selectRace.innerHTML = '<option value="">-- ãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ --</option>';

    predictionData.races.forEach(race => {
        const option = document.createElement('option');
        option.value = race.raceNumber;
        option.textContent = `${race.raceNumber} ${race.raceName || ''}`;
        selectRace.appendChild(option);
    });

    selectRace.disabled = false;
}

// ãƒ¬ãƒ¼ã‚¹é¸æŠæ™‚
function onRaceSelect() {
    const raceNumber = document.getElementById('selectRace').value;
    const selectHorse = document.getElementById('selectHorse');

    if (!raceNumber || !predictionData) {
        selectHorse.disabled = true;
        selectHorse.innerHTML = '<option value="">-- ã¾ãšãƒ¬ãƒ¼ã‚¹ã‚’é¸æŠ --</option>';
        document.getElementById('addHorseBtn').disabled = true;
        return;
    }

    const race = predictionData.races.find(r => r.raceNumber === raceNumber);
    if (!race || !race.horses) {
        selectHorse.disabled = true;
        selectHorse.innerHTML = '<option value="">-- é¦¬ãƒ‡ãƒ¼ã‚¿ãªã— --</option>';
        document.getElementById('addHorseBtn').disabled = true;
        return;
    }

    // é¦¬ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ç”Ÿæˆ
    selectHorse.innerHTML = '<option value="">-- é¦¬ã‚’é¸æŠ --</option>';

    // horsesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å…¨ã¦ã®é¦¬ã‚’æŠ½å‡º
    const allHorses = [];
    if (race.horses.main) allHorses.push(race.horses.main);
    if (race.horses.sub) allHorses.push(race.horses.sub);
    if (race.horses.hole1) allHorses.push(race.horses.hole1);
    if (race.horses.hole2) allHorses.push(race.horses.hole2);
    if (race.horses.connect && Array.isArray(race.horses.connect)) {
        allHorses.push(...race.horses.connect);
    }
    if (race.horses.reserve && Array.isArray(race.horses.reserve)) {
        allHorses.push(...race.horses.reserve);
    }

    // é¦¬ç•ªé †ã«ã‚½ãƒ¼ãƒˆ
    allHorses.sort((a, b) => {
        const numA = typeof a.number === 'string' ? parseInt(a.number) : a.number;
        const numB = typeof b.number === 'string' ? parseInt(b.number) : b.number;
        return numA - numB;
    });

    // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«è¿½åŠ 
    allHorses.forEach(horse => {
        const option = document.createElement('option');
        option.value = JSON.stringify({ number: horse.number, name: horse.name });
        option.textContent = `${horse.number}ç•ª ${horse.name}`;
        selectHorse.appendChild(option);
    });

    selectHorse.disabled = false;

    // é¦¬é¸æŠæ™‚ã«ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
    selectHorse.addEventListener('change', () => {
        document.getElementById('addHorseBtn').disabled = !selectHorse.value;
    });
}

// ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ç©´é¦¬è¿½åŠ 
function addHorseFromDropdown() {
    const raceNumber = document.getElementById('selectRace').value;
    const horseData = document.getElementById('selectHorse').value;
    const reason = document.getElementById('horseReason').value.trim();
    const confidenceValue = document.getElementById('horseConfidence').value;

    if (!raceNumber || !horseData || !confidenceValue) {
        alert('ãƒ¬ãƒ¼ã‚¹ã€é¦¬ã€ä¿¡é ¼åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }

    const horse = JSON.parse(horseData);
    const race = predictionData.races.find(r => r.raceNumber === raceNumber);

    const horseItem = {
        raceNumber: raceNumber,
        raceName: race.raceName || '',
        horseNumber: horse.number,
        horseName: horse.name.trim(),
        reason: reason,
        confidence: `${confidenceValue}%`
    };

    addedHorses.push(horseItem);
    updateAddedList();
    generateFinalJSON();

    // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('horseReason').value = '';
    document.getElementById('horseConfidence').value = '50';
}

// è¿½åŠ æ¸ˆã¿ãƒªã‚¹ãƒˆæ›´æ–°
function updateAddedList() {
    const addedList = document.getElementById('addedList');
    const addedItems = document.getElementById('addedItems');

    if (addedHorses.length === 0) {
        addedList.style.display = 'none';
        return;
    }

    addedList.style.display = 'block';
    addedItems.innerHTML = addedHorses.map((horse, index) => `
        <div class="added-item">
            <div class="added-item-info">
                <div class="added-item-header">
                    <span class="added-item-race">${horse.raceNumber}</span>
                    <span class="added-item-horse">${horse.horseNumber}ç•ª ${horse.horseName}</span>
                    <span class="confidence-badge">${horse.confidence}</span>
                </div>
                ${horse.reason ? `<div class="added-item-reason">ğŸ’¡ ${horse.reason}</div>` : ''}
            </div>
            <button class="remove-btn" onclick="removeHorse(${index})">ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>
    `).join('');
}

// ç©´é¦¬å‰Šé™¤
function removeHorse(index) {
    addedHorses.splice(index, 1);
    updateAddedList();
    generateFinalJSON();
}

// ç°¡ç•¥å…¥åŠ›ãƒ‘ãƒ¼ã‚¹
function parseSimpleInput() {
    if (!predictionData) {
        alert('å…ˆã«ã€Œäºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã§äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„');
        return;
    }

    const input = document.getElementById('simpleInput').value.trim();
    if (!input) {
        alert('ç°¡ç•¥ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    const lines = input.split('\n').filter(line => line.trim());
    const horses = [];
    let currentHorse = null;

    for (const line of lines) {
        // å…¨è§’æ•°å­—ãƒ»å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŠè§’ã«å¤‰æ›
        const trimmedLine = line.trim()
            .replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))
            .replace(/ã€€/g, ' ');

        // æ–°å½¢å¼ãƒã‚§ãƒƒã‚¯: 1R 8ç•ª 33% 3ç•ª 32%
        // é¦¬ç•ªã¨%å€¤ã®ãƒšã‚¢ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        if (/^\d+R?\s+\d+ç•ª\s+\d+%/.test(trimmedLine)) {
            // æ–°å½¢å¼ã¨ã—ã¦å‡¦ç†
            const newFormatMatch = trimmedLine.match(/^(\d+)R?\s+(.+)$/);
            if (newFormatMatch) {
                const raceNumber = `${newFormatMatch[1]}R`;
                const horseDataStr = newFormatMatch[2];

                console.log(`ğŸ” æ–°å½¢å¼å‡¦ç†: ${raceNumber}, ãƒ‡ãƒ¼ã‚¿: ${horseDataStr}`);

                // é¦¬ç•ªã¨%å€¤ã®ãƒšã‚¢ã‚’æŠ½å‡º
                const horsePattern = /(\d+)ç•ª\s+(\d+)%/g;
                let match;

                while ((match = horsePattern.exec(horseDataStr)) !== null) {
                    const horseNumber = match[1];
                    const confidence = match[2];

                    console.log(`  âœ… æŠ½å‡º: ${horseNumber}ç•ª ${confidence}%`);

                // é¦¬åã‚’äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—
                const race = predictionData.races.find(r => r.raceNumber === raceNumber);

                // horsesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸé¦¬ç•ªã®é¦¬ã‚’æ¤œç´¢
                let horse = null;
                if (race && race.horses) {
                    const allHorses = [];
                    if (race.horses.main) allHorses.push(race.horses.main);
                    if (race.horses.sub) allHorses.push(race.horses.sub);
                    if (race.horses.hole1) allHorses.push(race.horses.hole1);
                    if (race.horses.hole2) allHorses.push(race.horses.hole2);
                    if (race.horses.connect && Array.isArray(race.horses.connect)) {
                        allHorses.push(...race.horses.connect);
                    }
                    if (race.horses.reserve && Array.isArray(race.horses.reserve)) {
                        allHorses.push(...race.horses.reserve);
                    }
                    horse = allHorses.find(h => String(h.number) === String(horseNumber));
                }

                if (!horse) {
                    console.warn(`${raceNumber} ${horseNumber}ç•ªã®é¦¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                    continue;
                }

                    horses.push({
                        raceNumber: raceNumber,
                        raceName: race.raceName || '',
                        horseNumber: horseNumber,
                        horseName: horse.name.trim(),
                        reason: '',
                        confidence: `${confidence}%`
                    });
                }
            }
        } else {
            // å¾“æ¥å½¢å¼ã®å‡¦ç†
            // ãƒ¬ãƒ¼ã‚¹ç•ªå·ã¨é¦¬ç•ªï¼ˆä¾‹: 1R 3ï¼‰
            const raceMatch = trimmedLine.match(/^(\d+)R?\s+(\d+)$/);
            if (raceMatch) {
                if (currentHorse) horses.push(currentHorse);

                const raceNumber = `${raceMatch[1]}R`;
                const horseNumber = raceMatch[2];

                console.log(`ğŸ” å¾“æ¥å½¢å¼å‡¦ç†: ${raceNumber} ${horseNumber}ç•ª`);

                // é¦¬åã‚’äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—
                const race = predictionData.races.find(r => r.raceNumber === raceNumber);

                // horsesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æŒ‡å®šã•ã‚ŒãŸé¦¬ç•ªã®é¦¬ã‚’æ¤œç´¢
                let horse = null;
                if (race && race.horses) {
                    const allHorses = [];
                    if (race.horses.main) allHorses.push(race.horses.main);
                    if (race.horses.sub) allHorses.push(race.horses.sub);
                    if (race.horses.hole1) allHorses.push(race.horses.hole1);
                    if (race.horses.hole2) allHorses.push(race.horses.hole2);
                    if (race.horses.connect && Array.isArray(race.horses.connect)) {
                        allHorses.push(...race.horses.connect);
                    }
                    if (race.horses.reserve && Array.isArray(race.horses.reserve)) {
                        allHorses.push(...race.horses.reserve);
                    }
                    horse = allHorses.find(h => String(h.number) === String(horseNumber));
                }

                if (!horse) {
                    alert(`${raceNumber} ${horseNumber}ç•ªã®é¦¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                    continue;
                }

                currentHorse = {
                    raceNumber: raceNumber,
                    raceName: race.raceName || '',
                    horseNumber: horseNumber,
                    horseName: horse.name.trim(),
                    reason: '',
                    confidence: '50%'
                };
            }
            // %å€¤ï¼ˆä¾‹: 85, 85%ï¼‰
            else if (trimmedLine.match(/^\d+%?$/)) {
                if (currentHorse) {
                    const confidence = trimmedLine.replace('%', '');
                    currentHorse.confidence = `${confidence}%`;
                }
            }
            // ç†ç”±ï¼ˆãã‚Œä»¥å¤–ã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰
            else if (currentHorse && trimmedLine) {
                currentHorse.reason += (currentHorse.reason ? ' ' : '') + trimmedLine;
            }
        }
    }

    // æœ€å¾Œã®é¦¬ã‚’è¿½åŠ 
    if (currentHorse) horses.push(currentHorse);

    if (horses.length === 0) {
        alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
        return;
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    displayPreview(horses);
    generateJSON(horses);

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
    document.getElementById('previewSection').style.display = 'block';
    document.getElementById('jsonSection').style.display = 'block';
    document.getElementById('jsonSection').scrollIntoView({ behavior: 'smooth' });
}

// æœ€çµ‚JSONç”Ÿæˆï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ç”¨ï¼‰
function generateFinalJSON() {
    if (addedHorses.length === 0) {
        document.getElementById('previewSection').style.display = 'none';
        document.getElementById('jsonSection').style.display = 'none';
        return;
    }

    displayPreview(addedHorses);
    generateJSON(addedHorses);

    document.getElementById('previewSection').style.display = 'block';
    document.getElementById('jsonSection').style.display = 'block';
}

// çµæœã‚¯ãƒªã‚¢
function clearResults() {
    addedHorses = [];
    updateAddedList();
    document.getElementById('previewSection').style.display = 'none';
    document.getElementById('jsonSection').style.display = 'none';
}

// ä¸€æ‹¬ãƒšãƒ¼ã‚¹ãƒˆè§£æï¼ˆå¾“æ¥ï¼‰
function parseDarkHorseData() {
    const input = document.getElementById('darkHorseInput').value.trim();
    if (!input) {
        alert('ç©´é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    const raceDate = document.getElementById('raceDate').value;
    const track = document.getElementById('raceTrack').value;
    const totalRaces = parseInt(document.getElementById('totalRaces').value);

    const races = [];
    const lines = input.split('\n').filter(line => line.trim());

    for (const line of lines) {
        const parsed = parseLine(line);
        if (parsed) {
            races.push(parsed);
        }
    }

    if (races.length === 0) {
        alert('æœ‰åŠ¹ãªç©´é¦¬ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
        return;
    }

    // ãƒ‡ãƒ¼ã‚¿è£œå®Œ
    races.forEach(race => {
        if (!race.raceName) {
            race.raceName = getRaceNameFromNumber(race.raceNumber, track);
        }
    });

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    displayPreview(races);
    generateJSON(races);

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
    document.getElementById('previewSection').style.display = 'block';
    document.getElementById('jsonSection').style.display = 'block';
    document.getElementById('jsonSection').scrollIntoView({ behavior: 'smooth' });
}

// ä¸€è¡Œãƒ‘ãƒ¼ã‚¹ï¼ˆå¾“æ¥æ–¹å¼ï¼‰
function parseLine(line) {
    // ãƒ‘ã‚¿ãƒ¼ãƒ³1: å·å´1R 3ç•ª ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾… 85%
    let match = line.match(/(\d+)R[:\s]*(\d+)ç•ª\s+([^\s]+)\s+(.+?)\s*(\d+%?)$/);
    if (match) {
        const confidence = match[5].replace('%', '');
        return {
            raceNumber: `${match[1]}R`,
            horseNumber: match[2],
            horseName: match[3],
            reason: match[4].trim(),
            confidence: `${confidence}%`
        };
    }

    // ãƒ‘ã‚¿ãƒ¼ãƒ³2: 1R: 3ç•ª ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ (å‰èµ°å¥½èµ°ãƒ»é¨æ‰‹å¤‰æ›´ã§ä»Šå›æœŸå¾…) 85%
    match = line.match(/(\d+)R[:\s]*(\d+)ç•ª\s+([^\s(]+)\s*\(([^)]+)\)\s*(\d+%?)$/);
    if (match) {
        const confidence = match[5].replace('%', '');
        return {
            raceNumber: `${match[1]}R`,
            horseNumber: match[2],
            horseName: match[3],
            reason: match[4].trim(),
            confidence: `${confidence}%`
        };
    }

    // ãƒ‘ã‚¿ãƒ¼ãƒ³3: 1R ã€3ã€‘ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ å‰èµ°å¥½èµ° 85%
    match = line.match(/(\d+)R[:\s]*[ã€\[](\d+)[ã€‘\]]\s*([^\s]+)\s+(.+?)\s*(\d+%?)$/);
    if (match) {
        const confidence = match[5].replace('%', '');
        return {
            raceNumber: `${match[1]}R`,
            horseNumber: match[2],
            horseName: match[3],
            reason: match[4].trim(),
            confidence: `${confidence}%`
        };
    }

    return null;
}

// ãƒ¬ãƒ¼ã‚¹åç”Ÿæˆ
function getRaceNameFromNumber(raceNumber, track) {
    const num = parseInt(raceNumber.replace('R', ''));
    if (num <= 3) return '2æ­³ãƒ»C3';
    if (num <= 6) return 'C2ãƒ»C1';
    if (num <= 9) return 'Bç´š';
    if (num <= 11) return 'Aç´šãƒ»é‡è³';
    return 'ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ¼ã‚¹';
}

// ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
function displayPreview(races) {
    const previewContent = document.getElementById('previewContent');

    // ãƒ¬ãƒ¼ã‚¹ç•ªå·ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    const groupedByRace = {};
    races.forEach(horse => {
        if (!groupedByRace[horse.raceNumber]) {
            groupedByRace[horse.raceNumber] = [];
        }
        groupedByRace[horse.raceNumber].push(horse);
    });

    // ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«è¡¨ç¤º
    const sortedRaceNumbers = Object.keys(groupedByRace).sort((a, b) => {
        const numA = parseInt(a.replace('R', ''));
        const numB = parseInt(b.replace('R', ''));
        return numA - numB;
    });

    previewContent.innerHTML = sortedRaceNumbers.map(raceNumber => {
        const horses = groupedByRace[raceNumber];
        return `
            <div class="race-preview">
                <div class="race-preview-header">
                    <span class="race-number-badge">${raceNumber}</span>
                    <span style="color: #94a3b8; font-size: 0.9rem;">${horses.length}é ­</span>
                </div>
                ${horses.map(horse => `
                    <div class="horse-info" style="margin-bottom: 8px;">
                        <span class="horse-number">${horse.horseNumber}ç•ª</span>
                        <span class="horse-name">${horse.horseName}</span>
                        <span class="confidence-badge">${horse.confidence}</span>
                    </div>
                    ${horse.reason ? `<div class="reason-text">ğŸ’¡ ${horse.reason}</div>` : ''}
                `).join('')}
            </div>
        `;
    }).join('');
}

// JSONç”Ÿæˆ
function generateJSON(horses) {
    const raceDate = document.getElementById('raceDate').value;
    const track = document.getElementById('raceTrack').value;
    const totalRaces = parseInt(document.getElementById('totalRaces').value);

    const jsonData = {
        date: raceDate,
        track: track,
        lastUpdated: new Date().toISOString(),
        totalRaces: totalRaces,
        races: horses.sort((a, b) => {
            const numA = parseInt(a.raceNumber.replace('R', ''));
            const numB = parseInt(b.raceNumber.replace('R', ''));
            return numA - numB;
        })
    };

    const jsonOutput = document.getElementById('jsonOutput');
    jsonOutput.textContent = JSON.stringify(jsonData, null, 2);
}
</script>
