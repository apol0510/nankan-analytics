---
export const prerender = true;
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="è²·ã„ç›®ç›´æ¥å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ " description="ãƒã‚³ã¡ã‚ƒã‚“å°‚ç”¨ - å®Œæˆãƒ‡ãƒ¼ã‚¿ç›´æ¥åæ˜ ã‚·ã‚¹ãƒ†ãƒ ">
    <div class="container">
        <div class="header-section">
            <div class="ai-badge">
                <span class="pulse"></span>
                <span class="ai-status">100%ç¢ºå®Ÿã‚·ã‚¹ãƒ†ãƒ </span>
            </div>
            <h1>ğŸ¯ è²·ã„ç›®ç›´æ¥å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="subtitle">ãƒã‚³ã¡ã‚ƒã‚“ã®å®Œæˆãƒ‡ãƒ¼ã‚¿ â†’ å³åº§ã«æœ¬ç•ªåæ˜ </p>
            <div class="guarantee-box">
                <h3>ğŸ’– ãƒã‚³ã¡ã‚ƒã‚“ä¿è¨¼äº‹é …</h3>
                <ul>
                    <li>âœ… premium-predictions/ ã®ãƒ‡ã‚¶ã‚¤ãƒ³ <strong>100%ä¿æŒ</strong></li>
                    <li>âœ… é¦¬æƒ…å ±ãƒ»ã‚¹ã‚³ã‚¢ãƒ»ç‰¹å¾´é‡ <strong>å®Œå…¨æ›´æ–°</strong></li>
                    <li>âœ… è²·ã„ç›®ãƒ»å€™è£œé¦¬ <strong>ç¢ºå®Ÿæ›´æ–°</strong></li>
                    <li>âœ… å…¨ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬åæ˜  <strong>å®Œå…¨å¯¾å¿œ</strong></li>
                    <li>âœ… åŠè§’å…¨è§’ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ <strong>æŸ”è»Ÿå¯¾å¿œ</strong></li>
                </ul>
            </div>
        </div>

        <div class="form-section">
            <div class="input-section">
                <h2>ğŸ“ å®Œæˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                <div class="format-guide">
                    <p><strong>ãƒã‚³ã¡ã‚ƒã‚“å½¢å¼å®Œå…¨å¯¾å¿œ:</strong> è¤‡æ•°è¡Œå½¢å¼ãƒ»å€™è£œé¦¬ãƒªã‚¹ãƒˆãƒ»å…¨ãƒ‡ãƒ¼ã‚¿åæ˜ </p>
                </div>
                <textarea
                    id="complete-data"
                    placeholder="ãƒã‚³ã¡ã‚ƒã‚“ã®å®Œæˆãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...

ä¾‹ï¼š
å¤§äº•ç«¶é¦¬9/17
1R
â— 11 ã‚ªãƒ¼ãƒ«ã‚¹ã‚¿ãƒ¼ã‚º æœ¬å‘½ ç·åˆè©•ä¾¡:â˜…â˜…â˜… ç´¯ç©ã‚¹ã‚³ã‚¢: 88pt ç‰¹å¾´é‡é‡è¦åº¦ å®‰å®šæ€§91% èƒ½åŠ›ä¸Šä½æ€§90% å±•é–‹åˆ©81%
â—‹ 5 ã‚·ãƒ£ãƒ¼ã‚¯ã‚¦ã‚©ãƒ¼ãƒ‹ãƒ³ å¯¾æŠ— ç·åˆè©•ä¾¡:â˜…â˜…â˜… ç´¯ç©ã‚¹ã‚³ã‚¢: 87pt ç‰¹å¾´é‡é‡è¦åº¦ å®‰å®šæ€§97% èƒ½åŠ›ä¸Šä½æ€§79% å±•é–‹åˆ©82%
â–² 9 ãƒ•ã‚§ã‚¢ã‚¯ãƒ©ã‚¦ãƒ‰ å˜ç©´ ç·åˆè©•ä¾¡:â˜…â˜…â˜… ç´¯ç©ã‚¹ã‚³ã‚¢: 82pt
â–² 6 ãƒ‘ãƒ³ã‚ªã‚·ãƒ§ã‚³ãƒ© å˜ç©´ ç·åˆè©•ä¾¡:â˜…â˜…â˜… ç´¯ç©ã‚¹ã‚³ã‚¢: 76pt
â–³ é€£ä¸‹å€™è£œé¦¬ 4 ãƒ™ãƒƒãƒ†ã‚£ãƒ¼ãƒŠ (75pt) 13 ãƒ–ãƒƒã‚³ãƒ¯ãƒ¼ã‚¹ (75pt)...
Ã— æŠ‘ãˆå€™è£œé¦¬ 2 ãƒ¬ãƒ‡ã‚£ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢ (66pt) 7 ã‚ªãƒ‹ã‚¯ãƒ€ã‚¤ã‚¹ã‚­ãƒãƒ³ (66pt)...

è²·ã„ç›®
å°‘ç‚¹æ•°çš„ä¸­å‹ãƒ¢ãƒ‡ãƒ« é¦¬å˜ 11 â†’ 5,6,9ã€€3ç‚¹ AIäºˆæ¸¬58%
ãƒãƒ©ãƒ³ã‚¹å‹ãƒ¢ãƒ‡ãƒ« é¦¬å˜ 5,6,9 â†’ 11ã€€3ç‚¹ é¦¬å˜ 11 â‡” 4,10,13,14ã€€8ç‚¹...
é«˜é…å½“è¿½æ±‚å‹ãƒ¢ãƒ‡ãƒ« é¦¬å˜ 11 â†’ 2,7,12ã€€3ç‚¹ é¦¬å˜ 5 â‡” 2,4,7,10,12,13,14ã€€14ç‚¹...

2R
â— 8 ãƒ•ãƒ­ãƒªãƒ€ãƒ•ã‚©ãƒ³ãƒ†ãƒ³ æœ¬å‘½
ç·åˆè©•ä¾¡:â˜…â˜…â˜…
ç´¯ç©ã‚¹ã‚³ã‚¢: 85pt
ç‰¹å¾´é‡é‡è¦åº¦
å®‰å®šæ€§92%
èƒ½åŠ›ä¸Šä½æ€§90%
å±•é–‹åˆ©73%
..."
                    rows="30"></textarea>
            </div>

            <div class="action-buttons">
                <button type="button" id="parse-btn" class="btn-primary">ğŸ“‹ è§£æãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
                <button type="button" id="update-json-btn" class="btn-success" style="display: none;">ğŸš€ JSONæ›´æ–°å®Ÿè¡Œ</button>
                <a href="/premium-predictions" id="check-result-btn" class="btn-check" style="display: none;">ğŸ‘€ çµæœç¢ºèª</a>
            </div>
        </div>

        <div id="preview-section" class="preview-section" style="display: none;">
            <h2>ğŸ“‹ è§£æçµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <div id="preview-content"></div>
        </div>

        <div id="success-section" class="success-section" style="display: none;">
            <h2>âœ… æ›´æ–°å®Œäº†</h2>
            <p>å…¨ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸï¼</p>
            <p><strong>premium-predictions/</strong> ã§çµæœã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
        </div>
    </div>

    <script>
        let parsedData = null;

        // è§£æå‡¦ç†
        document.getElementById('parse-btn').addEventListener('click', function() {
            const inputData = document.getElementById('complete-data').value;

            if (!inputData.trim()) {
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                parsedData = parseCompleteData(inputData);
                displayPreview(parsedData);

                document.getElementById('preview-section').style.display = 'block';
                document.getElementById('update-json-btn').style.display = 'inline-block';
            } catch (error) {
                alert('ãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                console.error('Parse error:', error);
            }
        });

        // JSONæ›´æ–°å‡¦ç†
        document.getElementById('update-json-btn').addEventListener('click', function() {
            if (!parsedData) {
                alert('å…ˆã«è§£æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return;
            }

            try {
                updateJsonData(parsedData);
                document.getElementById('success-section').style.display = 'block';
                document.getElementById('check-result-btn').style.display = 'inline-block';

                // å°‘ã—ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                document.getElementById('success-section').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                alert('JSONæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                console.error('Update error:', error);
            }
        });

        // é¦¬ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function saveHorseData(raceInfo, horseData) {
            if (!horseData || !horseData.type) return;

            console.log(`ğŸ é¦¬ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ${horseData.mark}${horseData.number}${horseData.name} (${horseData.type})`);

            if (horseData.type === 'æœ¬å‘½') {
                raceInfo.horses.main = horseData;
            } else if (horseData.type === 'å¯¾æŠ—') {
                raceInfo.horses.sub = horseData;
            } else if (horseData.type === 'å˜ç©´') {
                if (!raceInfo.horses.sub1) {
                    raceInfo.horses.sub1 = horseData;
                } else {
                    horseData.type = 'å˜ç©´2';
                    raceInfo.horses.sub2 = horseData;
                }
            }
        }

        // ãƒã‚³ã¡ã‚ƒã‚“å½¢å¼å®Œå…¨å¯¾å¿œãƒ‘ãƒ¼ã‚¹é–¢æ•°
        function parseCompleteData(data) {
            const lines = data.split('\n').map(line => line.trim()).filter(line => line);
            const raceData = {};

            let currentRace = null;
            let currentSection = null;
            let currentHorseData = null;
            let horseDataBuffer = [];

            console.log('ğŸ” ãƒã‚³ã¡ã‚ƒã‚“ãƒ‡ãƒ¼ã‚¿è§£æé–‹å§‹');

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                console.log(`ğŸ“ å‡¦ç†ä¸­: "${line}"`);

                // ãƒ¬ãƒ¼ã‚¹ç•ªå·æ¤œå‡º
                const raceMatch = line.match(/^([0-9ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™ï¼123456789]{1,2})\s*[rRãƒ¬ãƒ¼ã‚¹]$/);
                if (raceMatch) {
                    // å‰ã®ãƒ¬ãƒ¼ã‚¹ã®é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                    if (currentRace && currentHorseData) {
                        saveHorseData(raceData[currentRace], currentHorseData);
                        currentHorseData = null;
                    }

                    const raceNum = raceMatch[1]
                        .replace(/[ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™]/g, (match) =>
                            String.fromCharCode(match.charCodeAt(0) - 0xFF10 + 0x30));

                    currentRace = parseInt(raceNum);
                    raceData[currentRace] = {
                        horses: {},
                        candidates: { renka: [], osae: [] },
                        strategies: {}
                    };
                    currentSection = null;
                    currentHorseData = null;
                    console.log(`ğŸ¯ ${currentRace}R é–‹å§‹`);
                    continue;
                }

                if (!currentRace) continue;

                // é¦¬æƒ…å ±ã®é–‹å§‹è¡Œã‚’æ¤œå‡º
                const horseStartMatch = line.match(/^([â—â—‹â–²â–³Ã—])\s*([0-9]+)\s+([^\s]+)\s+(æœ¬å‘½|å¯¾æŠ—|å˜ç©´)/);
                if (horseStartMatch) {
                    // å‰ã®é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                    if (currentHorseData) {
                        saveHorseData(raceData[currentRace], currentHorseData);
                    }

                    const [, mark, number, name, type] = horseStartMatch;
                    currentHorseData = {
                        number: parseInt(number),
                        name: name,
                        mark: mark,
                        type: type,
                        factors: [],
                        importance: []
                    };

                    // åŒã˜è¡Œå†…ã®è¿½åŠ æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯
                    const starMatch = line.match(/ç·åˆè©•ä¾¡:(â˜…+)/);
                    if (starMatch) {
                        currentHorseData.factors.push({
                            icon: "â˜…",
                            text: `ç·åˆè©•ä¾¡:${starMatch[1]}`
                        });
                    }

                    const scoreMatch = line.match(/ç´¯ç©ã‚¹ã‚³ã‚¢:?\s*([0-9]+)pt/);
                    if (scoreMatch) {
                        currentHorseData.factors.push({
                            icon: "â˜…",
                            text: `ç´¯ç©ã‚¹ã‚³ã‚¢: ${scoreMatch[1]}pt`
                        });
                    }

                    // ç‰¹å¾´é‡é‡è¦åº¦ï¼ˆ1è¡Œå½¢å¼ï¼‰
                    const stabilityMatch = line.match(/å®‰å®šæ€§([0-9]+)%/);
                    const abilityMatch = line.match(/èƒ½åŠ›ä¸Šä½æ€§([0-9]+)%/);
                    const developmentMatch = line.match(/å±•é–‹åˆ©([0-9]+)%/);

                    if (stabilityMatch && abilityMatch && developmentMatch) {
                        currentHorseData.importance = [
                            { label: "å®‰å®šæ€§", value: parseInt(stabilityMatch[1]) / 100 },
                            { label: "èƒ½åŠ›ä¸Šä½æ€§", value: parseInt(abilityMatch[1]) / 100 },
                            { label: "å±•é–‹åˆ©", value: parseInt(developmentMatch[1]) / 100 }
                        ];
                    }

                    console.log(`ğŸ é¦¬æƒ…å ±é–‹å§‹: ${mark}${number}${name} (${type})`);
                    continue;
                }

                // è¤‡æ•°è¡Œå½¢å¼ã®æƒ…å ±ã‚’å‡¦ç†
                if (currentHorseData) {
                    // ç·åˆè©•ä¾¡
                    if (line.match(/^ç·åˆè©•ä¾¡:(â˜…+)$/)) {
                        const stars = line.match(/ç·åˆè©•ä¾¡:(â˜…+)$/)[1];
                        currentHorseData.factors.push({
                            icon: "â˜…",
                            text: `ç·åˆè©•ä¾¡:${stars}`
                        });
                        console.log(`   â­ æ˜Ÿè©•ä¾¡: ${stars}`);
                        continue;
                    }

                    // ç´¯ç©ã‚¹ã‚³ã‚¢
                    if (line.match(/^ç´¯ç©ã‚¹ã‚³ã‚¢:?\s*([0-9]+)pt$/)) {
                        const score = line.match(/^ç´¯ç©ã‚¹ã‚³ã‚¢:?\s*([0-9]+)pt$/)[1];
                        currentHorseData.factors.push({
                            icon: "â˜…",
                            text: `ç´¯ç©ã‚¹ã‚³ã‚¢: ${score}pt`
                        });
                        console.log(`   ğŸ“Š ã‚¹ã‚³ã‚¢: ${score}pt`);
                        continue;
                    }

                    // ç‰¹å¾´é‡é‡è¦åº¦ãƒ˜ãƒƒãƒ€ãƒ¼
                    if (line === 'ç‰¹å¾´é‡é‡è¦åº¦') {
                        console.log(`   ğŸ¯ ç‰¹å¾´é‡é‡è¦åº¦é–‹å§‹`);
                        continue;
                    }

                    // å®‰å®šæ€§ãƒ»èƒ½åŠ›ä¸Šä½æ€§ãƒ»å±•é–‹åˆ©ã®å€‹åˆ¥è¡Œ
                    const stabilityOnlyMatch = line.match(/^å®‰å®šæ€§([0-9]+)%$/);
                    const abilityOnlyMatch = line.match(/^èƒ½åŠ›ä¸Šä½æ€§([0-9]+)%$/);
                    const developmentOnlyMatch = line.match(/^å±•é–‹åˆ©([0-9]+)%$/);

                    if (stabilityOnlyMatch || abilityOnlyMatch || developmentOnlyMatch) {
                        if (stabilityOnlyMatch) {
                            currentHorseData.stability = parseInt(stabilityOnlyMatch[1]);
                            console.log(`   ğŸ“ˆ å®‰å®šæ€§: ${stabilityOnlyMatch[1]}%`);
                        }
                        if (abilityOnlyMatch) {
                            currentHorseData.ability = parseInt(abilityOnlyMatch[1]);
                            console.log(`   ğŸ’ª èƒ½åŠ›ä¸Šä½æ€§: ${abilityOnlyMatch[1]}%`);
                        }
                        if (developmentOnlyMatch) {
                            currentHorseData.development = parseInt(developmentOnlyMatch[1]);
                            console.log(`   ğŸ² å±•é–‹åˆ©: ${developmentOnlyMatch[1]}%`);

                            // å±•é–‹åˆ©ãŒæœ€å¾Œãªã®ã§ç‰¹å¾´é‡é‡è¦åº¦ã‚’è¨­å®š
                            if (currentHorseData.stability && currentHorseData.ability) {
                                currentHorseData.importance = [
                                    { label: "å®‰å®šæ€§", value: currentHorseData.stability / 100 },
                                    { label: "èƒ½åŠ›ä¸Šä½æ€§", value: currentHorseData.ability / 100 },
                                    { label: "å±•é–‹åˆ©", value: currentHorseData.development / 100 }
                                ];
                            }
                        }
                        continue;
                    }
                }

                // é€£ä¸‹å€™è£œé¦¬ãƒ‘ãƒ¼ã‚¹
                if (line.startsWith('â–³ é€£ä¸‹å€™è£œé¦¬')) {
                    const numbers = [];
                    // é¦¬ç•ªã®ã¿ã‚’æŠ½å‡ºï¼ˆptãŒä»˜ã„ãŸæ•°å€¤ã¯é™¤å¤–ï¼‰
                    const parts = line.split(/\s+/);
                    for (const part of parts) {
                        // 1æ¡ã¾ãŸã¯2æ¡ã®æ•°å­—ã®ã¿ã‚’æŠ½å‡ºï¼ˆptä»˜ãã¯é™¤å¤–ï¼‰
                        const match = part.match(/^([0-9]{1,2})$/);
                        if (match && !part.includes('pt')) {
                            const num = parseInt(match[1]);
                            if (num >= 1 && num <= 18) { // é€šå¸¸ã®é¦¬ç•ªç¯„å›²
                                numbers.push(num);
                            }
                        }
                    }
                    raceData[currentRace].candidates.renka = numbers;
                    console.log(`ğŸ¯ é€£ä¸‹å€™è£œé¦¬: ${numbers.join(',')}`);
                    continue;
                }

                // æŠ‘ãˆå€™è£œé¦¬ãƒ‘ãƒ¼ã‚¹
                if (line.startsWith('Ã— æŠ‘ãˆå€™è£œé¦¬')) {
                    const numbers = [];
                    // é¦¬ç•ªã®ã¿ã‚’æŠ½å‡ºï¼ˆptãŒä»˜ã„ãŸæ•°å€¤ã¯é™¤å¤–ï¼‰
                    const parts = line.split(/\s+/);
                    for (const part of parts) {
                        // 1æ¡ã¾ãŸã¯2æ¡ã®æ•°å­—ã®ã¿ã‚’æŠ½å‡ºï¼ˆptä»˜ãã¯é™¤å¤–ï¼‰
                        const match = part.match(/^([0-9]{1,2})$/);
                        if (match && !part.includes('pt')) {
                            const num = parseInt(match[1]);
                            if (num >= 1 && num <= 18) { // é€šå¸¸ã®é¦¬ç•ªç¯„å›²
                                numbers.push(num);
                            }
                        }
                    }
                    raceData[currentRace].candidates.osae = numbers;
                    console.log(`ğŸ¯ æŠ‘ãˆå€™è£œé¦¬: ${numbers.join(',')}`);
                    continue;
                }

                // è²·ã„ç›®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                if (line === 'è²·ã„ç›®') {
                    // å‰ã®é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                    if (currentHorseData) {
                        saveHorseData(raceData[currentRace], currentHorseData);
                        currentHorseData = null;
                    }
                    currentSection = 'betting';
                    console.log(`ğŸ’° è²·ã„ç›®ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹`);
                    continue;
                }

                // æˆ¦ç•¥åˆ¥è²·ã„ç›®ãƒ‘ãƒ¼ã‚¹
                if (currentSection === 'betting' || line.includes('å°‘ç‚¹æ•°çš„ä¸­å‹ãƒ¢ãƒ‡ãƒ«') || line.includes('ãƒãƒ©ãƒ³ã‚¹å‹ãƒ¢ãƒ‡ãƒ«') || line.includes('é«˜é…å½“è¿½æ±‚å‹ãƒ¢ãƒ‡ãƒ«')) {
                    if (line.includes('å°‘ç‚¹æ•°çš„ä¸­å‹ãƒ¢ãƒ‡ãƒ«')) {
                        const bets = extractBetsFromLine(line, i, lines);
                        if (bets.length > 0) {
                            raceData[currentRace].strategies.safe = bets;
                            console.log(`ğŸ¯ æˆ¦ç•¥A: ${bets.join(', ')}`);
                        }
                    } else if (line.includes('ãƒãƒ©ãƒ³ã‚¹å‹ãƒ¢ãƒ‡ãƒ«')) {
                        const bets = extractBetsFromLine(line, i, lines);
                        if (bets.length > 0) {
                            raceData[currentRace].strategies.balance = bets;
                            console.log(`âš–ï¸ æˆ¦ç•¥B: ${bets.join(', ')}`);
                        }
                    } else if (line.includes('é«˜é…å½“è¿½æ±‚å‹ãƒ¢ãƒ‡ãƒ«')) {
                        const bets = extractBetsFromLine(line, i, lines);
                        if (bets.length > 0) {
                            raceData[currentRace].strategies.aggressive = bets;
                            console.log(`ğŸš€ æˆ¦ç•¥C: ${bets.join(', ')}`);
                        }
                    }
                }
            }

            // æœ€å¾Œã®é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            if (currentRace && currentHorseData) {
                saveHorseData(raceData[currentRace], currentHorseData);
            }

            console.log('ğŸ“Š è§£æå®Œäº†:', raceData);
            return raceData;
        }

        // è²·ã„ç›®æŠ½å‡ºé–¢æ•°ï¼ˆè¤‡æ•°è¡Œå¯¾å¿œï¼‰
        function extractBetsFromLine(line, startIndex, lines) {
            let fullText = line;

            // æ¬¡ã®æˆ¦ç•¥ã‚„æ¬¡ã®ãƒ¬ãƒ¼ã‚¹ã¾ã§ã®è¡Œã‚’çµåˆ
            for (let j = startIndex + 1; j < lines.length; j++) {
                const nextLine = lines[j];

                // ã‚ˆã‚Šå³å¯†ãªçµ‚äº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯
                if (nextLine.includes('å°‘ç‚¹æ•°çš„ä¸­å‹') || nextLine.includes('ãƒãƒ©ãƒ³ã‚¹å‹') ||
                    nextLine.includes('é«˜é…å½“è¿½æ±‚å‹') ||
                    nextLine.match(/^[0-9ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™]{1,2}\s*[rRãƒ¬ãƒ¼ã‚¹]$/) ||
                    nextLine.startsWith('â—') || nextLine.startsWith('â—‹') ||
                    nextLine.startsWith('â–²') || nextLine.startsWith('â–³') ||
                    nextLine.startsWith('Ã—') || nextLine === 'è²·ã„ç›®') {
                    break;
                }

                // ç©ºè¡Œã‚„ç„¡é–¢ä¿‚ãªè¡Œã¯ã‚¹ã‚­ãƒƒãƒ—
                if (nextLine.trim().length === 0 ||
                    nextLine.includes('ç‰¹å¾´é‡é‡è¦åº¦') ||
                    nextLine.includes('ç·åˆè©•ä¾¡') ||
                    nextLine.includes('ç´¯ç©ã‚¹ã‚³ã‚¢')) {
                    continue;
                }

                fullText += ' ' + nextLine;
            }

            console.log(`ğŸ” æˆ¦ç•¥æŠ½å‡ºç”¨ãƒ†ã‚­ã‚¹ãƒˆ: "${fullText}"`);
            return extractBets(fullText);
        }

        // è²·ã„ç›®æŠ½å‡ºé–¢æ•°ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
        function extractBets(line) {
            const bets = [];

            // å…¨è§’ã‚’åŠè§’ã«æ­£è¦åŒ–
            const normalized = line
                .replace(/[ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™]/g, (char) =>
                    String.fromCharCode(char.charCodeAt(0) - 0xFF10 + 0x30))
                .replace(/ï¼Œ/g, ',')
                .replace(/[â†”â†]/g, 'â‡”')
                .replace(/\s+/g, ' ')  // è¤‡æ•°ã®ç©ºç™½ã‚’1ã¤ã«çµ±ä¸€
                .trim();

            console.log(`ğŸ” è²·ã„ç›®æŠ½å‡º: "${normalized}"`);

            // é¦¬å˜ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡ºï¼ˆé‡è¤‡å›é¿ç‰ˆï¼‰
            const betPattern = /(é¦¬å˜)\s+([0-9,]+)\s*([â†’â‡”])\s*([0-9,]+)/g;
            let match;
            const processedBets = new Set(); // é‡è¤‡é˜²æ­¢

            while ((match = betPattern.exec(normalized)) !== null) {
                const [, type, from, arrow, to] = match;

                const cleanFrom = from.replace(/\s/g, '');
                const cleanTo = to.replace(/\s/g, '');

                // æœ‰åŠ¹ãªé¦¬ç•ªã‹ãƒã‚§ãƒƒã‚¯
                const fromNums = cleanFrom.split(',');
                const toNums = cleanTo.split(',');

                let validBet = true;
                for (const num of [...fromNums, ...toNums]) {
                    const n = parseInt(num);
                    if (isNaN(n) || n < 1 || n > 18) {
                        validBet = false;
                        break;
                    }
                }

                if (validBet) {
                    const cleanBet = `é¦¬å˜ ${cleanFrom} ${arrow} ${cleanTo}`;
                    if (!processedBets.has(cleanBet)) {
                        bets.push(cleanBet);
                        processedBets.add(cleanBet);
                        console.log(`ğŸ¯ æŠ½å‡ºã—ãŸè²·ã„ç›®: "${cleanBet}"`);
                    }
                }
            }

            return bets;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆãƒã‚³ã¡ã‚ƒã‚“å¯¾å¿œç‰ˆï¼‰
        function displayPreview(data) {
            const previewContent = document.getElementById('preview-content');
            let html = '<div class="race-grid">';

            console.log('ğŸ” ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºé–‹å§‹:', data);

            for (let raceNum = 1; raceNum <= 12; raceNum++) {
                const raceInfo = data[raceNum];
                if (!raceInfo) continue;

                console.log(`ğŸ“‹ ${raceNum}R ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä½œæˆ:`, raceInfo);

                html += `
                    <div class="race-preview">
                        <h3>${raceNum}R</h3>

                        <!-- é¦¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                        <div class="horse-section">
                            <h4>ğŸ é¦¬æƒ…å ±</h4>
                            <div class="horse-list">`;

                // å„é¦¬ã®æƒ…å ±è¡¨ç¤º
                if (raceInfo.horses && Object.keys(raceInfo.horses).length > 0) {
                    console.log(`   é¦¬æƒ…å ±ã‚ã‚Š: ${Object.keys(raceInfo.horses).length}é ­`);
                    Object.values(raceInfo.horses).forEach(horse => {
                        if (horse) {
                            console.log(`     - ${horse.mark}${horse.number}${horse.name} (${horse.type})`);
                            const featuresText = horse.factors ? horse.factors.map(f => f.text).join(' ') : '';
                            const importanceText = horse.importance ?
                                horse.importance.map(imp => `${imp.label}${Math.round(imp.value * 100)}%`).join(' ') : '';

                            html += `
                                <div class="horse-item">
                                    <span class="horse-mark">${horse.mark}</span>
                                    <span class="horse-info">${horse.number}${horse.name} (${horse.type})</span>
                                    <div class="horse-details">
                                        <span class="factor">${featuresText}</span>
                                        ${importanceText ? `<span class="importance">${importanceText}</span>` : ''}
                                    </div>
                                </div>`;
                        }
                    });
                } else {
                    console.log(`   é¦¬æƒ…å ±ãªã— (${raceNum}R)`);
                    html += `<div class="horse-item">é¦¬æƒ…å ±ãŒè§£æã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</div>`;
                }

                // å€™è£œé¦¬æƒ…å ±
                if (raceInfo.candidates?.renka?.length > 0) {
                    html += `<div class="candidate-item">â–³ é€£ä¸‹å€™è£œé¦¬: ${raceInfo.candidates.renka.join(',')}</div>`;
                    console.log(`   é€£ä¸‹å€™è£œé¦¬: ${raceInfo.candidates.renka.join(',')}`);
                }
                if (raceInfo.candidates?.osae?.length > 0) {
                    html += `<div class="candidate-item">Ã— æŠ‘ãˆå€™è£œé¦¬: ${raceInfo.candidates.osae.join(',')}</div>`;
                    console.log(`   æŠ‘ãˆå€™è£œé¦¬: ${raceInfo.candidates.osae.join(',')}`);
                }

                html += `
                            </div>
                        </div>

                        <!-- æˆ¦ç•¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                        <div class="strategy-preview">
                            <div class="strategy-item">
                                <h4>ğŸ¯ å°‘ç‚¹æ•°çš„ä¸­å‹</h4>
                                <div>${raceInfo?.strategies?.safe?.join('<br>') || 'æœªè¨­å®š'}</div>
                            </div>
                            <div class="strategy-item">
                                <h4>âš–ï¸ ãƒãƒ©ãƒ³ã‚¹å‹</h4>
                                <div>${raceInfo?.strategies?.balance?.join('<br>') || 'æœªè¨­å®š'}</div>
                            </div>
                            <div class="strategy-item">
                                <h4>ğŸš€ é«˜é…å½“è¿½æ±‚å‹</h4>
                                <div>${raceInfo?.strategies?.aggressive?.join('<br>') || 'æœªè¨­å®š'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            previewContent.innerHTML = html;
        }

        // JSONæ›´æ–°å®Ÿè¡Œï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿å¯¾å¿œç‰ˆï¼‰
        async function updateJsonData(data) {
            try {
                const response = await fetch('/.netlify/functions/update-complete-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        completeData: data
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('âœ… æ›´æ–°æˆåŠŸ:', result);

                if (result.success) {
                    console.log(`ğŸ¯ ${result.updatedRaces}ãƒ¬ãƒ¼ã‚¹ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ`);
                    return result;
                } else {
                    throw new Error(result.error || 'æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

            } catch (error) {
                console.error('âŒ æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }
    </script>

    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        h1 {
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        .guarantee-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 10%, #fef3c7 100%);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin: 30px auto;
            max-width: 600px;
            text-align: left;
        }

        .guarantee-box h3 {
            color: #92400e;
            margin-bottom: 15px;
            text-align: center;
        }

        .guarantee-box ul {
            list-style: none;
            padding: 0;
        }

        .guarantee-box li {
            margin: 8px 0;
            font-weight: 500;
        }

        .form-section {
            background: #1e293b;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #3b82f6;
            margin-bottom: 15px;
        }

        .format-guide {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .format-guide p {
            margin: 0;
            color: #94a3b8;
        }

        #complete-data {
            width: 100%;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            color: #e2e8f0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: vertical;
        }

        #complete-data::placeholder {
            color: #64748b;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-success:hover {
            transform: translateY(-2px);
        }

        .btn-check {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s;
            display: inline-block;
        }

        .btn-check:hover {
            transform: translateY(-2px);
        }

        .preview-section, .success-section {
            background: #1e293b;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .preview-section h2, .success-section h2 {
            color: #3b82f6;
            margin-bottom: 20px;
        }

        .race-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .race-preview {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 20px;
        }

        .race-preview h3 {
            color: #f59e0b;
            margin-bottom: 15px;
            text-align: center;
        }

        /* é¦¬æƒ…å ±è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .horse-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #1e293b;
            border-radius: 8px;
        }

        .horse-section h4 {
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .horse-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .horse-item {
            padding: 12px;
            background: #0f172a;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }

        .horse-mark {
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 8px;
            color: #fbbf24;
        }

        .horse-info {
            font-weight: 600;
            color: #e2e8f0;
            margin-right: 12px;
        }

        .horse-details {
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .factor {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .importance {
            font-size: 0.8rem;
            color: #6b7280;
            font-style: italic;
        }

        .candidate-item {
            padding: 8px 12px;
            background: #374151;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #d1d5db;
            margin-top: 8px;
        }

        .strategy-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #1e293b;
            border-radius: 8px;
        }

        .strategy-item h4 {
            margin: 0 0 8px 0;
            font-size: 0.9rem;
        }

        .strategy-item div {
            color: #e2e8f0;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .success-section {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            text-align: center;
        }

        .success-section h2 {
            color: white;
        }
    </style>
</BaseLayout>