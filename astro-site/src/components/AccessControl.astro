---
// „Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
export interface Props {
    requiredPlan: 'free' | 'standard' | 'premium' | 'Premium Predictions' | 'Premium Sanrenpuku' | 'Premium Combo' | 'Premium Plus';
    showUpgrade?: boolean;
}

const { requiredPlan, showUpgrade = true } = Astro.props;
---

<div id="access-control" data-required-plan={requiredPlan}>
    <!-- Ë™≠„ÅøËæº„Åø‰∏≠Ë°®Á§∫ -->
    <div id="loading-state" class="access-loading">
        <div class="spinner"></div>
        <p>„Ç¢„ÇØ„Çª„ÇπÊ®©Èôê„ÇíÁ¢∫Ë™ç‰∏≠...</p>
    </div>
    
    <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑË°®Á§∫„Ç®„É™„Ç¢ -->
    <div id="content-area" class="hidden">
        <slot />
    </div>
    
    <!-- „Ç¢„ÇØ„Çª„ÇπÊãíÂê¶„É°„ÉÉ„Çª„Éº„Ç∏ -->
    <div id="access-denied" class="access-denied hidden">
        <div class="denied-icon">üîí</div>
        <h2>„Åì„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí„ÅîË¶ß„ÅÑ„Åü„Å†„Åè„Å´„ÅØ‰ºöÂì°ÁôªÈå≤„ÅåÂøÖË¶Å„Åß„Åô</h2>
        <p class="denied-message"></p>
        
        {showUpgrade && (
            <div class="upgrade-options">
                <a href="/pricing/" class="upgrade-btn primary">ÊñôÈáë„Éó„É©„É≥„ÇíË¶ã„Çã</a>
                <a href="/auth/login" class="upgrade-btn secondary">„É≠„Ç∞„Ç§„É≥</a>
            </div>
        )}
    </div>
</div>

<style>
    .access-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
        color: #94a3b8;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(59, 130, 246, 0.2);
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .hidden {
        display: none !important;
    }

    .access-denied {
        text-align: center;
        padding: 80px 20px;
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        margin: 40px auto;
        max-width: 600px;
    }

    .denied-icon {
        font-size: 64px;
        margin-bottom: 24px;
        filter: grayscale(0.5);
        opacity: 0.8;
    }

    .access-denied h2 {
        color: #f1f5f9;
        font-size: 24px;
        margin-bottom: 16px;
    }

    .denied-message {
        color: #94a3b8;
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 32px;
    }

    .upgrade-options {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .upgrade-btn {
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-block;
    }

    .upgrade-btn.primary {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        color: white;
    }

    .upgrade-btn.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }

    .upgrade-btn.secondary {
        background: transparent;
        color: #3b82f6;
        border: 2px solid rgba(59, 130, 246, 0.5);
    }

    .upgrade-btn.secondary:hover {
        background: rgba(59, 130, 246, 0.1);
        border-color: #3b82f6;
    }
</style>

<script>
    // Áí∞Â¢ÉÂà§ÂÆö
    function isDevelopmentMode() {
        // ÈñãÁô∫Áí∞Â¢ÉÂà§ÂÆöÔºölocalhost„Åæ„Åü„ÅØ„Éù„Éº„ÉàÁï™Âè∑„Åå„ÅÇ„ÇãÂ†¥Âêà
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const hasDevPort = window.location.port === '4321' || window.location.port === '3000';
        
        return isLocalhost || hasDevPort;
    }

    // Á∞°ÊòìË™çË®ºÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØÔºàË™çË®º„É¢„Ç∏„É•„Éº„É´‰ΩøÁî®„Åæ„ÅßÔºâ
    function getCurrentUserPlan() {
        console.log('üîç Ë™çË®ºÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØÈñãÂßã');
        
        // 0. „Éá„É¢„É¢„Éº„Éâ„ÅÆ„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥ÊÉÖÂ†±„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÂÑ™ÂÖàÔºâ
        const demoKeys = Object.keys(localStorage).filter(key => key.startsWith('demo_subscription_'));
        if (demoKeys.length > 0) {
            try {
                const demoData = JSON.parse(localStorage.getItem(demoKeys[0]));
                console.log('üé≠ „Éá„É¢„É¢„Éº„ÉâË™çË®º:', demoData);
                return { 
                    user: { id: 'demo_user', email: 'demo@example.com', demo: true }, 
                    plan: demoData.planType.toLowerCase() 
                };
            } catch (error) {
                console.error('Demo data parsing error:', error);
            }
        }

        // 1. ÊóßÂΩ¢Âºè„ÅÆtest_subscription_„Éá„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÊúÄÂÑ™ÂÖà - Êú¨Áï™„ÅßÂÆüÈöõ„Å´‰ΩøÁî®‰∏≠Ôºâ
        const testSubscriptionKeys = Object.keys(localStorage).filter(key => key.startsWith('test_subscription_'));
        if (testSubscriptionKeys.length > 0) {
            try {
                const testData = JSON.parse(localStorage.getItem(testSubscriptionKeys[0]));
                console.log('üì¶ ÊóßÂΩ¢ÂºèË™çË®º„Éá„Éº„ÇøÁô∫Ë¶ã:', testData);
                return { 
                    user: { id: testData.userId, legacy: true }, 
                    plan: testData.planType.toLowerCase() 
                };
            } catch (error) {
                console.error('Test subscription data parsing error:', error);
            }
        }

        // 2. Êñ∞ÂΩ¢Âºè„ÅÆuser-plan„ÉÅ„Çß„ÉÉ„ÇØ
        const userPlanData = localStorage.getItem('user-plan');
        if (userPlanData) {
            try {
                const userData = JSON.parse(userPlanData);
                console.log('‚úÖ user-planË™çË®º:', userData);
                return { 
                    user: { email: userData.email }, 
                    plan: userData.plan || 'free' 
                };
            } catch (error) {
                console.error('User plan parsing error:', error);
            }
        }

        // 3. ÊóßÂΩ¢Âºè„ÅÆisLoggedIn„ÉÅ„Çß„ÉÉ„ÇØÔºà‰∫íÊèõÊÄßÔºâ
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        const userPlan = localStorage.getItem('userPlan');
        if (isLoggedIn === 'true') {
            console.log('‚úÖ ÊóßÂΩ¢ÂºèË™çË®ºÔºàisLoggedInÔºâ:', userPlan);
            return { 
                user: { legacy: true }, 
                plan: userPlan || 'free' 
            };
        }

        // 4. nankan_userË™çË®ºÊÉÖÂ†±„ÇíÂèñÂæóÔºàÊñ∞„ÉÜ„Çπ„ÉàË™çË®ºÁî®Ôºâ
        const nankanUser = localStorage.getItem('nankan_user');
        if (nankanUser) {
            try {
                const userData = JSON.parse(nankanUser);
                console.log('‚úÖ nankan_userË™çË®º:', userData);
                return {
                    user: { email: userData.email, name: userData.name },
                    plan: userData.plan || 'free'
                };
            } catch (error) {
                console.error('Nankan user parsing error:', error);
            }
        }

        // 5. „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË™çË®ºÊÉÖÂ†±„ÇíÂèñÂæó
        const authData = localStorage.getItem('auth_data');
        if (authData) {
            try {
                const { user, plan, expiresAt } = JSON.parse(authData);

                // ÊúâÂäπÊúüÈôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (new Date() > new Date(expiresAt)) {
                    localStorage.removeItem('auth_data');
                    return { user: null, plan: 'free' };
                }

                return { user, plan: plan || 'free' };
            } catch (error) {
                console.error('Auth data parsing error:', error);
                localStorage.removeItem('auth_data');
            }
        }

        // 6. „Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„ÉÅ„Çß„ÉÉ„ÇØ
        const sessionAuth = sessionStorage.getItem('temp_auth');
        if (sessionAuth) {
            try {
                const { plan } = JSON.parse(sessionAuth);
                return { user: { temp: true }, plan: plan || 'free' };
            } catch (error) {
                sessionStorage.removeItem('temp_auth');
            }
        }

        // 7. „Éá„Éï„Ç©„É´„Éà„ÅØÊú™ÁôªÈå≤
        console.log('‚ùå Ë™çË®º„Éá„Éº„Çø„Å™„Åó - Êú™ÁôªÈå≤Áä∂ÊÖã');
        return { user: null, plan: null };
    }

    // „Éó„É©„É≥ÈöéÂ±§„ÉÅ„Çß„ÉÉ„ÇØÔºà2025-10-30Êõ¥Êñ∞: ‰∏âÈÄ£Ë§á„Éó„É©„É≥ÂØæÂøúÔºâ
    function canAccessContent(userPlan, requiredPlan, user) {
        const planHierarchy = {
            // Êóß„Éó„É©„É≥Ôºà‰∫íÊèõÊÄßÁ∂≠ÊåÅÔºâ
            'free': 0,
            'Free': 0,
            'standard': 1,
            'Standard': 1,
            'premium': 2,
            'Premium': 2,

            // Êñ∞„Éó„É©„É≥Ôºà2025-10-31Êõ¥Êñ∞Ôºâ
            'Premium Predictions': 2,      // È¶¨Âçò„ÅÆ„ÅøÔºà¬•9,980Ôºâ
            'Premium Sanrenpuku': 2,       // ‰∏âÈÄ£Ë§á„ÅÆ„ÅøÔºà¬•19,820Ôºâ
            'Premium Combo': 3,            // È¶¨Âçò+‰∏âÈÄ£Ë§áÔºà¬•24,800Ôºâ
            'Premium Plus': 4              // 1ÈûçË∂ÖÁ≤æÂØÜÔºà¬•68,000Ôºâ
        };

        const userLevel = planHierarchy[userPlan] || 0;
        const requiredLevel = planHierarchy[requiredPlan] || 0;

        console.log(`üîç „Ç¢„ÇØ„Çª„Çπ„ÉÅ„Çß„ÉÉ„ÇØË©≥Á¥∞:`, {
            userPlan, requiredPlan, user,
            userLevel, requiredLevel,
            hasUser: user !== null
        });

        // ÁÑ°Êñô„Éó„É©„É≥„ÅåÂøÖË¶Å„Å™Â†¥Âêà - ÁôªÈå≤„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ
        if (requiredPlan === 'free') {
            const hasValidFreeUser = user !== null && (user.email || user.legacy || user.demo || user.temp || user.isTest);
            console.log(`üÜì ÁÑ°Êñô‰ºöÂì°ÈôêÂÆö„Ç≥„É≥„ÉÜ„É≥„ÉÑ - ÁôªÈå≤„ÉÅ„Çß„ÉÉ„ÇØ:`, hasValidFreeUser, { user, plan });
            return hasValidFreeUser; // ÁôªÈå≤Ê∏à„Åø„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπË®±ÂèØ
        }

        // ‰∏âÈÄ£Ë§áÂ∞ÇÁî®„Éö„Éº„Ç∏„ÅÆÁâπÊÆäÂá¶ÁêÜ
        if (requiredPlan === 'Premium Sanrenpuku') {
            const hasValidUser = user !== null && (user.email || user.legacy || user.demo || user.temp || user.isTest);
            // Premium Sanrenpuku „Åæ„Åü„ÅØ Premium Combo „Åß„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ
            // ‚ö†Ô∏è userLevel„ÅØ‰Ωø„Çè„Å™„ÅÑÔºàPremium PredictionsÁ≠â„ÅåË™§„Å£„Å¶„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å¶„Åó„Åæ„ÅÜ„Åü„ÇÅÔºâ
            const canAccess = hasValidUser && (
                userPlan === 'Premium Sanrenpuku' ||
                userPlan === 'Premium Combo'
            );
            console.log(`üêé ‰∏âÈÄ£Ë§á„Ç¢„ÇØ„Çª„Çπ„ÉÅ„Çß„ÉÉ„ÇØ:`, canAccess, { userPlan, hasValidUser });
            return canAccess;
        }

        // È¶¨ÂçòÂ∞ÇÁî®„Éö„Éº„Ç∏„ÅÆÁâπÊÆäÂá¶ÁêÜÔºàpremium, Premium, Premium PredictionsÔºâ
        if (requiredPlan === 'premium' || requiredPlan === 'Premium' || requiredPlan === 'Premium Predictions') {
            const hasValidUser = user !== null && (user.email || user.legacy || user.demo || user.temp || user.isTest);
            // Premium / Premium Predictions „Åæ„Åü„ÅØ Premium Combo „Åß„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ
            // ‚ö†Ô∏è userLevel„ÅØ‰Ωø„Çè„Å™„ÅÑÔºàPremium SanrenpukuÁ≠â„ÅåË™§„Å£„Å¶„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å¶„Åó„Åæ„ÅÜ„Åü„ÇÅÔºâ
            const canAccess = hasValidUser && (
                userPlan === 'Premium' ||
                userPlan === 'premium' ||
                userPlan === 'Premium Predictions' ||
                userPlan === 'Premium Combo'
            );
            console.log(`üèá È¶¨Âçò„Ç¢„ÇØ„Çª„Çπ„ÉÅ„Çß„ÉÉ„ÇØ:`, canAccess, { userPlan, hasValidUser });
            return canAccess;
        }

        // ÊúâÊñô„Éó„É©„É≥„ÅÆÂ†¥Âêà„ÅØÂæìÊù•ÈÄö„Çä„ÅÆÈöéÂ±§„ÉÅ„Çß„ÉÉ„ÇØ + ÁôªÈå≤„ÉÅ„Çß„ÉÉ„ÇØ
        const hasValidUser = user !== null && (user.email || user.legacy || user.demo || user.temp || user.isTest);
        const hasAccess = userLevel >= requiredLevel && hasValidUser;
        console.log(`üíé ÊúâÊñô„Ç¢„ÇØ„Çª„Çπ„ÉÅ„Çß„ÉÉ„ÇØ:`, hasAccess, { userLevel, requiredLevel, hasValidUser, userPlan, requiredPlan });
        return hasAccess;
    }

    // „Éó„É©„É≥Ë°®Á§∫ÂêçÂèñÂæóÔºà2025-10-30Êõ¥Êñ∞Ôºâ
    function getPlanDisplayName(plan) {
        const displayNames = {
            // Êóß„Éó„É©„É≥
            'free': 'ÁÑ°Êñô„Éó„É©„É≥',
            'Free': 'ÁÑ°Êñô„Éó„É©„É≥',
            'standard': '„Çπ„Çø„É≥„ÉÄ„Éº„Éâ„Éó„É©„É≥',
            'Standard': '„Çπ„Çø„É≥„ÉÄ„Éº„Éâ„Éó„É©„É≥',
            'premium': '„Éó„É¨„Éü„Ç¢„É†„Éó„É©„É≥',
            'Premium': '„Éó„É¨„Éü„Ç¢„É†„Éó„É©„É≥',

            // Êñ∞„Éó„É©„É≥Ôºà2025-10-30ËøΩÂä†Ôºâ
            'Premium Predictions': 'Premium PredictionsÔºàÈ¶¨ÂçòÔºâ',
            'Premium Sanrenpuku': 'Premium SanrenpukuÔºà‰∏âÈÄ£Ë§áÔºâ',
            'Premium Combo': 'Premium ComboÔºàÈ¶¨Âçò+‰∏âÈÄ£Ë§áÔºâ',
            'Premium Plus': 'Premium PlusÔºà1ÈûçË∂ÖÁ≤æÂØÜÔºâ'
        };
        return displayNames[plan] || '‰∏çÊòé„Å™„Éó„É©„É≥';
    }

    async function checkAccess() {
        const accessControl = document.getElementById('access-control');
        const loadingState = document.getElementById('loading-state');
        const contentArea = document.getElementById('content-area');
        const accessDenied = document.getElementById('access-denied');
        
        const requiredPlan = accessControl.dataset.requiredPlan;
        
        try {
            // Ë™çË®ºÁä∂ÊÖã„ÅÆÂèñÂæó
            const { user, plan } = getCurrentUserPlan();
            console.log(`üîí Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ - „É¶„Éº„Ç∂„Éº:`, user, `„Éó„É©„É≥:`, plan, `ÂøÖË¶Å„Éó„É©„É≥:`, requiredPlan);

            // ÈñãÁô∫„É¢„Éº„Éâ„Åß„ÅÆÂÑ™ÂÖàË°®Á§∫Ôºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
            if (isDevelopmentMode()) {
                console.log('üîß ÈñãÁô∫„É¢„Éº„Éâ: Ë™çË®ºÊÉÖÂ†±„ÇíÂÑ™ÂÖàË°®Á§∫');
                // ÈñãÁô∫„É¢„Éº„Éâ„Åß„ÅØ10Áßí‰ª•ÂÜÖ„Å´Ë™çË®º„ÅåÂÆå‰∫Ü„Åó„Å™„ÅÑÂ†¥Âêà„ÅØÂº∑Âà∂Ë°®Á§∫
                setTimeout(() => {
                    if (loadingState && !loadingState.classList.contains('hidden')) {
                        console.log('‚ö†Ô∏è ÈñãÁô∫„É¢„Éº„Éâ: Ë™çË®º„Çø„Ç§„É†„Ç¢„Ç¶„Éà - Âº∑Âà∂Ë°®Á§∫ÂÆüË°å');
                        loadingState.style.display = 'none';
                        loadingState.classList.add('hidden');
                        if (contentArea) {
                            contentArea.style.display = 'block';
                            contentArea.classList.remove('hidden');
                        }
                    }
                }, 10000);
            }
            
            // „Ç¢„ÇØ„Çª„ÇπÊ®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ
            if (canAccessContent(plan, requiredPlan, user)) {
                // „Ç¢„ÇØ„Çª„ÇπË®±ÂèØ
                console.log(`‚úÖ „Ç¢„ÇØ„Çª„ÇπË®±ÂèØ: ${getPlanDisplayName(plan)} ‚Üí ${requiredPlan}„Ç≥„É≥„ÉÜ„É≥„ÉÑ`);
                console.log('üìã DOMË¶ÅÁ¥†Áä∂ÊÖã - loading:', loadingState, 'content:', contentArea, 'denied:', accessDenied);
                
                // Âº∑Âà∂ÁöÑ„Å´DOMÊìç‰Ωú„ÇíÂÆüË°å
                if (loadingState) {
                    loadingState.style.display = 'none';
                    loadingState.classList.add('hidden');
                }
                if (contentArea) {
                    contentArea.style.display = 'block';
                    contentArea.classList.remove('hidden');
                }
                if (accessDenied) {
                    accessDenied.style.display = 'none';
                    accessDenied.classList.add('hidden');
                }
                
                console.log('üîì „Ç≥„É≥„ÉÜ„É≥„ÉÑË°®Á§∫ÂÆå‰∫Ü:', {
                    loading: loadingState ? loadingState.style.display : '„Å™„Åó',
                    content: contentArea ? contentArea.style.display : '„Å™„Åó',
                    denied: accessDenied ? accessDenied.style.display : '„Å™„Åó'
                });
            } else {
                // „Ç¢„ÇØ„Çª„ÇπÊãíÂê¶
                console.log(`‚ùå „Ç¢„ÇØ„Çª„ÇπÊãíÂê¶: ${getPlanDisplayName(plan)} ‚Üí ${requiredPlan}„Ç≥„É≥„ÉÜ„É≥„ÉÑ`);
                loadingState.classList.add('hidden');
                contentArea.classList.add('hidden'); // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊòéÁ§∫ÁöÑ„Å´ÈùûË°®Á§∫
                accessDenied.classList.remove('hidden');
                
                // „É°„ÉÉ„Çª„Éº„Ç∏„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫
                const deniedMessage = accessDenied.querySelector('.denied-message');
                
                if (!user) {
                    if (requiredPlan === 'free') {
                        deniedMessage.textContent = 'ÁÑ°Êñô‰∫àÊÉ≥„ÅØ‰ºöÂì°ÁôªÈå≤„Å™„Åó„Åß„ÇÇ„ÅîË¶ß„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ';
                    } else {
                        deniedMessage.textContent = '„Çà„ÇäË©≥Á¥∞„Å™‰∫àÊÉ≥„Çí„ÅîË¶ß„ÅÑ„Åü„Å†„Åè„Å´„ÅØ„ÄÅ‰ºöÂì°ÁôªÈå≤„Å®„Éó„É©„É≥„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ';
                    }
                } else {
                    const currentPlanName = getPlanDisplayName(plan);
                    const requiredPlanName = getPlanDisplayName(requiredPlan);
                    
                    deniedMessage.textContent = `ÁèæÂú®„ÅÆ„Éó„É©„É≥: ${currentPlanName}\n„Åì„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å´„ÅØ„Äå${requiredPlanName}„Äç‰ª•‰∏ä„ÅÆ„Éó„É©„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;
                }
            }
        } catch (error) {
            console.error('‚ùå „Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°„Ç®„É©„Éº:', error);
            
            // Êú¨Áï™Áí∞Â¢É„Åß„ÅØ„Ç®„É©„ÉºÊôÇ„ÅØ„Ç¢„ÇØ„Çª„ÇπÊãíÂê¶ÔºàÂÆâÂÖ®ÂÅ¥„Å´ÂÄí„ÅôÔºâ
            if (!isDevelopmentMode()) {
                console.log('üîí Êú¨Áï™„É¢„Éº„Éâ: „Ç®„É©„ÉºÊôÇ„ÅØ„Ç¢„ÇØ„Çª„ÇπÊãíÂê¶');
                loadingState.classList.add('hidden');
                accessDenied.classList.remove('hidden');
                
                const deniedMessage = accessDenied.querySelector('.denied-message');
                deniedMessage.textContent = '„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
            } else {
                // ÈñãÁô∫„É¢„Éº„Éâ„Åß„ÅÆ„Åø„Ç®„É©„ÉºÊôÇ„Ç¢„ÇØ„Çª„ÇπË®±ÂèØ
                console.log('üîß ÈñãÁô∫„É¢„Éº„Éâ: „Ç®„É©„ÉºÊôÇ„ÇÇË°®Á§∫Á∂ôÁ∂ö');
                loadingState.classList.add('hidden');
                contentArea.classList.remove('hidden');
            }
        }
    }

    // ‚ö†Ô∏è setTestAuth/clearTestAuthÈñ¢Êï∞„ÅØ public/test-auth.js „ÅßÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„Åæ„Åô
    // „Åì„Åì„Åß„ÅÆÂÜçÂÆöÁæ©„ÅØÂâäÈô§„Åó„Åæ„Åó„ÅüÔºàÈáçË§áÈò≤Ê≠¢Ôºâ

    document.addEventListener('DOMContentLoaded', () => {
        console.log('üìã DOMContentLoaded - AccessControlÂàùÊúüÂåñÈñãÂßã');

        // DOMË¶ÅÁ¥†„ÅåÁ¢∫ÂÆü„Å´Â≠òÂú®„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
        const accessControl = document.getElementById('access-control');
        const loadingState = document.getElementById('loading-state');
        const contentArea = document.getElementById('content-area');
        const accessDenied = document.getElementById('access-denied');

        if (!accessControl || !loadingState || !contentArea || !accessDenied) {
            console.error('‚ùå ÂøÖË¶Å„Å™DOMË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {
                accessControl: !!accessControl,
                loadingState: !!loadingState,
                contentArea: !!contentArea,
                accessDenied: !!accessDenied
            });
            // DOMË¶ÅÁ¥†„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„Åß„ÇÇÊúÄ‰ΩéÈôê„ÅÆË°®Á§∫„ÇíË°å„ÅÜ
            if (contentArea) {
                contentArea.style.display = 'block';
                contentArea.classList.remove('hidden');
            }
            return;
        }

        console.log('‚úÖ ÂÖ®DOMË¶ÅÁ¥†Á¢∫Ë™çÂÆå‰∫Ü - AccessControlÂÆüË°åÈñãÂßã');

        // DOMË¶ÅÁ¥†„ÅÆÂÆåÂÖ®„Å™Ê∫ñÂÇô„ÇíÂæÖ„Å§„Åü„ÇÅÂ∞ë„ÅóÈÅÖÂª∂
        setTimeout(() => {
            checkAccess();
        }, 50);
    });
</script>