# テスト決済手順と確認事項

## 現在の設定
✅ **テストモード有効**
- テストキー（pk_test_, sk_test_）設定済み
- サーバー起動済み: http://localhost:4321/

## カード入力画面が表示されない問題について

### 原因
Stripeは同じメールアドレスの既存顧客を検出すると、保存されたカード情報を使用することがあります。

### 解決方法

#### 方法1: 異なるメールアドレスを使用
1. http://localhost:4321/pricing にアクセス
2. **新しいメールアドレス**を使用してログイン/サインアップ
   - 例: test1@example.com, test2@example.com など
3. プランを選択して決済

#### 方法2: ブラウザのシークレット/プライベートモードを使用
1. ブラウザのシークレット/プライベートウィンドウを開く
2. http://localhost:4321/pricing にアクセス
3. 新規ユーザーとしてサインアップ
4. プランを選択

#### 方法3: Stripe Dashboardで顧客データをクリア
1. https://dashboard.stripe.com/test/customers にアクセス
2. テストで使用したメールアドレスの顧客を削除
3. 再度決済フローをテスト

## テストカード入力手順

### 1. 決済ページで以下を入力:
- **カード番号**: `4242 4242 4242 4242`
- **有効期限**: 任意の将来の日付（例: 12/34）
- **CVC**: 任意の3桁（例: 123）
- **名前**: 任意（例: Test User）
- **郵便番号**: 任意（例: 10001）

### 2. 確認ポイント:
- ✅ カード入力フォームが表示される
- ✅ 4242テストカードが受け付けられる
- ✅ 決済処理が完了する
- ✅ 成功ページにリダイレクトされる
- ✅ Supabaseでユーザーのサブスクリプション状態が更新される

## テスト完了後の本番切り替え

### 本番モードで確認すべき点:
1. **カード入力画面が正しく表示される**
2. **実際のカード番号のみ受け付ける**（4242は拒否される）
3. **決済処理が正常に完了する**
4. **Webhookが正しく動作する**

### 本番モードへの切り替え手順:
1. .envファイルで本番キーを有効化
2. サーバーを再起動
3. **実際のクレジットカード**でテスト（少額のテスト決済推奨）

## トラブルシューティング

### Q: カード入力画面が表示されない
A: 上記の「解決方法」を試してください

### Q: 「Your card was declined」エラー
A: テストモードか確認し、4242カードを使用してください

### Q: 決済後にリダイレクトされない
A: SITE_URLが正しく設定されているか確認

## Stripe Dashboardでの確認
- テストモード: https://dashboard.stripe.com/test/payments
- 本番モード: https://dashboard.stripe.com/payments