# NANKANアナリティクス 開発仕様書

## プロジェクト概要

### サイト名
**NANKANアナリティクス**

### コンセプト
「AI・機械学習で勝つ。南関競馬の次世代予想プラットフォーム」

### デザインルール（重要）
**アイコン使用規則**:
- **禁止アイコン**: 🎯（ターゲット/的マーク）は絶対に使用しない
- **推奨アイコン**: ⚡（稲妻）をスピード・攻略の表現に使用
- **その他許可アイコン**: 🤖（AI）、📊（データ）、📚（学習）、🏇（競馬）

### 目的
- 機械学習・AI技術を活用した南関競馬予想手法の教育・解説
- 従来の感覚的予想から科学的・統計的アプローチへの転換支援
- データサイエンス手法を競馬予想に応用する方法論の提供
- 有料AI予想サービスへの段階的導線構築

## 技術要件

### 基盤技術
- **Astro** 静的サイトジェネレーター（Hugoから移行済み）
- **カスタムテーマ** 独自開発
- **デプロイ**: GitHub + Netlify 自動デプロイ
- **ドメイン**: nankan-analytics.keiba.link

### 技術選定の経緯
- **Hugo廃止理由**: より柔軟なコンポーネント開発とモダンなフロントエンド技術の活用のため
- **Astro採用理由**: 
  - 軽量で高速な静的サイト生成
  - コンポーネントベースの開発
  - モダンなJavaScript/TypeScript対応
  - 優れたSEO最適化機能

### テーマカスタマイズ要件
- ダークテーマベースでAI/データサイエンス系の洗練されたデザイン
- 技術系ブログに適したレイアウト
- モバイルファースト・レスポンシブ対応
- Core Web Vitals最適化

## サイト構造

### URL構造
```
https://nankan-analytics.keiba.link/
├── /machine-learning/         (機械学習カテゴリ)
│   ├── /python-basics/       (Python基礎)
│   ├── /data-preprocessing/   (データ前処理)
│   └── /model-building/       (モデル構築)
├── /deep-learning/            (深層学習カテゴリ)
├── /data-science/             (データサイエンス)
├── /tools/                    (ツール・資料)
└── /case-studies/             (事例研究)
```

### メインコンテンツ構成

#### 基礎編：競馬×機械学習入門
1. **機械学習による競馬予想の基本概念**
2. **Pythonを使った競馬データ分析入門**
3. **特徴量設計の実践テクニック**

#### 実践編：AIモデル構築手法
1. **分類問題としての着順予測**
2. **回帰問題としてのオッズ予測**
3. **アンサンブル手法による精度向上**

#### 応用編：高度なAI予想システム
1. **深層学習による予想モデル**
2. **自然言語処理による情報活用**
3. **リアルタイム予想システムの構築**

## SEO戦略（最重要）

### プライマリキーワード
- 競馬 機械学習
- AI 競馬予想
- Python 競馬分析
- 競馬 データサイエンス
- 南関競馬 AI

### セカンダリキーワード
- 競馬予想 アルゴリズム
- 機械学習 南関競馬
- 競馬 深層学習
- XGBoost 競馬
- LSTM 競馬予想

### SEO技術要件
- メタタグ最適化（title, description, keywords）
- 構造化データマークアップ（Article, FAQ, HowTo Schema）
- サイトマップ自動生成
- パンくずリスト
- 内部リンク最適化
- 画像alt属性設定
- ページ速度最適化

### 記事構成ルール
- **文字数**: 3,000-6,000文字
- **見出し構造**: H1(1個) → H2(セクション) → H3(詳細)
- **キーワード密度**: 1-3%
- **内部リンク**: 1記事あたり3-5個

## メルマガ導線設計（最優先）

### 配信システム
- **配配メール**（既存契約活用）
- Netlify Forms → 配配メールAPI連携

### 登録誘導ポイント
1. ヘッダー固定CTA
2. 記事途中の誘導
3. 記事終了後CTA
4. サイドバー
5. Exit Intent ポップアップ
6. フッター

### メルマガ特典
- 競馬AI構築完全マニュアル（Python実装コード付き）
- 機械学習モデルの予想精度レポート（週次更新）
- 有料AI予想の一部を無料配信
- 南関競馬機械学習用データセット（前処理済み）

## 必要なページ

### 固定ページ
- **トップページ**: サイト概要、AIモデル実績、メルマガ登録
- **About**: サイト運営者情報、専門性アピール
- **Tools**: 機械学習ツール・資料ダウンロード
- **Contact**: お問い合わせフォーム
- **Privacy Policy**: プライバシーポリシー

### 初期投稿記事（15記事）

#### 機械学習入門 (5記事)
1. 「Pythonで始める競馬データ分析 - pandas基礎からXGBoostまで」
2. 「南関競馬データの特徴量設計 - 50個の変数で精度向上」
3. 「scikit-learnで競馬予想モデル構築 - 初心者向け完全ガイド」
4. 「競馬データの前処理テクニック - 欠損値から外れ値まで」
5. 「クロスバリデーションで予想精度を正しく評価する方法」

#### 深層学習 (3記事)
1. 「LSTMを使った時系列予想モデル - TensorFlow実装例」
2. 「ニューラルネットワークで競馬オッズを予測する」
3. 「CNNによる競馬画像データ分析 - 馬体重の自動判定」

#### データサイエンス (4記事)
1. 「競馬データの統計分析 - 相関から因果推論まで」
2. 「ベイズ統計で競馬予想の不確実性を定量化」
3. 「クラスタリングで似た特徴の馬を自動分類」
4. 「主成分分析（PCA）で競馬データの次元削減」

#### 実装・ツール (3記事)
1. 「競馬予想Webアプリを Flask で作成する手順」
2. 「API連携で競馬データを自動収集するシステム」
3. 「Jupyter Notebookで始める競馬AI開発環境」

## デザイン要件

### カラーテーマ
- **プライマリ**: #3b82f6 (青)
- **セカンダリ**: #8b5cf6 (紫)
- **背景**: #0f172a (ダークネイビー)
- **テキスト**: #e2e8f0 (ライトグレー)
- **アクセント**: #10b981 (グリーン - 成功指標用)

### UI要素
- グラデーション背景
- カード型レイアウト
- ホバーエフェクト
- アニメーション（控えめ）
- アイコンフォント（機械学習・AI系）

## 機能要件

### 必須機能
- [x] メルマガ登録フォーム（複数箇所）
- [x] 記事検索機能
- [x] カテゴリー別フィルタリング
- [x] 関連記事表示
- [x] SNSシェアボタン
- [x] コメント機能（Disqus）
- [x] Google Analytics 4
- [x] サイトマップ自動生成

### 推奨機能
- [ ] PDF資料ダウンロード機能
- [ ] コード実行環境（CodePen埋め込み）
- [ ] 数式表示（MathJax）
- [ ] 目次自動生成
- [ ] 読了時間表示
- [ ] ダークモード切り替え

## 設定ファイル要件

### astro.config.mjs 主要設定
```javascript
export default defineConfig({
  site: 'https://nankan-analytics.keiba.link',
  integrations: [
    // 必要な統合機能
  ],
  markdown: {
    // マークダウン設定
  }
});
```


## 運営・更新方針

### 更新頻度
- **記事投稿**: 週2回（火・金）
- **メルマガ配信**: 週2回（水・土）
- **SEO分析**: 月1回
- **サイト改善**: 四半期1回

### 成果目標
#### 3ヶ月目標
- 月間オーガニック流入：1,000セッション
- メルマガ登録者：200名
- 主要キーワード20位以内：10個

#### 6ヶ月目標
- 月間オーガニック流入：5,000セッション
- メルマガ登録者：800名
- 主要キーワード10位以内：15個

#### 12ヶ月目標
- 月間オーガニック流入：15,000セッション
- メルマガ登録者：2,000名
- 「競馬 AI」で1ページ目表示

## 開発優先順位

### Phase 1: 基盤構築
1. **Astro環境構築完了**
2. 基本設定・カスタマイズ
3. メルマガ連携設定
4. SEO基本設定

### Phase 2: コンテンツ制作
1. 初期記事15本作成
2. 固定ページ作成
3. ツール・資料ページ構築

### Phase 3: 最適化
1. SEO詳細調整
2. UX改善
3. 高度な機能追加

## 備考

### 重要な考慮事項
- **競合分析**: AI×競馬の分野は競合が少ないブルーオーシャン
- **ターゲット**: IT系エンジニア + 競馬ファンのクロスオーバー層
- **差別化**: 理論だけでなく実装コード提供で実用性を担保
- **収益化**: メルマガ → 有料AI予想サービスへの段階的導線

このサイトは技術系の専門性と競馬という大衆娯楽を組み合わせた、ユニークで価値の高いプラットフォームを目指します。

## サーバー管理とトラブルシューティング

### 複数プロジェクト混在問題の対処法

**問題**: 複数の競馬関連プロジェクトが同じワークスペースにある場合、異なるサイトが表示される

**解決手順**:
1. **実行中サーバーの確認**:
   ```bash
   ps aux | grep -E "(astro|server|http\.server)"
   ```

2. **不要なサーバーの停止**:
   ```bash
   pkill -f "python.*http.server"
   pkill -f "astro dev"
   ```

3. **ポート使用状況の確認**:
   ```bash
   lsof -i tcp | grep LISTEN
   netstat -an | grep :4321
   ```

4. **正しいディレクトリでのサーバー起動**:
   ```bash
   cd "/Users/apolon/Library/Mobile Documents/com~apple~CloudDocs/WorkSpace/nankan-analytics/astro-site"
   npm run dev
   ```

### ブラウザキャッシュ問題の対処法

**症状**: 正しいサーバーが起動しているのに別のサイトが表示される

**解決方法**:
1. **ブラウザキャッシュのクリア**:
   - Firefox: `Cmd+Shift+Delete`
   - Chrome: `Cmd+Shift+Delete`
   - Safari: `Cmd+Option+E`

2. **プライベートモードでの確認**:
   ```bash
   open -a Firefox --new --args --private-window http://localhost:4321/
   ```

3. **URL の確認**: アドレスバーで `http://localhost:4321/` を確認

### 開発時のベストプラクティス

1. **作業開始時の手順**:
   ```bash
   # 既存サーバーの停止
   pkill -f "python.*http.server"
   pkill -f "astro dev"
   
   # 正しいディレクトリに移動
   cd "/Users/apolon/Library/Mobile Documents/com~apple~CloudDocs/WorkSpace/nankan-analytics/astro-site"
   
   # Astroサーバー起動
   npm run dev
   ```

2. **作業終了時の手順**:
   ```bash
   # Ctrl+C でサーバー停止
   # 残存プロセス確認
   ps aux | grep -E "(server|astro)"
   ```

3. **トラブル時の診断コマンド**:
   ```bash
   # 現在のディレクトリ確認
   pwd
   
   # プロジェクト構成確認
   ls -la
   
   # Astroサーバー応答確認
   curl -s http://localhost:4321/ | head -10
   ```

### 注意事項

- **Astro専用**: AstroをメインのSSGとして使用（Hugo完全廃止済み）
- **単一サーバー原則**: 同時に複数のAstroサーバーを起動しない
- **ポート管理**: 4321番ポートはAstro専用
- **プロジェクト分離**: 他のプロジェクト（nankan-inteli, nankan-courese等）と混在させない
- **キャッシュ管理**: ブラウザキャッシュは定期的にクリアする
- **ディレクトリ注意**: astro-site ディレクトリ内で作業すること

## 競馬距離区分の定義（重要：厳守事項）

南関競馬における距離区分は以下の通りとする：

### 距離カテゴリー
- **短距離**: 800m、900m、1000m、1200m、1400m
- **中距離**: 1500m、1600m（マイル）、1650m
- **中長距離**: 1700m、1800m、1900m
- **長距離**: 2000m、2100m、2200m、2400m、2600m